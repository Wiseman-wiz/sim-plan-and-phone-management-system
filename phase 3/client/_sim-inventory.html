<!DOCTYPE html>
<html>

<head>
    <base target="_top" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://rawcdn.githack.com/shinxzxzxz/TableJS/55597d91c8f5165cdfaaf90798bc2e0e886a42e8/tablejs.css"
        rel="stylesheet" />
    <script defer type="module"
        src="https://rawcdn.githack.com/shinxzxzxz/TableJS/55597d91c8f5165cdfaaf90798bc2e0e886a42e8/tablejs.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: ['[data-mode="dark"]'],
        };
    </script>

    <?!= include("CSS"); ?>
    <?!= include("JavaScript"); ?>
</head>

<body>
    <nav class="fixed top-0 z-[39] w-full bg-white border-b border-gray-200">
        <div class="px-3 py-3 lg:px-5 lg:pl-3 h-14">
            <div class="flex items-center justify-between">
                <div class="flex items-center justify-start rtl:justify-end">
                    <button data-drawer-target="logo-sidebar" data-drawer-toggle="logo-sidebar"
                        aria-controls="logo-sidebar" type="button"
                        class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200">
                        <span class="sr-only">Open sidebar</span>
                        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z">
                            </path>
                        </svg>
                    </button>
                    <!-- <a href="https://flowbite.com" class="flex ms-5 md:me-24"> -->
                    <span class="pl-6 self-center text-xl font-semibold sm:text-2xl whitespace-nowrap">SPPM</span>
                    <!-- </a> -->
                </div>
            </div>
        </div>
    </nav>

    <!-- sidebar -->
    {{SIDEBAR}}

    <div class="mt-14 sm:ml-64 hidden">
        <div class="relative bg-white border-b">
            <div class="flex flex-col items-center p-4 space-y-3 md:flex-row md:space-y-0 md:space-x-4 h-14">
                <div class="w-1/2 md:w-1/2"></div>
            </div>
        </div>
        <!-- Table -->
        <div class="relative overflow-x-auto sm:rounded-lg mt-5">
            <!-- Table Footer -->
            <div class="relative overflow-hidden bg-white">
                <nav class="flex flex-col items-start justify-between space-y-3 md:flex-row md:items-center md:space-y-0"
                    aria-label="Table navigation">
                    <div class="flex items-center space-x-3">
                        <label for="rowsPerPage" class="text-sm font-normal text-gray-500">Rows per page:</label>
                        <select id="pagination-limit1"
                            class="block p-2 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-black-500 focus:border-black-500">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="all">All</option>
                        </select>
                        <span id="paginationInfo" class="text-sm font-normal text-gray-500">
                        </span>
                    </div>

                    <ul class="inline-flex items-stretch -space-x-px">
                        <li>
                            <button id="pagination-previous1"
                                class="flex items-center justify-center h-full py-1.5 px-3 ml-0 text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                                <span class="sr-only">Previous</span>
                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </li>

                        <li>
                            <button id="pagination-next1"
                                class="flex items-center justify-center h-full py-1.5 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                                <span class="sr-only">Next</span>
                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <button id="export-csv" class="hidden">Export CSV</button>
    </div>

    <div class="fixed top-14 right-0 w-vw-64 h-vh-14">
        <div class="w-full h-14 flex justify-between items-center">
            <div class="flex space-x-2">
                <label for="searchInput" class="sr-only">Search</label>

                <div class="relative w-full">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg aria-hidden="true" class="w-5 h-5 text-gray-500" viewbox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="pagination-search"
                        class="block w-full p-2 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Search" required="" />
                </div>

                <div class="relative w-40">
                    <button data-dropdown-toggle="table-colvis"
                        class="relative block w-40 p-1.5 border bg-neutral-50 border-neutral-300 text-neutral-900 sm:text-sm rounded focus:ring-neutral-600 focus:border-neutral-600">
                        <div
                            class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none text-neutral-500">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                            </svg>
                        </div>
                        Columns
                    </button>

                    <div data-popover id="table-colvis"
                        class="text-left z-50 hidden bg-white divide-y divide-neutral-100 rounded-lg shadow w-44 h-vh-36 overflow-x-auto text-uppercase">
                        <ul class="py-2 text-sm text-neutral-700"></ul>
                    </div>
                </div>
            </div>

            <div>
                <div
                    class="flex flex-col items-stretch justify-end flex-shrink-0 w-full space-y-2 md:w-auto md:flex-row md:space-y-0 md:items-center md:space-x-3">
                    <button type="button" id="upload-modal-toggle"
                        class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300">
                        <svg class="h-3.5 w-3.5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke-width="1.5" stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                        </svg>
                        Upload File
                    </button>
                    <button type="button" id="add-modal-toggle"
                        class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-blue-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300">
                        <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewbox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                        </svg>
                        Add Sim
                    </button>
                    <div class="flex items-center w-full space-x-3 md:w-auto"></div>
                </div>
            </div>
        </div>

        <div class="relative">
            <div role="status" id="spinner"
                class="absolute inset-0 flex items-center justify-center bg-white z-50 h-full">
                <svg aria-hidden="true" class="w-8 h-8 mr-2 text-gray-200 animate-spin fill-gray-600"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="none">
                    <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z" />
                </svg>
            </div>
            <div class="h-vh-40 overflow-y-auto overflow-x-auto">
                <div class="table-container">
                    <table id="tablejs" class="w-full text-sm text-center rtl:text-right text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3">SIM CARD ID</th>
                                <th scope="col" class="px-6 py-3">STATUS</th>
                                <th scope="col" class="px-6 py-3">RR NO</th>
                                <th scope="col" class="px-6 py-3">RR DATE</th>
                                <th scope="col" class="px-6 py-3">PURCHASING RS NO</th>
                                <th scope="col" class="px-6 py-3">PURCHASING RS DATE</th>
                                <th scope="col" class="px-6 py-3">MOBILE NO</th>
                                <th scope="col" class="px-6 py-3">ACCOUNT NO</th>
                                <th scope="col" class="px-6 py-3">COMPANY</th>
                                <th scope="col" class="px-6 py-3">ADA</th>
                                <th scope="col" class="px-6 py-3">PLAN ID</th>
                                <th scope="col" class="px-6 py-3">RFP GROUP NAME</th>
                                <th scope="col" class="px-6 py-3">DUE DATE DAY</th>
                                <th scope="col" class="px-6 py-3">PLAN EFFECTIVITY</th>
                                <th scope="col" class="px-6 py-3">TERMINATED DATE</th>
                                <th scope="col" class="px-6 py-3">LOCK-IN PERIOD FROM</th>
                                <th scope="col" class="px-6 py-3">LOCK-IN PERIOD TO</th>
                                <th scope="col" class="px-6 py-3">ACTION</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">Action</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Table Footer -->
        <div class="flex items-center justify-between border-t border-neutral-200 px-4 h-12">
            <div class="text-sm">
                <span class="text-sm" id="pagination-records">Shows 1 of 1 of 1 entries</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="text-sm">Rows per page</div>
                <div class="text-sm">
                    <select id="pagination-limit"
                        class="block w-full items-center justify-center px-2 h-8 text-xs font-medium text-neutral-500 bg-white border rounded-lg hover:bg-neutral-100 hover:text-neutral-700 border-neutral-300 focus-within:ring-0 focus:ring-neutral-500 focus:outline-none focus:border-neutral-500">
                        <option value="*" selected>All</option>
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                    </select>
                </div>
                <span class="text-sm" id="pagination-label">Page 1 of 10</span>
                <button id="pagination-previous"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-sm font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700"
                    name="previous">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                    </svg>
                </button>
                <button id="pagination-next"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-sm font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700"
                    name="next">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", async function () {
            const $ = (() => {
                const handlerKeys = [
                    "withSuccessHandler",
                    "withFailureHandler",
                    "withUserObject",
                ];
                const GoogleInstance = {};

                Object.keys(google.script.run)
                    .filter((k) => handlerKeys.indexOf(k) < 0)
                    .forEach((k) => {
                        GoogleInstance[k] = (...args) =>
                            new Promise((resolve, reject) => {
                                google.script.run
                                    .withSuccessHandler(resolve)
                                    .withFailureHandler(reject)[k](...args);
                            });
                    });

                return GoogleInstance;
            })();

            const recordElement = document.querySelector("span#pagination-records");
            const pagingElement = document.querySelector("span#pagination-label");

            const output = {
                pagination: ({
                    current_page,
                    total_page,
                    start_item,
                    end_item,
                    total_rows,
                }) => {
                    if (recordElement)
                        recordElement.innerHTML = `Shows ${start_item} to ${end_item} of ${total_rows} entries`;
                    if (pagingElement)
                        pagingElement.innerHTML = `Page ${current_page} of ${total_page}`;
                },
            };

            const headers = [
                "SIM_CARD_ID",
                "STATUS",
                "TICKET_STATUS",
                "TICKET_NO",
                "ACTIVE_USER",
                "MOBILE_NO",
                "ACCOUNT_NO",
                "PLAN_ID",
                "PLAN_DETAILS",
                "CATEGORY",
                "RFP_GROUP_ID",
                "RFP_GROUP_NAME",
                "RFP_COMPANY",
                "RR_NO",
                "RR_DATE",
                "COMPANY",
                "ADA",
                "DUE_DATE_DAY",
                "PLAN_EFFECTIVITY",
                "TERMINATED_DATE",
                "LOCK_IN_PERIOD_FROM",
                "LOCK_IN_PERIOD_TO",
                "NETWORK_PROVIDER",
                "PROVIDER_COMPANY_NAME",
                "MONTHLY_RECURRING_FEE",
                "EMPLOYEE_INFO",
            ];

            const spinner = document.getElementById("spinner");

            async function renderTable({
                data,
                table
            }) {
                const thead = table.querySelector("thead");
                const tbody = table.querySelector("tbody");

                spinner.classList.add("hidden");

                // Clear existing content
                thead.innerHTML = "";
                tbody.innerHTML = "";

                // Create Header
                const headerRow = document.createElement("tr");
                headers.forEach((header) => {
                    const th = document.createElement("th");
                    th.scope = "col";
                    th.classList.add("px-6", "py-3");

                    const hiddenHeaders = [
                        "NETWORK_PROVIDER",
                        "PROVIDER_COMPANY_NAME",
                        "MONTHLY_RECURRING_FEE",
                        "EMPLOYEE_INFO"
                    ];

                    if (hiddenHeaders.includes(header)) {
                        th.classList.add("hidden-column");
                    }

                    th.textContent = header.replace(/[_\s]{1,}/g, " ");
                    th.dataset.headerName = header;
                    headerRow.appendChild(th);
                });

                // Add Action Header
                const actionHeader = document.createElement("th");
                actionHeader.scope = "col";
                actionHeader.classList.add("px-6", "py-3");
                actionHeader.textContent = "Actions";
                headerRow.appendChild(actionHeader);
                thead.appendChild(headerRow);

                // Create Body
                data.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    tr.classList.add("border-b");
                    if (tr.index === undefined || tr.index === null) {
                        tr.index = index;
                        tr.dataset.index = index;
                    }

                    const rowData = headers.reduce((acc, header) => {
                        const td = document.createElement("td");
                        td.classList.add("px-6", "py-4");

                        const hiddenHeaders = [
                            "NETWORK_PROVIDER",
                            "PROVIDER_COMPANY_NAME",
                            "MONTHLY_RECURRING_FEE",
                            "EMPLOYEE_INFO"
                        ];

                        // Hide certain columns
                        if (hiddenHeaders.includes(header)) {
                            td.classList.add("hidden-column");
                        }

                        let textValue = row[header] || "";  // Ensure you're fetching the actual data

                        // Date formatting function
                        function formatDate(dateString) {
                            const dateValue = new Date(dateString);
                            return isNaN(dateValue.getTime())
                                ? "" // Return empty if the date is invalid
                                : DateTime(dateValue, { format: "MM/DD/YYYY" });  // Call your DateTime function
                        }

                        // Switch to handle specific headers
                        switch (header) {
                            case "RR_DATE":
                            case "PLAN_EFFECTIVITY":
                            case "TERMINATED_DATE":
                            case "LOCK_IN_PERIOD_FROM":
                            case "LOCK_IN_PERIOD_TO":
                                textValue = formatDate(row[header]);
                                break;
                            default:
                                textValue = row[header];  // Use the original value if not a date
                                break;
                        }

                        td.textContent = textValue;
                        tr.appendChild(td);

                        acc[header] = td.textContent;  // Store the content in the accumulator

                        return acc;
                    }, {});

                    // Add Action Buttons
                    const actionTd = document.createElement("td");
                    actionTd.classList.add("px-6", "py-4");
                    const actionDiv = document.createElement("div");
                    actionDiv.classList.add("action-buttons", "flex", "space-x-2");
                    const viewButton = generateActionButton(
                        vectors.view, {
                        class: "px-2 py-2 bg-green-500 text-white rounded ",
                    },
                        row
                    );
                    console.log(row.TICKET_STATUS);
                    viewButton.addEventListener('click', function (e) {
                        const indexOfSimId = headers.indexOf("SIM_CARD_ID");
                        const simId = row[indexOfSimId];
                        const employeeInfoString = row.EMPLOYEE_INFO;
                        const hasEmployeeInfo = !!employeeInfoString;
                        const employeeInfo = hasEmployeeInfo
                            ? JSON.parse(employeeInfoString)
                            : ``; // Parse the JSON string into an object
                        if (indexOfSimId >= 0) {

                            Swal.fire({
                                html: `
                <form id="viewSimDetailsId" class="p-4 md:p-5">
                  <div>
                    <h3 class="font-bold text-left">View Sim Details</h1>
                    <hr class="h-px mt-2 mb-4 bg-gray-200 border-0 ">
                  <div>
                  <div class="grid gap-0 mb-4 grid-cols-4">
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        RR NO
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="rrNoId" name="RR_NO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        RR DATE
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="rrDateId" name="RR_DATE" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        COMPANY
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="companyId" name="COMPANY" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        MOBILE NO
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="mobileNoId" name="MOBILE_NO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        ACCOUNT NO
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="accountNoId" name="ACCOUNT_NO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        RFP GROUP NAME
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="rfpGroupId" name="RFP_GROUP_NAME" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        ADA
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="adaId" name="ADA" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        DUE DATE DAY
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="dueDateDayId" name="DUE_DATE_DAY" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        PLAN EFFECTIVITY
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="planEffectivityId" name="PLAN_EFFECTIVITY" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        TERMINATION DATE
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="terminationDateId" name="TERMINATION_DATE" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        LOCK IN PERIOD FROM
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="lockInPeriodFromId" name="LOCK_IN_PERIOD_FROM" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        LOCK IN PERIOD TO
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="lockInPeriodToId" name="LOCK_IN_PERIOD_TO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        PLAN ID
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="planId" name="PLAN_ID" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        NETWORK PROVIDER
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="networkProviderId" name="NETWORK_PROVIDER" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        CATEGORY
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="categoryId" name="CATEGORY" placeholder=" " class=" border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        MONTHLY RECURRING FEE
                    </div>
                    <div class="col-span-1 text-left">
                      <input disabled readonly type="text" id="monthlyRecurringFeeId" name="MONTHLY_RECURRING_FEE" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        ACTIVE NAME USER
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full p-2 ml-1">
                    
                        ${!!employeeInfo.FULL_NAME ? `${employeeInfo.FULL_NAME}` : ` `}
                    
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        PLAN DETAILS
                    </div>
                    <div class="col-span-3 text-left">
                      <input disabled readonly type="text" id="planDetailsId" name="PLAN_DETAILS" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                    </div>
                    
                  </div>
                  <div class="flex justify-end pt-2">
                    <button type="button" id="closeButtonId"
                        class="text-white inline-flex items-center bg-neutral-700 hover:bg-neutral-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                        Close
                    </button>
                  </div>
                </form>
                `,
                                showConfirmButton: false,
                                customClass: 'swal-wide',
                                showCloseButton: true,
                                allowOutsideClick: false,
                                didOpen: () => {

                                    const viewSimDetailsId = document.getElementById('viewSimDetailsId');

                                    const namedQuery = viewSimDetailsId.querySelectorAll(':is(input)[name]');
                                    const namedElements = Array.from(namedQuery);

                                    headers.forEach(header => {
                                        const targetElement = namedElements.find(element => element.name === header);

                                        if (targetElement) {
                                            targetElement.value = rowData[header];
                                        }
                                    });

                                    const closeButtonId = document.getElementById('closeButtonId');

                                    closeButtonId.addEventListener(
                                        "click",
                                        function (event) {
                                            event.preventDefault();
                                            Swal.close();
                                        }
                                    );

                                },
                            });


                        }
                    });
                    const editButton = generateActionButton(
                        vectors.edit, {
                        class: "px-2 py-2 bg-blue-500 text-white rounded ",
                    },
                        row
                    );

                    editButton.addEventListener("click", async function (e) {
                        const indexOfSimId = headers.indexOf("SIM_CARD_ID");
                        const simId = row.SIM_CARD_ID;
                        const simCardStatus = rowData.STATUS;

                        if (simId) {
                            Swal.fire({
                                html: `
                      <form id="editSimDetailsFormId" class="p-4 md:p-5">
                        <div>
                          <h3 class="font-bold text-left">Edit Sim Details</h1>
                          <hr class="h-px mt-2 mb-4 bg-gray-200 border-0 ">
                        <div>
                        <div class="grid gap-4 mb-4 grid-cols-4">
                          <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              RR NO
                          </div>
                          <div class="col-span-1 text-left">
                            <input disabled readonly type="text" id="rrNoId" name="RR_NO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                          </div>
                          <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              RR DATE
                          </div>
                          <div class="col-span-1 text-left">
                            <input disabled readonly type="text" id="rrDateId" name="RR_DATE" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                          </div>
                          <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              MOBILE NO
                          </div>
                          <div class="col-span-1 text-left">
                            <input disabled readonly type="text" id="mobileNoId" name="MOBILE_NO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                          </div>
                          <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              ACCOUNT NO
                          </div>
                          <div class="col-span-1 text-left">
                            <input disabled readonly type="text" id="accountNoId" name="ACCOUNT_NO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                          </div>
                          ${simCardStatus === "Issued"
                                        ? `
                          <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              COMPANY
                          </div>
                          <div class="col-span-3 text-left">
                            <input disabled readonly type="text" id="companyId" name="COMPANY" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                          </div>
                          <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              PLAN DETAILS
                          </div>
                          <div class="col-span-3 text-left">
                            <input disabled readonly type="text" id="planDetailsId" name="PLAN_DETAILS" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                          </div>  
                          `
                                        : `
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="planId">
                              <div class="text-sm font-semibold">Plan Id</div>
                              <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                            </label>
                            <input required list="planIds" id="planId" name="PLAN_ID" autocomplete="off"
                              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <datalist id="planIds">
                            </datalist>
                          </div>
                          <div class="col-span-3">
                            <label class="flex space-x-2" for="planDetailsId">
                              <div class="text-sm font-semibold">Plan Details</div>
                              <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                            </label>
                            <input required list="planDetailsIds" id="planDetailsId" name="PLAN_DETAILS" autocomplete="off"
                              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <datalist id="planDetailsIds">
                            </datalist>
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="categoryId">
                              <span class="text-sm font-semibold">Category</span>
                              <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                              <span class="text-red-400"> </span>
                            </label>
                            <input type="text" id="categoryId" name="CATEGORY" placeholder="Category" class=" cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="networkProviderId">
                              <span class="text-sm font-semibold">Network</span>
                              <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                              <span class="text-red-400"> </span>
                            </label>
                            <input type="text" id="networkProviderId" name="NETWORK_PROVIDER" placeholder="Network Provider" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                          </div>
                          <div class="col-span-2">
                            <label class="flex space-x-2" for="providerCompanyNameId">
                              <span class="text-sm font-semibold">Provider Company Name</span>
                              <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                              <span class="text-red-400"> </span>
                            </label>
                            <input type="text" id="providerCompanyNameId" name="PROVIDER_COMPANY_NAME" placeholder="Provider Company Name" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="monthlyRecurringFeeId">
                              <span class="text-sm font-semibold">MRF</span>
                              <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                              <span class="text-red-400"> </span>
                            </label>
                            <input type="text" id="monthlyRecurringFeeId" name="MONTHLY_RECURRING_FEE" placeholder="Monthly Recurring Fee" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                          </div>
                          <div class="col-span-2">
                            <label class="flex space-x-1" for="companyId">
                              <div class="text-sm font-semibold">Company </div>
                              <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                            </label>
                            <select id="companyId" name="COMPANY" required
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                                <option selected value="">Select Company Name</option>
                                  <option value="BDC">Borland Development Corporation</option>
                                  <option value="WFC">Westbrook Finance Corporation</option>
                                  <option value="GWDC">Greenwealth Development Corporation</option>
                                  <option value="GMDC">Golden Mahogany Development Corporation</option>
                            </select>
                          </div>
                          `
                                    }
                          ${simCardStatus === "Issued" ? ` <div class="col-span-4"><div class="grid gap-4 mb-4 grid-cols-3">` : ``}
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="rfpGroupId">
                              <div class="text-sm font-semibold">RFP Group ID</div>
                              <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                            </label>
                            <input required list="rfpGroupIds" id="rfpGroupId" name="RFP_GROUP_ID" autocomplete="off"
                              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <datalist id="rfpGroupIds">
                            </datalist>
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="rfpGroupNameId">
                              <div class="text-sm font-semibold">RFP Group Name</div>
                              <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                            </label>
                            <input required list="rfpGroupNameIds" id="rfpGroupNameId" name="RFP_GROUP_NAME" autocomplete="off"
                              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <datalist id="rfpGroupNameIds">
                            </datalist>
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="rfpCompanyId">
                              <span class="text-sm font-semibold">RFP Company</span>
                              <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                              <span class="text-red-400"> </span>
                            </label>
                            <input type="text" id="rfpCompanyId" name="RFP_COMPANY" placeholder="RFP Company" class=" cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="dueDateDayId">
                              <div class="text-sm font-semibold">Due Date Day</div>
                              <span class="bg-indigo-200 text-indigo-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                            </label>
                            <input type="text" id="dueDateDayId" name="DUE_DATE_DAY" placeholder="Due Date Day" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="planEffectivityId">
                              <div class="text-sm font-semibold">Plan Effectivity</div>
                              <span class="bg-indigo-200 text-indigo-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                            </label>
                            <input type="date" id="planEffectivityId" name="PLAN_EFFECTIVITY" placeholder="Plan Effectivity" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="terminatedDateId">
                              <div class="text-sm font-semibold">Termination Date</div>
                              <span class="bg-indigo-200 text-indigo-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                            </label>
                            <input type="date" id="terminatedDateId" name="TERMINATED_DATE" placeholder="Termination Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="lockInPeriodFromId">
                              <div class="text-sm font-semibold">Lock In Period From</div>
                              <span class="bg-indigo-200 text-indigo-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                            </label>
                            <input type="date" id="lockInPeriodFromId" name="LOCK_IN_PERIOD_FROM" placeholder="Lock In Period From" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="lockInPeriodToId">
                              <div class="text-sm font-semibold">Lock In Period To</div>
                              <span class="bg-indigo-200 text-indigo-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                            </label>
                            <input type="date" id="lockInPeriodToId" name="LOCK_IN_PERIOD_TO" placeholder="Lock In Period To" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                          </div>
                          <div class="col-span-1">
                            <label class="flex space-x-2" for="adaId">
                              <div class="text-sm font-semibold">ADA</div>
                              <span class="bg-indigo-200 text-indigo-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                            </label>
                            <div class="text-left p-1">
                            <input type="hidden" name="ADA" value="NO">
                            <input id="adaId" name="ADA" type="checkbox" value="YES" class="items-center w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <label for="adaId" class="pt-8 ms-2 text-sm">Agree and Accept</label>
                            </div>
                          </div>
                          ${simCardStatus === "Issued" ? `</div></div>` : ``}
                        </div>
                        
                        <div class="flex justify-end pt-2">
                          <button id="submitButtonId" type="submit"
                              class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                              Submit
                          </button>
                        </div>


                      </form>
                      `,
                                showConfirmButton: false,
                                customClass: "swal-wide",
                                showCloseButton: true,
                                allowOutsideClick: false,
                                didOpen: async () => {
                                    const editSimDetailsFormId = document.getElementById(
                                        "editSimDetailsFormId"
                                    );

                                    const namedQuery = editSimDetailsFormId.querySelectorAll(
                                        ":is(input, select)[name]"
                                    );
                                    const namedElements = Array.from(namedQuery);

                                    headers.forEach((header) => {
                                        const targetElement = namedElements.find(
                                            (element) => element.name === header
                                        );

                                        if (targetElement) {
                                            let value = rowData[header];

                                            // Check if the target element is a date input
                                            if (targetElement.type === "date") {
                                                // If the value is a valid date, format it using the DateTime function
                                                if (value) {
                                                    value = DateTime(value, { format: "YYYY-MM-DD" }); // Format to match input[type="date"] requirements
                                                }
                                            }

                                            // Check if the target element is a datetime-local input
                                            if (targetElement.type === "datetime-local") {
                                                if (value) {
                                                    value = DateTime(value, { format: "YYYY-MM-DDTHH:mm" }); // Format to match input[type="datetime-local"] requirements
                                                }
                                            }

                                            // Assign the value to the input field
                                            targetElement.value = value;
                                        }
                                    });

                                    if (rowData.RFP_GROUP_ID) {

                                        const rfpHeaders = [
                                            "RFP_GROUP_ID",
                                            "RFP_GROUP_NAME",
                                            "RFP_COMPANY",
                                        ];

                                        const sheetValues = await Promise.all([
                                            $.selectColumnsFromSheet("RFP_GROUP", rfpHeaders),
                                        ]);

                                        const rfpGroupIdElement = document.querySelector(
                                            'input[name="RFP_GROUP_ID"]'
                                        );
                                        const rfpGroupIdDatalist = document.getElementById(
                                            rfpGroupIdElement.getAttribute("list")
                                        );
                                        const rfpGroupNameElement = document.querySelector(
                                            'input[name="RFP_GROUP_NAME"]'
                                        );
                                        const rfpGroupNameDatalist = document.getElementById(
                                            rfpGroupNameElement.getAttribute("list")
                                        );
                                        const rfpCompanyElement = document.querySelector(
                                            'input[name="RFP_COMPANY"]'
                                        );

                                        const [rfpDetails] = sheetValues.map((json) =>
                                            JSON.parse(json)
                                        );

                                        const mappedRFPDetails = {};

                                        const rfpGroupIdFragment = new DocumentFragment();
                                        const rfpGroupNameFragment = new DocumentFragment();

                                        rfpDetails.forEach((row) => {
                                            const data = row.reduce((acc, cell, cellIndex) => {
                                                const header = rfpHeaders[cellIndex];
                                                acc[header] = cell;
                                                return acc;
                                            }, {});

                                            const {
                                                RFP_GROUP_ID,
                                                RFP_GROUP_NAME,
                                                RFP_COMPANY,
                                            } = data;

                                            if (!mappedRFPDetails[RFP_GROUP_NAME]) {
                                                mappedRFPDetails[RFP_GROUP_NAME] = {
                                                    rfpGroupId: RFP_GROUP_ID,
                                                    rfpCompany: RFP_COMPANY,
                                                };

                                                const rfpGroupNameOption = document.createElement("option");
                                                rfpGroupNameOption.value = RFP_GROUP_NAME;
                                                rfpGroupNameOption.textContent = RFP_GROUP_NAME;
                                                rfpGroupNameFragment.appendChild(rfpGroupNameOption);
                                            }

                                            mappedRFPDetails[RFP_GROUP_ID] = {
                                                rfpGroupName: RFP_GROUP_NAME,
                                                rfpCompany: RFP_COMPANY,
                                            };

                                            const rfpGroupIdOption = document.createElement("option");
                                            rfpGroupIdOption.value = RFP_GROUP_ID;
                                            rfpGroupIdOption.textContent = RFP_GROUP_ID;
                                            rfpGroupIdFragment.appendChild(rfpGroupIdOption);
                                        });

                                        rfpGroupIdDatalist.appendChild(rfpGroupIdFragment);
                                        rfpGroupNameDatalist.appendChild(rfpGroupNameFragment);

                                        rfpGroupIdElement.addEventListener("change", function () {
                                            const rfpGroupId = this.value;
                                            const details = mappedRFPDetails[rfpGroupId] || {};

                                            rfpGroupNameElement.value = details.rfpGroupName || "";
                                            rfpCompanyElement.value = details.rfpCompany || "";
                                        });

                                        rfpGroupNameElement.addEventListener("change", function () {
                                            const rfpGroupName = this.value;
                                            const details = mappedRFPDetails[rfpGroupName] || {};

                                            rfpGroupIdElement.value = details.rfpGroupId || "";
                                            rfpCompanyElement.value = details.rfpCompany || "";
                                        });
                                    } else {
                                        console.log("RF_GROUP_ID must have a value, no need to load the data.");
                                    }

                                    if (rowData.STATUS === 'Available') {
                                        const planHeaders = [
                                            "PLAN_ID",
                                            "PLAN_DETAILS",
                                            "CATEGORY",
                                            "NETWORK_PROVIDER",
                                            "PROVIDER_COMPANY_NAME",
                                            "MONTHLY_RECURRING_FEE",
                                        ];

                                        const sheetValues = await Promise.all([
                                            $.selectColumnsFromSheet("SIM_PLANS", planHeaders)
                                        ]);

                                        const planIdElement = document.querySelector(
                                            'input[name="PLAN_ID"]'
                                        );
                                        const planIdDatalist = document.getElementById(
                                            planIdElement.getAttribute("list")
                                        );
                                        const planDetailsElement = document.querySelector(
                                            'input[name="PLAN_DETAILS"]'
                                        );
                                        const planDetailsDatalist = document.getElementById(
                                            planDetailsElement.getAttribute("list")
                                        );
                                        const categoryElement = document.querySelector(
                                            'input[name="CATEGORY"]'
                                        );
                                        const networkProviderElement = document.querySelector(
                                            'input[name="NETWORK_PROVIDER"]'
                                        );
                                        const providerCompanyNameElement = document.querySelector(
                                            'input[name="PROVIDER_COMPANY_NAME"]'
                                        );
                                        const monthlyRecurringFeeElement = document.querySelector(
                                            'input[name="MONTHLY_RECURRING_FEE"]'
                                        );

                                        const [simPlanDetails] = sheetValues.map((json) =>
                                            JSON.parse(json)
                                        );

                                        console.log([simPlanDetails])

                                        const mappedSimPlanDetails = {};

                                        const planIdFragment = new DocumentFragment();
                                        const planDetailsFragment = new DocumentFragment();

                                        simPlanDetails.forEach((row) => {
                                            const data = row.reduce((acc, cell, cellIndex) => {
                                                const header = planHeaders[cellIndex];
                                                acc[header] = cell;
                                                return acc;
                                            }, {});

                                            const {
                                                PLAN_ID,
                                                PLAN_DETAILS,
                                                CATEGORY,
                                                NETWORK_PROVIDER,
                                                PROVIDER_COMPANY_NAME,
                                                MONTHLY_RECURRING_FEE,
                                            } = data;

                                            if (!mappedSimPlanDetails[PLAN_DETAILS]) {
                                                mappedSimPlanDetails[PLAN_DETAILS] = {
                                                    planId: PLAN_ID,
                                                    category: CATEGORY,
                                                    networkProvider: NETWORK_PROVIDER,
                                                    providerCompanyName: PROVIDER_COMPANY_NAME,
                                                    monthlyRecurringFee: MONTHLY_RECURRING_FEE,
                                                };

                                                const planDetailsOption = document.createElement("option");
                                                planDetailsOption.value = PLAN_DETAILS;
                                                planDetailsOption.textContent = PLAN_DETAILS;
                                                planDetailsFragment.appendChild(planDetailsOption);
                                            }

                                            mappedSimPlanDetails[PLAN_ID] = {
                                                planDetails: PLAN_DETAILS,
                                                category: CATEGORY,
                                                networkProvider: NETWORK_PROVIDER,
                                                providerCompanyName: PROVIDER_COMPANY_NAME,
                                                monthlyRecurringFee: MONTHLY_RECURRING_FEE,
                                            };

                                            const planIdOption = document.createElement("option");
                                            planIdOption.value = PLAN_ID;
                                            planIdOption.textContent = PLAN_ID;
                                            planIdFragment.appendChild(planIdOption);
                                        });

                                        planDetailsDatalist.appendChild(planDetailsFragment);
                                        planIdDatalist.appendChild(planIdFragment);

                                        // Event listener for Group ID dropdown
                                        planDetailsElement.addEventListener("change", function () {
                                            const planDetails = this.value;
                                            const details = mappedSimPlanDetails[planDetails] || {};

                                            planIdElement.value = details.planId || "";
                                            categoryElement.value = details.category || "";
                                            networkProviderElement.value = details.networkProvider || "";
                                            providerCompanyNameElement.value =
                                                details.providerCompanyName || "";
                                            monthlyRecurringFeeElement.value =
                                                details.monthlyRecurringFee || "";
                                        });

                                        // Event listener for Employee Name dropdown
                                        planIdElement.addEventListener("change", function () {
                                            const planId = this.value;
                                            const details = mappedSimPlanDetails[planId] || {};

                                            planDetailsElement.value = details.planDetails || "";
                                            categoryElement.value = details.category || "";
                                            networkProviderElement.value = details.networkProvider || "";
                                            providerCompanyNameElement.value =
                                                details.providerCompanyName || "";
                                            monthlyRecurringFeeElement.value =
                                                details.monthlyRecurringFee || "";
                                        });

                                    } else {
                                        console.log("SIM_CARD_ID status must be available.");
                                    }

                                    let isSubmitted = false;

                                    editSimDetailsFormId.addEventListener(
                                        "submit",
                                        async function (event) {
                                            event.preventDefault();

                                            const submitButtonId = document.getElementById("submitButtonId");

                                            submitButtonId.innerHTML = 'Submitting <span class="AnimatedEllipsis"></span>';

                                            submitButtonId.disabled = true;
                                            submitButtonId.classList.add('cursor-not-allowed', 'opacity-50');

                                            const swalCloseButton = Swal.getCloseButton();
                                            if (swalCloseButton) {
                                                swalCloseButton.disabled = true;
                                            }


                                            if (isSubmitted) {
                                                return;
                                            }

                                            isSubmitted = true;

                                            try {
                                                const formData = new FormData(this);
                                                const formObject = Object.fromEntries(formData);
                                                const query = {
                                                    SIM_CARD_ID: row.SIM_CARD_ID
                                                };
                                                const isEdited = await $.editDataToSimInventory(
                                                    query,
                                                    formObject
                                                );



                                                if (isEdited) {
                                                    await initializeTable();
                                                    Swal.close();

                                                    toast.success({
                                                        title: "Record Update Success",
                                                        description: "The record has been updated succesfully",
                                                        timeout: 4000,

                                                    })

                                                } else {
                                                    toast.error({
                                                        title: "Record Update Failed",
                                                        description: "Failed to update the record. Please try again.",
                                                        timeout: 4000,

                                                    })
                                                }
                                            } catch (error) {
                                                console.error(error);
                                            } finally {
                                                isSubmitted = false; // Reset the submission lock
                                            }
                                        }
                                    );
                                },
                            });
                        }
                    });

                    const status = rowData.STATUS;
                    const ticketStatus = row.TICKET_STATUS;
                    const hasTicket = ticketStatus === "Pending";
                    const isIssued = status === "Issued";
                    const isReserved = status === "Reserved";
                    const deleteButton = document.createElement("button");
                    deleteButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>
                `;
                    deleteButton.classList.add(
                        "px-2",
                        "py-2",
                        "bg-red-500",
                        "text-white",
                        "rounded"
                    );

                    if (isIssued || isReserved || hasTicket) {
                        deleteButton.disabled = true;
                        deleteButton.classList.add("opacity-50", "cursor-not-allowed");
                    }

                    deleteButton.addEventListener("click", function (e) {
                        const indexOfSimId = headers.indexOf("SIM_CARD_ID");
                        const simId = row.SIM_CARD_ID;
                        Swal.fire({
                            title: "Are you sure?",
                            text: `You won't be able to revert Plan ID ${rowData.SIM_CARD_ID}!`,
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#3085d6",
                            cancelButtonColor: "#d33",
                            confirmButtonText: `Yes, delete Plan ID ${rowData.SIM_CARD_ID}!`,
                            allowOutsideClick: false,
                            preConfirm: async () => {
                                try {

                                    const query = { SIM_CARD_ID: simId };
                                    const isDeleted = await $.deleteDataToSimInventory(query);

                                    if (isDeleted) {
                                        await initializeTable();
                                        toast.success({
                                            title: "Record Deletion Success",
                                            description: "The record has been deleted successfully.",
                                            timeout: 4000,
                                        });
                                        return true;
                                    } else {
                                        toast.error({
                                            title: "Record Deletion Failed",
                                            description: "Failed to delete the record. Please try again.",
                                            timeout: 4000,
                                        });
                                        return false;
                                    }
                                } catch (error) {
                                    toast.error({
                                        title: "Record Deletion Failed",
                                        description: "Failed to delete the record. Please try again.",
                                        timeout: 4000,
                                    });
                                    return false;
                                }
                            }
                        });
                    });

                    actionDiv.appendChild(viewButton);
                    actionDiv.appendChild(editButton);
                    actionDiv.appendChild(deleteButton);
                    actionTd.appendChild(actionDiv);
                    tr.appendChild(actionTd);

                    tbody.appendChild(tr);
                });
            }

            const table = document.getElementById("tablejs");
            const instance = new TableJS(table, {
                dataset: {
                    init: false,
                    collection: Array.from({
                        length: 1
                    }, () =>
                        headers.reduce((acc, item) => ({
                            ...acc,
                            [item]: "No data "
                        }))
                    ),
                    rendering: renderTable,
                },
                colvis: {
                    element: "div#table-colvis",
                    exclude: [
                        ".checkbox-column",
                        ".actions-column",
                        '[data-header-name="PLAN_DETAILS"]',
                    ],
                    hide: ['[data-header-name="PLAN_DETAILS"]'],
                },
                exportAs: [{
                    as: "csv",
                    element: "button#export-csv",
                    filename: "check",
                    exclude: [".checkbox-column", ".actions-column"],
                },],
                paginate: [{
                    to: "api",
                    as: "limit",
                    element: "select#pagination-limit",
                    output: output.pagination,
                },
                {
                    to: "api",
                    as: "next",
                    element: "button#pagination-next",
                    output: output.pagination,
                },
                {
                    to: "api",
                    as: "previous",
                    element: "button#pagination-previous",
                    output: output.pagination,
                },
                {
                    to: "local",
                    as: "search",
                    element: "input#pagination-search",
                    exclude: [".checkbox-column", ".actions-column"],
                    output: output.pagination,
                },
                ],
            });

            async function initializeTable() {
                try {
                    const dataset = await $.getConsolidatedSimInventory(headers);
                    console.warn({
                        dataset
                    });

                    const parsed = JSON.parse(dataset);
                    const array = Array.from(parsed);
                    console.warn({
                        array
                    });
                    instance.setDataset(array).render();
                } catch (error) {
                    console.error(error);
                }
            }

            document
                .getElementById("upload-modal-toggle")
                .addEventListener("click", function () {
                    Swal.fire({
                        html: `
                    <form id="upload-csv-form" class="p-4 md:p-5">
                        <div>
                            <h3 class="font-bold text-left">Upload Sim Details File</h3> <!-- Changed </h1> to </h3> -->
                            <hr class="h-px mt-2 mb-4 bg-gray-200 border-0">
                        </div>
                        <div class="flex items-center w-full p-4">
                            <label for="dropzone-file"
                                class="flex flex-col items-center p-4 justify-center w-full border-2 h-full border-neutral-300 border-dashed rounded-lg cursor-pointer bg-neutral-50 hover:bg-neutral-100">
                                <div class="flex flex-col items-center justify-center pt-10 pb-6">
                                    <svg class="w-8 h-8 mb-4 text-neutral-500" aria-hidden="true"
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2" />
                                    </svg>
                                    <p class="mb-2 text-sm text-neutral-500">
                                        <span class="font-semibold" id="primary-text">Click to upload XLSX</span>
                                    </p>
                                    <p class="text-xs text-neutral-500">
                                        <span id="secondary-text">(Maximum size of 10mb)</span>
                                    </p>
                                    <input required id="dropzone-file" type="file" accept=".xlsx" class="opacity-0" />
                                </div>
                            </label>
                        </div>
                        <div class="flex justify-end pt-2 pr-4">
                            <div class="grid grid-cols-3 gap-2">
                                <div class="cols-span-1 w-full">
                                    <button type="reset"
                                        class="text-white items-center text-center bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 w-full">
                                        Reset
                                    </button>
                                </div>
                                <div class="cols-span-1 w-full">
                                    <button type="button" id="download-template"
                                        class="text-white items-center text-center bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 w-full">
                                        Template
                                    </button>
                                </div>
                                <div class="cols-span-1 w-full">
                                    <button type="submit"
                                        class="text-white items-center text-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 w-full">
                                        Submit
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                `,
                        showConfirmButton: false,
                        customClass: "swal-wide",
                        showCloseButton: true,
                        allowOutsideClick: false,
                        didOpen: async () => {
                            const MaxBatchSize = 1000;
                            const MaxFileSize = 10 * Math.pow(1024, 2);
                            const dropzoneFile = document.querySelector(
                                "input#dropzone-file"
                            );
                            const uploadCSVForm = document.querySelector(
                                "form#upload-csv-form"
                            );
                            const templateButton =
                                document.getElementById("download-template");
                            const text = {
                                primary: document.querySelector("span#primary-text"),
                                secondary: document.querySelector("span#secondary-text"),
                            };
                            const init = () => {
                                const allowedTypes = dropzoneFile.accept
                                    .replace(/[\s.]/g, "")
                                    .split(",")
                                    .map((item) => item.toUpperCase())
                                    .join("/");
                                text.primary.textContent = `Click to upload ${allowedTypes}`;
                                text.secondary.textContent = `(Maximum size of ${toFileSize(MaxFileSize)})`;
                                dropzoneFile.value = "";
                            };
                            const MimeType = {
                                Excel: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                                Csv: "text/csv",
                            };

                            templateButton.addEventListener("click", async function () {
                                const file_id = "1Qj5y1o00oUarvqL9ancskAgUhnzkvDJ1";
                                const download_url =
                                    `https://docs.google.com/spreadsheets/d/${file_id}/export?format=xlsx`;
                                try {
                                    const response = await fetch(download_url);
                                    if (!response.ok)
                                        throw new Error("Network response was not ok");
                                    const blob = await response.blob();
                                    saveAs(blob, "Sim-Inventory-Template.xlsx");
                                } catch (error) {
                                    console.error("Error downloading the file:", error);
                                }
                            });

                            dropzoneFile.addEventListener("change", function (e) {
                                const [file] = this.files;
                                if (file) {
                                    if (file.size <= MaxFileSize) {
                                        text.primary.textContent = file.name;
                                        text.secondary.textContent = toFileSize(file.size);
                                    } else {
                                        this.value = "";
                                        text.primary.textContent = "Invalid file size";
                                        text.secondary.textContent = `(File size must be less than ${toFileSize(MaxFileSize)})`;
                                    }
                                }
                            });

                            uploadCSVForm.addEventListener("reset", init);
                            uploadCSVForm.addEventListener("submit", function (e) {
                                e.preventDefault();

                                const submitBtn = this.querySelector('[type="submit"]');
                                if (submitBtn) {
                                    submitBtn.disabled = true;
                                    setTimeout(() => {
                                        submitBtn.disabled = false;
                                    }, 3000);
                                }

                                const files = dropzoneFile.files;
                                if (files.length > 0) {
                                    const file = files[0];
                                    const reader = new FileReader();
                                    reader.readAsBinaryString(file);

                                    reader.onload = async function () {
                                        const data = this.result;
                                        let json;

                                        switch (file.type) {
                                            case MimeType.Csv:
                                                // Handle CSV files if needed
                                                break;
                                            case MimeType.Excel:
                                                const workbook = XLSX.read(data, {
                                                    type: "binary"
                                                });
                                                const sheetNames = workbook.SheetNames;
                                                let sheetName = "SIM_INVENTORY";
                                                if (!sheetNames.includes(sheetName)) {
                                                    sheetName = sheetNames[0];
                                                }
                                                const sheet = workbook.Sheets[sheetName];
                                                const json = XLSX.utils.sheet_to_json(sheet, {
                                                    dateNF: "mm/dd/yyyy",
                                                    header: 1,
                                                });

                                                const [, headers, ...values] = json;

                                                // Ensure headers are strings and trim any whitespace
                                                const trimmedHeaders = headers.map((header) =>
                                                    typeof header === "string" ? header.trim() : header
                                                );

                                                if (
                                                    trimmedHeaders.length === 0 ||
                                                    values.length === 0
                                                ) {
                                                    throw new Error(
                                                        "Invalid data format of the uploaded file"
                                                    );
                                                }

                                                const batch = toChunk(values, MaxBatchSize);
                                                const length = batch.length;

                                                const result = [];

                                                for (let index = 0; index < length; index++) {
                                                    try {

                                                        const upsertResult =
                                                            await $.insertUploadSimInventoryFile({
                                                                headers,
                                                                values,
                                                            });

                                                        const skippedRows = upsertResult.skippedRows;

                                                        const skippedRowsData = skippedRows.reduce((acc, { mobileNo, planId, rowIndex }) => {
                                                            acc[`Row ${rowIndex}`] = { "Mobile No": mobileNo, "Plan Id": planId };
                                                            return acc;
                                                        }, {});

                                                        const description = JSON.stringify(skippedRowsData, null, 4);

                                                        Swal.close();

                                                        if (upsertResult.inserted > 0) {
                                                            if (upsertResult.skipped > 0) {
                                                                toast.success({
                                                                    title: "Record Upload with Skipped Rows",
                                                                    description: "Copy the skipped rows to clipboard.",
                                                                    action: ({ onClose }) => {
                                                                        const button = document.createElement("button");
                                                                        const textToCopy = `${description}`;
                                                                        button.classList.add(
                                                                            "border",
                                                                            "text-[10px]",
                                                                            "rounded-lg",
                                                                            "shadow-sm",
                                                                            "p-1",
                                                                            "bg-white-50",
                                                                            "hover:bg-neutral-100"
                                                                        );
                                                                        button.innerText = "Copy";
                                                                        button.addEventListener("click", async (event) => {
                                                                            try {
                                                                                await navigator.clipboard.writeText(textToCopy);
                                                                                toast.success({
                                                                                    title: "Copy Success!",
                                                                                    description: "Text copied to clipboard",
                                                                                    timeout: 3000
                                                                                });
                                                                            } catch (err) {
                                                                                console.error("Failed to copy text: ", err);
                                                                            }
                                                                            onClose();
                                                                        });
                                                                        return button;
                                                                    },
                                                                });
                                                                initializeTable();
                                                            }
                                                            else {
                                                                toast.success({
                                                                    title: "Record Upload Success",
                                                                    description: "The record has been uploaded succesfully",
                                                                    timeout: 4000,

                                                                });
                                                                initializeTable();
                                                            }

                                                        } else {
                                                            toast.error({
                                                                title: "Record Upload Failed",
                                                                description: "The record could not be uploaded. Please try again.",
                                                                timeout: 4000,
                                                            });
                                                        }
                                                        initializeTable();
                                                    } catch (error) {
                                                        console.error(error);
                                                    }
                                                }
                                                break;

                                            default:
                                                break;
                                        }
                                    };
                                }
                            });

                            init();
                        },
                    });
                });

            document
                .getElementById("add-modal-toggle")
                .addEventListener("click", function () {
                    Swal.fire({
                        html: `
                  <form id="addSimDetailsFormId" class="p-4 md:p-5">
                    <div>
                      <h3 class="font-bold text-left">Add Sim Details</h1>
                      <hr class="h-px mt-2 mb-4 bg-gray-200 border-0 ">
                    <div>
                    <div class="grid gap-4 mb-4 grid-cols-4">
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="rrNoId">
                          <div class="text-sm font-semibold">RR No</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required type="number" id="rrNoId" name="RR_NO" placeholder="RR No" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="rrDateId">
                          <div class="text-sm font-semibold">RR Date</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required type="date" id="rrDateId" name="RR_DATE" placeholder="RR Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="mobileNoId">
                          <div class="text-sm font-semibold">Mobile No</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required type="number" id="mobileNoId" name="MOBILE_NO"  placeholder="9XXYYYZZZZ" pattern="\d{3}-\d{3}-\d{4}" maxlength="12" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="accountNoId">
                          <div class="text-sm font-semibold">Account No</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required type="number" id="accountNoId" name="ACCOUNT_NO" placeholder="Account No" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="adaId">
                          <div class="text-sm font-semibold">ADA</div>
                          <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                        </label>
                        <div class="text-left p-1">
                        <input type="hidden" name="ADA" value="NO">
                        <input id="adaId" name="ADA" type="checkbox" value="YES" class="items-center w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="adaId" class="pt-8 ms-2 text-sm">Agree and Accept</label>
                        </div>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-1" for="companyId">
                          <div class="text-sm font-semibold">Company </div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <select id="companyId" name="COMPANY" required
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <option selected value="">Select Company Name</option>
                              <option value="BDC">Borland Development Corporation</option>
                              <option value="WFC">Westbrook Finance Corporation</option>
                              <option value="GWDC">Greenwealth Development Corporation</option>
                              <option value="GMDC">Golden Mahogany Development Corporation</option>
                        </select>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="dueDateDayId">
                          <div class="text-sm font-semibold">Due Date Day</div>
                          <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                        </label>
                        <input type="text" id="dueDateDayId" name="DUE_DATE_DAY" placeholder="Due Date Day" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="planEffectivityId">
                          <div class="text-sm font-semibold">Plan Effectivity</div>
                          <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                        </label>
                        <input type="date" id="planEffectivityId" name="PLAN_EFFECTIVITY" placeholder="Plan Effectivity" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="terminatedDateId">
                          <div class="text-sm font-semibold">Termination Date</div>
                          <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                        </label>
                        <input type="date" id="terminatedDateId" name="TERMINATED_DATE" placeholder="Termination Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="lockInPeriodFromId">
                          <div class="text-sm font-semibold">Lock In Period From</div>
                          <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                        </label>
                        <input type="date" id="lockInPeriodFromId" name="LOCK_IN_PERIOD_FROM" placeholder="Lock In Period From" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="lockInPeriodToId">
                          <div class="text-sm font-semibold">Lock In Period To</div>
                          <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                        </label>
                        <input type="date" id="lockInPeriodToId" name="LOCK_IN_PERIOD_TO" placeholder="Lock In Period To" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>

                      <div class="col-span-4">
                        <div class="inline-flex items-center justify-center w-full">
                            <hr class="w-full h-px bg-gray-300 border-0">
                            <span class="absolute px-3 font-medium text-xs text-gray-500 -translate-x-1/2 bg-white left-1/2">Plan Information</span>
                        </div>
                      </div>

                      <div class="col-span-1">
                        <label class="flex space-x-2" for="rfpGroupId">
                          <div class="text-sm font-semibold">RFP Group ID</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required list="rfpGroupIds" id="rfpGroupId" name="RFP_GROUP_ID" autocomplete="off"
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                        <datalist id="rfpGroupIds">
                        </datalist>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="rfpGroupNameId">
                          <div class="text-sm font-semibold">RFP Group Name</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required list="rfpGroupNameIds" id="rfpGroupNameId" name="RFP_GROUP_NAME" autocomplete="off"
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                        <datalist id="rfpGroupNameIds">
                        </datalist>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="rfpCompanyId">
                          <span class="text-sm font-semibold">RFP Company</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="rfpCompanyId" name="RFP_COMPANY" placeholder="RFP Company" class=" cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="planId">
                          <div class="text-sm font-semibold">Plan Id</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required list="planIds" id="planId" name="PLAN_ID" autocomplete="off"
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                        <datalist id="planIds">
                        </datalist>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="planDetailsId">
                          <div class="text-sm font-semibold">Plan Details</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required list="planDetailsIds" id="planDetailsId" name="PLAN_DETAILS" autocomplete="off"
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                        <datalist id="planDetailsIds">
                        </datalist>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="categoryId">
                          <span class="text-sm font-semibold">Category</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="categoryId" name="CATEGORY" placeholder="Category" class=" cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="networkProviderId">
                          <span class="text-sm font-semibold">Network</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="networkProviderId" name="NETWORK_PROVIDER" placeholder="Network Provider" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="providerCompanyNameId">
                          <span class="text-sm font-semibold">Provider Company Name</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="providerCompanyNameId" name="PROVIDER_COMPANY_NAME" placeholder="Provider Company Name" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="monthlyRecurringFeeId">
                          <span class="text-sm font-semibold">MRF</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="monthlyRecurringFeeId" name="MONTHLY_RECURRING_FEE" placeholder="Monthly Recurring Fee" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <input type="hidden" name="STATUS" value="Available">
                    </div>
                    <div class="flex justify-end pt-2">
                      <button id="submitButtonId" type="submit"
                          class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                          Submit
                      </button>
                    </div>
                  </form>
                `,
                        showConfirmButton: false,
                        customClass: "swal-wide",
                        showCloseButton: true,
                        allowOutsideClick: false,
                        didOpen: async () => {
                            const addSimDetailsFormId = document.getElementById(
                                "addSimDetailsFormId"
                            );

                            const planHeaders = [
                                "PLAN_ID",
                                "PLAN_DETAILS",
                                "CATEGORY",
                                "NETWORK_PROVIDER",
                                "PROVIDER_COMPANY_NAME",
                                "MONTHLY_RECURRING_FEE",
                            ];

                            const rfpHeaders = [
                                "RFP_GROUP_ID",
                                "RFP_GROUP_NAME",
                                "RFP_COMPANY",
                            ];

                            const sheetValues = await Promise.all([
                                $.selectColumnsFromSheet("SIM_PLANS", planHeaders),
                                $.selectColumnsFromSheet("RFP_GROUP", rfpHeaders),
                            ]);

                            console.log(sheetValues)

                            const planIdElement = document.querySelector(
                                'input[name="PLAN_ID"]'
                            );
                            const planIdDatalist = document.getElementById(
                                planIdElement.getAttribute("list")
                            );
                            const planDetailsElement = document.querySelector(
                                'input[name="PLAN_DETAILS"]'
                            );
                            const planDetailsDatalist = document.getElementById(
                                planDetailsElement.getAttribute("list")
                            );
                            const categoryElement = document.querySelector(
                                'input[name="CATEGORY"]'
                            );
                            const networkProviderElement = document.querySelector(
                                'input[name="NETWORK_PROVIDER"]'
                            );
                            const providerCompanyNameElement = document.querySelector(
                                'input[name="PROVIDER_COMPANY_NAME"]'
                            );
                            const monthlyRecurringFeeElement = document.querySelector(
                                'input[name="MONTHLY_RECURRING_FEE"]'
                            );

                            const rfpGroupIdElement = document.querySelector(
                                'input[name="RFP_GROUP_ID"]'
                            );
                            const rfpGroupIdDatalist = document.getElementById(
                                rfpGroupIdElement.getAttribute("list")
                            );
                            const rfpGroupNameElement = document.querySelector(
                                'input[name="RFP_GROUP_NAME"]'
                            );
                            const rfpGroupNameDatalist = document.getElementById(
                                rfpGroupNameElement.getAttribute("list")
                            );
                            const rfpCompanyElement = document.querySelector(
                                'input[name="RFP_COMPANY"]'
                            );

                            const [simPlanDetails, rfpDetails] = sheetValues.map((json) =>
                                JSON.parse(json)
                            );

                            console.log([simPlanDetails, rfpDetails])

                            const mappedSimPlanDetails = {};
                            const mappedRFPDetails = {};

                            const planIdFragment = new DocumentFragment();
                            const planDetailsFragment = new DocumentFragment();

                            const rfpGroupIdFragment = new DocumentFragment();
                            const rfpGroupNameFragment = new DocumentFragment();

                            simPlanDetails.forEach((row) => {
                                const data = row.reduce((acc, cell, cellIndex) => {
                                    const header = planHeaders[cellIndex];
                                    acc[header] = cell;
                                    return acc;
                                }, {});

                                const {
                                    PLAN_ID,
                                    PLAN_DETAILS,
                                    CATEGORY,
                                    NETWORK_PROVIDER,
                                    PROVIDER_COMPANY_NAME,
                                    MONTHLY_RECURRING_FEE,
                                } = data;

                                if (!mappedSimPlanDetails[PLAN_DETAILS]) {
                                    mappedSimPlanDetails[PLAN_DETAILS] = {
                                        planId: PLAN_ID,
                                        category: CATEGORY,
                                        networkProvider: NETWORK_PROVIDER,
                                        providerCompanyName: PROVIDER_COMPANY_NAME,
                                        monthlyRecurringFee: MONTHLY_RECURRING_FEE,
                                    };

                                    const planDetailsOption = document.createElement("option");
                                    planDetailsOption.value = PLAN_DETAILS;
                                    planDetailsOption.textContent = PLAN_DETAILS;
                                    planDetailsFragment.appendChild(planDetailsOption);
                                }

                                mappedSimPlanDetails[PLAN_ID] = {
                                    planDetails: PLAN_DETAILS,
                                    category: CATEGORY,
                                    networkProvider: NETWORK_PROVIDER,
                                    providerCompanyName: PROVIDER_COMPANY_NAME,
                                    monthlyRecurringFee: MONTHLY_RECURRING_FEE,
                                };

                                const planIdOption = document.createElement("option");
                                planIdOption.value = PLAN_ID;
                                planIdOption.textContent = PLAN_ID;
                                planIdFragment.appendChild(planIdOption);
                            });

                            planDetailsDatalist.appendChild(planDetailsFragment);
                            planIdDatalist.appendChild(planIdFragment);

                            console.log(simPlanDetails)

                            // Event listener for Group ID dropdown
                            planDetailsElement.addEventListener("change", function () {
                                const planDetails = this.value;
                                const details = mappedSimPlanDetails[planDetails] || {};

                                planIdElement.value = details.planId || "";
                                categoryElement.value = details.category || "";
                                networkProviderElement.value = details.networkProvider || "";
                                providerCompanyNameElement.value =
                                    details.providerCompanyName || "";
                                monthlyRecurringFeeElement.value =
                                    details.monthlyRecurringFee || "";
                            });

                            // Event listener for Employee Name dropdown
                            planIdElement.addEventListener("change", function () {
                                const planId = this.value;
                                const details = mappedSimPlanDetails[planId] || {};

                                planDetailsElement.value = details.planDetails || "";
                                categoryElement.value = details.category || "";
                                networkProviderElement.value = details.networkProvider || "";
                                providerCompanyNameElement.value =
                                    details.providerCompanyName || "";
                                monthlyRecurringFeeElement.value =
                                    details.monthlyRecurringFee || "";
                            });

                            rfpDetails.forEach((row) => {
                                const data = row.reduce((acc, cell, cellIndex) => {
                                    const header = rfpHeaders[cellIndex];
                                    acc[header] = cell;
                                    return acc;
                                }, {});

                                const {
                                    RFP_GROUP_ID,
                                    RFP_GROUP_NAME,
                                    RFP_COMPANY,
                                } = data;

                                if (!mappedRFPDetails[RFP_GROUP_NAME]) {
                                    mappedRFPDetails[RFP_GROUP_NAME] = {
                                        rfpGroupId: RFP_GROUP_ID,
                                        rfpCompany: RFP_COMPANY,
                                    };

                                    const rfpGroupNameOption = document.createElement("option");
                                    rfpGroupNameOption.value = RFP_GROUP_NAME;
                                    rfpGroupNameOption.textContent = RFP_GROUP_NAME;
                                    rfpGroupNameFragment.appendChild(rfpGroupNameOption);
                                }

                                mappedRFPDetails[RFP_GROUP_ID] = {
                                    rfpGroupName: RFP_GROUP_NAME,
                                    rfpCompany: RFP_COMPANY,
                                };

                                const rfpGroupIdOption = document.createElement("option");
                                rfpGroupIdOption.value = RFP_GROUP_ID;
                                rfpGroupIdOption.textContent = RFP_GROUP_ID;
                                rfpGroupIdFragment.appendChild(rfpGroupIdOption);
                            });

                            rfpGroupIdDatalist.appendChild(rfpGroupIdFragment);
                            rfpGroupNameDatalist.appendChild(rfpGroupNameFragment);

                            rfpGroupIdElement.addEventListener("change", function () {
                                const rfpGroupId = this.value;
                                const details = mappedRFPDetails[rfpGroupId] || {};

                                rfpGroupNameElement.value = details.rfpGroupName || "";
                                rfpCompanyElement.value = details.rfpCompany || "";
                            });

                            rfpGroupNameElement.addEventListener("change", function () {
                                const rfpGroupName = this.value;
                                const details = mappedRFPDetails[rfpGroupName] || {};

                                rfpGroupIdElement.value = details.rfpGroupId || "";
                                rfpCompanyElement.value = details.rfpCompany || "";
                            });
                            console.log(rfpDetails)

                            let isSubmitted = false;

                            addSimDetailsFormId.addEventListener(
                                "submit",
                                async function (event) {
                                    event.preventDefault();
                                    const submitButtonId = document.getElementById("submitButtonId");

                                    submitButtonId.innerHTML = 'Submitting <span class="AnimatedEllipsis"></span>';

                                    submitButtonId.disabled = true;
                                    submitButtonId.classList.add('cursor-not-allowed', 'opacity-50');

                                    const swalCloseButton = Swal.getCloseButton();
                                    if (swalCloseButton) {
                                        swalCloseButton.disabled = true;
                                    }

                                    if (isSubmitted) {
                                        return;
                                    }

                                    isSubmitted = true;
                                    try {
                                        const formData = new FormData(this);
                                        const formObject = Object.fromEntries(formData);

                                        const isInserted = await $.insertDataToSimInventory(
                                            formObject
                                        );


                                        if (isInserted) {
                                            await initializeTable();
                                            Swal.close();

                                            toast.success({
                                                title: "Record Insertion Success",
                                                description: "The record has been inserted succesfully",
                                                timeout: 4000,

                                            });

                                        } else {
                                            toast.error({
                                                title: "Record Insertion Failed",
                                                description: "The record could not be inserted. Please try again.",
                                                timeout: 4000,

                                            });
                                        }
                                    } catch (error) {
                                        console.error(error);
                                    } finally {
                                        isSubmitted = false; // Reset the submission lock
                                    }
                                }
                            );
                        },
                    });
                });
            initializeTable();
        });

        function toChunk(arr, batchSize = MaxBatchSize) {
            const batches = [];
            for (let i = 0; i < arr.length; i += batchSize) {
                const batch = arr.slice(i, i + batchSize);
                batches.push(batch);
            }
            return batches;
        }

        function toFileSize(bytes) {
            const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
            if (bytes === 0) {
                return "0 Byte";
            }
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return (bytes / Math.pow(1024, i)).toFixed(2) + " " + sizes[i];
        }

        function clsx(classes) {
            return classes.split("");
        }

        document.getElementById("sim-card").classList.remove("hidden");

        // SAVE STATE
    </script>
</body>

</html>