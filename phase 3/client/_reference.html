<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <link href="https://rawcdn.githack.com/shinxzxzxz/TableJS/c8218ba13b4d74c34af06f9f25d5063b6a99956f/tablejs.css"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer type="module"
        src="https://rawcdn.githack.com/shinxzxzxz/TableJS/55597d91c8f5165cdfaaf90798bc2e0e886a42e8/tablejs.js"></script>
    <!-- <script defer type="module"
        src="https://rawcdn.githack.com/shinxzxzxz/TableJs-v2/fa9f1e82cf2595093650626d177115e1806a3919/tablejs.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: ['[data-mode="dark"]']
        }
    </script>
    <?!= include("CSS"); ?>
</head>

<body>
    <nav class="fixed top-0 z-[39] w-full bg-white border-b border-gray-200">
        <div class="px-3 py-3 lg:px-5 lg:pl-3 h-14">
            <div class="flex items-center justify-between">
                <div class="flex items-center justify-start rtl:justify-end">
                    <button data-drawer-target="logo-sidebar" data-drawer-toggle="logo-sidebar"
                        aria-controls="logo-sidebar" type="button"
                        class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200">
                        <span class="sr-only">Open sidebar</span>
                        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z">
                            </path>
                        </svg>
                    </button>
                    <!-- <a href="https://flowbite.com" class="flex ms-5 md:me-24"> -->
                    <span class="pl-6 self-center text-xl font-semibold sm:text-2xl whitespace-nowrap">
                        SPPM
                    </span>
                    <!-- </a> -->
                </div>
            </div>
        </div>
    </nav>

    <!-- sidebar -->
    {{SIDEBAR}}

    <!-- Edit Form Modal -->
    <div id="edit-modal" tabindex="-1" aria-hidden="true" data-modal-backdrop="static"
        class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-4xl max-h-full">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow">
                <!-- Modal header -->
                <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t">
                    <h3 class="text-lg font-semibold text-gray-900">
                        Edit Reference Information
                    </h3>
                    <button type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
                        data-modal-toggle="edit-modal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <form id="editModalForm" class="form-to-submit" data-action="editSignatory" data-modal-id="edit-modal">
                    <div class="p-4 md:p-5 overflow-y-auto max-h-[70vh]">
                        <div class="mb-4 grid grid-cols-2 gap-4">
                            <!-- Signatory ID -->
                            <div class="col-span-2">
                                <label for="" class="mb-2 block text-sm font-medium text-gray-900">Signatory ID</label>
                                <input type="text" name="editSignatoryId" id="editSignatoryId"
                                    class="pointer-events-none read-only:bg-neutral-200 focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 "
                                    required readonly tabindex="-1" placeholder="" />
                            </div>
                            <!-- Name -->
                            <div class="col-span-2">
                                <label for="editNameId" class="mb-2 block text-sm font-medium text-gray-900">Name<span
                                        class="pl-1 text-red-500 text-xs italic">(Required)</span></label>
                                <input type="text" name="editName" id="editNameId"
                                    class="focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 "
                                    required placeholder="Write the employee name here..." />
                            </div>
                            <div class="col-span-2">
                                <label for="editPositionId"
                                    class="mb-2 block text-sm font-medium text-gray-900">Position<span
                                        class="pl-1 text-red-500 text-xs italic">(Required)</span></label>
                                <input type="text" name="editPosition" id="editPositionId"
                                    class="focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 "
                                    required placeholder="Write the position here..." />
                            </div>
                            <div class="col-span-2">
                                <label for="" class="mb-2 block text-sm font-medium text-gray-900">Field
                                    Name
                                </label>
                                <input type="text" name="editFieldName" id="editFieldNameId"
                                    class="pointer-events-none read-only:bg-neutral-200 focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 "
                                    required readonly tabindex="-1" placeholder="" />
                            </div>
                            <div class="col-span-2">
                                <label for="" class="mb-2 block text-sm font-medium text-gray-900">Document Name
                                </label>
                                <input type="text" name="editDocumentName" id="editDocumentNameId"
                                    class="pointer-events-none read-only:bg-neutral-200 focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 "
                                    required readonly tabindex="-1" placeholder="" />
                            </div>

                        </div>
                    </div>
                    <!-- Submit Button -->
                    <div class="sticky flex justify-end p-4">
                        <button type="submit"
                            class="to-disable text-white inline-flex items-center bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="mt-14 sm:ml-64 hidden">
        <select name="" id="flags-filter"></select>
    </div>

    <div class="fixed top-14 right-0 w-vw-64 h-vh-14">
        <!-- Table title and action buttons -->
        <div class="w-full h-14 flex justify-between items-center border-b border-neutral-200">
            <div class="flex space-x-2">
                <h1 class="ml-3 text-md font-medium">Reference</h1>
            </div>

            <!-- Modal Toggles  -->
            <div
                class="flex flex-col items-stretch justify-end flex-shrink-0 w-full space-y-2 md:w-auto md:flex-row md:space-y-0 md:items-center md:space-x-3">
                <div class="flex items-center w-full space-x-3 md:w-auto">
                </div>
            </div>
        </div>
        <!-- Table header controllers -->
        <div class="w-full h-14 flex justify-between items-center border-b border-neutral-200">
            <div class="flex space-x-2">
                <!-- search -->
                <label for="searchInput" class="sr-only">Search</label>
                <div class="relative w-70">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg aria-hidden="true" class="w-5 h-5 text-gray-500" viewbox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="reference-pagination-search"
                        class="block w-full h-10 p-2 pl-10 text-sm text-gray-900 border border-gray-300 rounded bg-gray-50 focus:ring-black focus:border-black"
                        placeholder="Search" required="">
                </div>
                <!-- colvis -->
                <div class="relative w-40">
                    <button data-dropdown-toggle="reference-table-colvis"
                        class="relative block w-40 h-10 p-1.5 border bg-neutral-50 border-neutral-300 text-neutral-900 sm:text-sm rounded focus:ring-neutral-600 focus:border-neutral-600">
                        <div
                            class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none text-neutral-500">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                            </svg>
                        </div>
                        Columns
                    </button>
                    <div data-popover id="reference-table-colvis"
                        class="text-left z-50 hidden bg-white divide-y divide-neutral-100 rounded-lg shadow w-44 max-h-vh-36 overflow-x-auto">
                        <ul class="py-2 text-sm text-neutral-700"></ul>
                    </div>
                </div>
            </div>
            <div>
                <!-- Modal Toggles -->
                <div
                    class="flex flex-col items-stretch justify-end flex-shrink-0 w-full space-y-2 md:w-auto md:flex-row md:space-y-0 md:items-center md:space-x-3">
                    <button id="reference-export-csv"
                        class="flex items-center justify-center px-4 py-2 h-10 text-sm font-medium text-white rounded-lg bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 disable-on-load">
                        Export CSV
                    </button>


                    <div class="flex items-center w-full space-x-3 md:w-auto">
                    </div>
                </div>
            </div>
        </div>
        <!-- Main Content -->
        <div class="h-vh-40 overflow-y-auto overflow-x-auto">
            <!-- Spinner -->
            <div class="flex items-center justify-center h-vh-40" id="spinner">
                <div role="status" class="flex items-center space-x-2">
                    <svg aria-hidden="true" class="w-8 h-8 mr-2 text-gray-200 animate-spin fill-gray-600"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="none">
                        <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path
                            d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z" />
                    </svg>
                    <!-- <span class="sr-only">Loading...</span> -->
                </div>
            </div>
            <!-- Table Container -->
            <div id="tableContainer" class="table-container hidden">
                <table id="referenceTable" class="w-full text-sm text-left rtl:text-right text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">REPORT_NAME</th>
                            <th scope="col" class="px-6 py-3">COUNT</th>
                            <th scope="col" class="px-6 py-3">RATING</th>
                            <th scope="col" class="px-6 py-3">ACTION</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <!-- Table Footer -->
        <div class="flex items-center justify-between border-t border-neutral-200 px-4 h-12">
            <!-- <div class="info flex items-center space-x-2">
                <div class="font-bold text-xl me-8 w-24">
                    TOTAL
                </div>
                <div class="font-medium text-xl me-2" id="reports-total">
                    0.00
                </div>
            </div> -->
            <div class="text-sm">
                <span class="text-sm" id="reference-pagination-records">Shows 1 of 1 of 1 entries</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="text-sm">
                    Rows per page
                </div>
                <div class="text-sm">
                    <select id="reference-pagination-limit"
                        class="block w-full items-center justify-center px-2 h-8 text-xs font-medium text-neutral-500 bg-white border rounded-lg hover:bg-neutral-100 hover:text-neutral-700  border-neutral-300 focus-within:ring-0 focus:ring-neutral-500 focus:outline-none focus:border-neutral-500">
                        <option value="*" selected>All</option>
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                    </select>
                </div>
                <span class="text-sm" id="reference-pagination-label">Page 1 of 10</span>
                <button id="reference-pagination-previous"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-sm font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700"
                    name="previous">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                    </svg>
                </button>
                <button id="reference-pagination-next"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-sm font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700 "
                    name="next">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <?!= include('JavaScript'); ?>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {

            const ids = generateIds(document.querySelectorAll('[id]'));

            const spinner = document.getElementById("spinner");
            const tableContainer = document.getElementById("tableContainer");

            const onClickEvents = {
                editData: function (data) {
                    loadEditFields(data);
                    showModal('edit');
                }
            }


            let date = {
                dateFrom: null,
                dateTo: null,
            }

            var currentData = [];

            const referenceElement = document.querySelector('span#reference-pagination-records');
            const referencePagingElement = document.querySelector('span#reference-pagination-label');
            const referenceHiddenColumns = [];

            const referenceTableOutput = {
                pagination: ({
                    current_page,
                    total_page,
                    start_item,
                    end_item,
                    total_rows,
                }) => {
                    if (referenceElement)
                        referenceElement.innerHTML = `Shows ${start_item} to ${end_item} of ${total_rows} entries`;
                    if (referencePagingElement)
                        referencePagingElement.innerHTML = `Page ${current_page} of ${total_page}`;
                },
            };

            // Initialize the table with its specific rendering function
            const referenceTableInstance = initializeTable(
                '#referenceTable',            // tableId
                'div#reference-table-colvis',  // colvisElement
                'button#reference-export-csv',  // csvButtonId
                'select#reference-pagination-limit',  // paginationLimitId
                'button#reference-pagination-next',   // paginationNextId
                'button#reference-pagination-previous',  // paginationPreviousId
                'input#reference-pagination-search',  // paginationSearchId
                referenceTableOutput,            // table output
                referenceHiddenColumns,         // hidden columns
                renderReferenceTable,          // renderingFunction
                "reference-report"          // exporting file name
            );

            const referenceHeaders = [
                'SIGNATORY_ID',
                'NAME',
                'POSITION',
                'FIELD_NAME',
                'DOCUMENT_NAME',
            ];

            async function renderReferenceTable({ data, table }) {
                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');

                // Clear existing content
                thead.innerHTML = '';
                tbody.innerHTML = '';

                // Create Header
                const headerRow = document.createElement('tr');
                referenceHeaders.forEach((header) => {
                    const th = document.createElement('th');
                    th.scope = 'col';
                    th.classList.add('px-6', 'py-3');
                    th.textContent = header.replace(/[_\s]{1,}/g, ' ');
                    headerRow.appendChild(th);
                });

                // Add Action Header
                const actionHeader = document.createElement('th');
                actionHeader.scope = 'col';
                actionHeader.classList.add('px-6', 'py-3', 'actions-column');
                actionHeader.textContent = 'Actions';

                headerRow.appendChild(actionHeader);
                thead.appendChild(headerRow);

                // Create Body
                data.forEach((row, index) => {

                    if (row.SIM_INFO) {
                        const simInfoString = row.SIM_INFO;
                        const hasSimInfo = !!simInfoString;
                        const simInfo = hasSimInfo ? JSON.parse(simInfoString) : '';

                        row.MOBILE_NO = simInfo.MOBILE_NO;
                        row.ACCOUNT_NO = simInfo.ACCOUNT_NO;
                    }

                    const tr = document.createElement('tr');
                    tr.classList.add('bg-white', 'border-b');
                    if (tr.index === undefined || tr.index === null) {
                        tr.index = index;
                        tr.dataset.index = index;
                    }

                    // Add Action Buttons
                    const actionTd = document.createElement('td');
                    actionTd.classList.add('px-6', 'py-3');
                    const actionDiv = document.createElement('div');
                    actionDiv.classList.add('action-buttons', 'flex', 'space-x-2');

                    if (Object.entries(row).every(([key, value]) => value === "")) {
                        const NoData = "No data";
                        referenceHeaders.forEach((header) => {
                            const td = document.createElement('td');
                            td.classList.add('px-6', 'py-3');
                            td.textContent = NoData;
                            tr.appendChild(td);
                        });
                        actionTd.textContent = "Actions";
                    } else {
                        referenceHeaders.forEach((header) => {
                            const td = document.createElement('td');
                            let value = row[header];
                            td.classList.add('px-6', 'py-3');
                            const numberValues = [
                            ];
                            const dateValues = [
                            ];
                            switch (true) {
                                case numberValues.includes(header):
                                    td.textContent = formatNumber(value);
                                    td.classList.add('text-right');
                                    break;
                                case dateValues.includes(header):
                                    td.textContent = DateTime(value, { format: "MM/DD/YYYY" });
                                    break;
                                default:
                                    td.textContent = value;
                                    break;
                            }
                            tr.appendChild(td);

                        });
                        const editButton = generateActionButton(vectors.edit, {
                            class: `px-2 py-2 bg-blue-500 text-white rounded`,
                            onClick: () => {
                                onClickEvents.editData({
                                    ...row,
                                });
                            }
                        }, row);
                        actionDiv.appendChild(editButton);
                        actionTd.appendChild(actionDiv);

                    }
                    tr.appendChild(actionTd);
                    tbody.appendChild(tr);
                });
            }

            function initializeTable(tableId, colvisElement, csvButtonId, paginationLimitId, paginationNextId, paginationPreviousId, paginationSearchId, output, hiddenColumns, renderingFunction, filename) {
                const table = document.querySelector(tableId);
                return new TableJS(table, {
                    dataset: {
                        init: false,
                        collection: [],
                        rendering: renderingFunction,
                    },
                    colvis: {
                        element: colvisElement,
                        exclude: ['.checkbox-column', '.actions-column'],
                        hide: hiddenColumns,
                    },
                    exportAs: [
                        {
                            as: 'csv',
                            element: csvButtonId,
                            filename: filename,
                            exclude: ['.checkbox-column', '.actions-column'],
                        },
                    ],
                    paginate: [
                        {
                            to: 'api',
                            as: 'limit',
                            element: paginationLimitId,
                            output: output.pagination,
                        },
                        {
                            to: 'api',
                            as: 'next',
                            element: paginationNextId,
                            output: output.pagination,
                        },
                        {
                            to: 'api',
                            as: 'previous',
                            element: paginationPreviousId,
                            output: output.pagination,
                        },
                        {
                            to: 'local',
                            as: 'search',
                            element: paginationSearchId,
                            exclude: ['.checkbox-column', '.actions-column'],
                            output: output.pagination,
                        },
                    ],
                });
            };

            // Function to fetch both datasets from the server
            async function refreshTables() {
                // try {
                // Fetch both datasets from the server in a single request
                const referenceData = await new Promise((resolve, reject) => {
                    google.script.run
                        .withSuccessHandler(resolve)
                        .withFailureHandler(reject)
                        .getReferenceData();  // Backend function
                });

                console.warn(referenceData)
                console.warn(typeof referenceData)

                const parsedReferenceData = JSON.parse(referenceData);
                console.warn(parsedReferenceData);

                refreshReferenceTable(parsedReferenceData);

                // Hide the spinner once the data was loaded
                spinner.classList.add("hidden");
                // Show the Table Container once the data was loaded
                tableContainer.classList.remove("hidden");

                // Remove the disable attribute from the buttons
                document.querySelectorAll(".disable-on-load").forEach((button) => {
                    button.disabled = false;
                    button.classList.remove("cursor-not-allowed");
                });

                // } catch (error) {
                //     console.error('Error refreshing tables:', error);
                // }
            }

            function refreshReferenceTable(data) {
                try {
                    referenceTableInstance.setDataset(data).render();
                } catch (error) {
                    console.error('Error rendering delayed payments table:', error);
                }
            }

            // Function to load data into edit fields
            function loadEditFields(item) {
                console.warn("Editing record: ", item);
                ids.editSignatoryId.value = item.SIGNATORY_ID;
                ids.editNameId.value = item.NAME;
                ids.editPositionId.value = item.POSITION;
                ids.editFieldNameId.value = item.FIELD_NAME;
                ids.editDocumentNameId.value = item.DOCUMENT_NAME;
            }

            async function getFormConfig(action) {
                switch (action) {
                    case 'editSignatory':
                        return {
                            submitCallback: formData => new Promise((resolve, reject) => {
                                google.script.run
                                    .withSuccessHandler(resolve)
                                    .withFailureHandler(reject)
                                    .editSignatory(formData); // server-side function
                            }),
                            additionalOperations: async formData => {
                                console.warn("FormData for editSignatory:", formData);
                                return Promise.resolve();
                            }
                        };
                    // Add more cases for other actions as needed
                    default:
                        throw new Error('Unknown action: ' + action);
                }
            }

            // Function to handle form submission
            async function handleFormSubmission(form, modalId) {
                form.addEventListener('submit', async function (event) {
                    event.preventDefault();
                    const formData = new FormData(form);
                    const dataObject = Object.fromEntries(formData.entries());
                    const buttons = form.querySelectorAll('button.to-disable');
                    toggleButtonState(buttons, true);

                    const action = form.dataset.action;
                    const { submitCallback, additionalOperations } = await getFormConfig(action);

                    try {
                        // Perform additional operations before submission
                        if (additionalOperations) {
                            await additionalOperations(dataObject);
                        }
                        // Submit form data after additional operations
                        await submitCallback(dataObject);
                        console.warn("CHECKKKKKK")
                        refreshTables();
                        // showToast("Record successfully processed", "success");
                        toast.success({
                            title: "Record successfully processed",
                            description: "Record successfully processed",
                            timeout: 4000,
                            closeButton: false,
                        })
                        clearForm(form);
                        // updateToggleButton();
                        if (modalId) toggleModal(modalId); // Use the dynamic modal ID if present
                    } catch (error) {
                        console.error("Error:", error);
                        toast.error({
                            title: "An error occurred. Please try again.",
                            description: "An error occurred. Please try again.",
                            timeout: 4000,
                            closeButton: false,
                        })
                    } finally {
                        setTimeout(() => toggleButtonState(buttons, false), 2000);
                    }
                });
            }

            function toggleModal(modalId) {
                const modalToggle = document.querySelector(`[data-modal-toggle="${modalId}"]`);
                if (modalToggle) {
                    modalToggle.click();
                } else {
                    console.error(`Modal with identifier "${modalId}" not found.`);
                }
            }

            // Function to disable and enable buttons
            function toggleButtonState(buttons, state) {
                buttons.forEach(function (button) {
                    button.disabled = state;
                    button.classList.toggle('cursor-not-allowed', state);
                });
            }


            // Initialize all forms
            document.querySelectorAll('.form-to-submit').forEach(form => {
                // Get modal ID from data attribute if present
                const modalId = form.dataset.modalId;
                handleFormSubmission(form, modalId);
            });


            // Targeting a specific class instead of all the buttons
            document.querySelectorAll('.disable-on-load').forEach(button => {
                button.classList.add('cursor-not-allowed');
                button.disabled = true;
            });

            // Initializes the table
            refreshTables();



        });

    </script>
</body>

</html>