<html>

<head>
    <base target="_top">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://rawcdn.githack.com/shinxzxzxz/TableJS/55597d91c8f5165cdfaaf90798bc2e0e886a42e8/tablejs.css"
        rel="stylesheet" />
    <script defer type="module"
        src="https://rawcdn.githack.com/shinxzxzxz/TableJS/55597d91c8f5165cdfaaf90798bc2e0e886a42e8/tablejs.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css" />

    <script>
        tailwind.config = {
            darkMode: ['[data-mode="dark"]'],
        };
    </script>

    <?!= include("CSS"); ?>
    <?!= include("JavaScript"); ?>
</head>

<body>


    <nav class="fixed top-0 z-[39] w-full bg-white border-b border-gray-200">
        <div class="px-3 py-3 lg:px-5 lg:pl-3 h-14">
            <div class="flex items-center justify-between">
                <div class="flex items-center justify-start rtl:justify-end">
                    <button data-drawer-target="logo-sidebar" data-drawer-toggle="logo-sidebar"
                        aria-controls="logo-sidebar" type="button"
                        class="inline-flex items-center p-2 text-xs text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200">
                        <span class="sr-only">Open sidebar</span>
                        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z">
                            </path>
                        </svg>
                    </button>
                    <a href="https://flowbite.com" class="flex ms-5 md:me-24">
                        <span class="self-center text-xl font-semibold sm:text-2xl whitespace-nowrap">SPPM 2</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- sidebar -->
    {{SIDEBAR}}

    <div class="mt-14 sm:ml-64 hidden">
        <div class="relative bg-white border-b">
            <div class="flex flex-col items-center p-4 space-y-3 md:flex-row md:space-y-0 md:space-x-4 h-14">
                <div class="w-1/2 md:w-1/2"></div>
            </div>
        </div>
        <!-- Table -->
        <div class="relative overflow-x-auto sm:rounded-lg mt-5">
            <!-- Table Footer -->
            <div class="relative overflow-hidden bg-white">
                <nav class="flex flex-col items-start justify-between space-y-3 md:flex-row md:items-center md:space-y-0"
                    aria-label="Table navigation">
                    <div class="flex items-center space-x-3">
                        <label for="rowsPerPage" class="text-xs font-normal text-gray-500">Rows per page:
                        </label>
                        <select id="pagination-limit1"
                            class="block p-2 text-xs text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-black-500 focus:border-black-500">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="all">All</option>
                        </select>
                        <span id="paginationInfo" class="text-xs font-normal text-gray-500">
                        </span>
                    </div>

                    <ul class="inline-flex items-stretch -space-x-px">
                        <li>
                            <button id="pagination-previous1"
                                class="flex items-center justify-center h-full py-1.5 px-3 ml-0 text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                                <span class="sr-only">Previous</span>
                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </li>

                        <li>
                            <button id="pagination-next1"
                                class="flex items-center justify-center h-full py-1.5 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                                <span class="sr-only">Next</span>
                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </button>

                        </li>
                    </ul>
                </nav>
            </div>
        </div>

    </div>

    <div class="fixed top-14 right-0 w-vw-64 h-vh-14">
        <div class="w-full h-14 flex justify-between items-center">
            <div class="flex space-x-2">
                <label for="searchInput" class="sr-only">Search</label>

                <div class="relative w-full">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg aria-hidden="true" class="w-5 h-5 text-gray-500" viewbox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="pagination-search"
                        class="block w-full p-2 pl-10 text-xs text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Search" required="" />
                </div>

                <div class="relative w-40">
                    <button data-dropdown-toggle="table-colvis"
                        class="relative block w-40 p-2 border bg-neutral-50 border-neutral-300 text-neutral-900 sm:text-xs rounded-lg focus:ring-neutral-600 focus:border-neutral-600">
                        <div
                            class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none text-neutral-500">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                            </svg>
                        </div>
                        Columns
                    </button>

                    <div data-popover id="table-colvis"
                        class="text-left z-50 hidden bg-white divide-y divide-neutral-100 rounded-lg shadow w-44 h-vh-36 overflow-x-auto text-uppercase">
                        <ul class="py-2 text-xs text-neutral-700"></ul>
                    </div>
                </div>
            </div>

            <div>
                <div
                    class="flex flex-col items-stretch justify-end flex-shrink-0 w-full space-y-2 md:w-auto md:flex-row md:space-y-0 md:items-center md:space-x-3">
                    <button id="export-csv"
                        class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-green-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300">Export
                        CSV</button>
                    <button type="button" id="add-modal-toggle"
                        class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-blue-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300">
                        <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewbox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                        </svg>
                        Add Request
                    </button>
                    <div class="flex items-center w-full space-x-3 md:w-auto"></div>
                </div>
            </div>
        </div>

        <div class="relative">
            <div role="status" id="spinner"
                class="absolute inset-0 flex items-center justify-center bg-white z-50 h-full">
                <svg aria-hidden="true" class="w-8 h-8 mr-2 text-gray-200 animate-spin fill-gray-600"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="none">
                    <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z" />
                </svg>
            </div>
            <div class="h-vh-40 overflow-y-auto overflow-x-auto">
                <div class="table-container">
                    <table id="tablejs" class="w-full text-sm text-left rtl:text-right text-gray-500">
                        <thead class="text-sm text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3">REQUEST NO</th>
                                <th scope="col" class="px-6 py-3">REQUEST TYPE</th>
                                <th scope="col" class="px-6 py-3">REQUEST STATUS</th>
                                <th scope="col" class="px-6 py-3">RECEIVED AND APPROVED DATE</th>
                                <th scope="col" class="px-6 py-3">PRE-ISSUANCE DATE</th>
                                <th scope="col" class="px-6 py-3">ISSUANCE DATE</th>
                                <th scope="col" class="px-6 py-3">ISSUANCE NO</th>
                                <th scope="col" class="px-6 py-3">OWNERSHIP</th>
                                <th scope="col" class="px-6 py-3">SECTION GROUP NAME</th>
                                <th scope="col" class="px-6 py-3">REMARKS</th>
                                <th scope="col" class="px-6 py-3">SIM CARD ID</th>
                                <th scope="col" class="px-6 py-3">SIM TYPE</th>
                                <th scope="col" class="px-6 py-3">GROUP ID</th>
                                <th scope="col" class="px-6 py-3">PURCHASING RS NO</th>
                                <th scope="col" class="px-6 py-3">PURCHASING RS DATE</th>
                                <th scope="col" class="px-6 py-3">CANCELLATION REASON</th>
                                <th scope="col" class="px-6 py-3">CANCELLATION DATE</th>
                                <th scope="col" class="px-6 py-3">EMPLOYEE INFO</th>
                                <th scope="col" class="px-6 py-3">SIM INFO</th>
                                <th scope="col" class="actions-column px-6 py-3">ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">No data</td>
                                <td scope="col" class="px-6 py-3">Action</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Table Footer -->
        <div class="flex items-center justify-between border-t border-neutral-200 px-4 h-12">
            <div class="text-xs">
                <span class="text-xs" id="pagination-records">Shows 1 of 1 of 1 entries</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="text-xs">Rows per page</div>
                <div class="text-xs">
                    <select id="pagination-limit"
                        class="block w-full items-center justify-center px-2 h-8 text-xs font-medium text-neutral-500 bg-white border rounded-lg hover:bg-neutral-100 hover:text-neutral-700 border-neutral-300 focus-within:ring-0 focus:ring-neutral-500 focus:outline-none focus:border-neutral-500">
                        <option value="*" selected>All</option>
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                    </select>
                </div>
                <span class="text-xs" id="pagination-label">Page 1 of 10</span>
                <button id="pagination-previous"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-xs font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700"
                    name="previous">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                    </svg>
                </button>
                <button id="pagination-next"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-xs font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700"
                    name="next">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", async function () {
            const $ = (() => {
                const handlerKeys = [
                    "withSuccessHandler",
                    "withFailureHandler",
                    "withUserObject",
                ];
                const GoogleInstance = {};

                Object.keys(google.script.run)
                    .filter((k) => handlerKeys.indexOf(k) < 0)
                    .forEach((k) => {
                        GoogleInstance[k] = (...args) =>
                            new Promise((resolve, reject) => {
                                google.script.run
                                    .withSuccessHandler(resolve)
                                    .withFailureHandler(reject)
                                [k](...args);
                            });
                    });

                return GoogleInstance;
            })();

            const recordElement = document.querySelector("span#pagination-records");
            const pagingElement = document.querySelector("span#pagination-label");

            const output = {
                pagination: ({
                    current_page,
                    total_page,
                    start_item,
                    end_item,
                    total_rows,
                }) => {
                    if (recordElement)
                        recordElement.innerHTML = `Shows ${start_item} to ${end_item} of ${total_rows} entries`;
                    if (pagingElement)
                        pagingElement.innerHTML = `Page ${current_page} of ${total_page}`;
                },
            };

            const headers = [
                "REQUEST_NO",
                "REQUEST_TYPE",
                "REQUEST_STATUS",
                "RECEIVED_AND_APPROVED_DATE",
                "MOBILE_ID",
                "GROUP_ID",
                "ISSUANCE_NO",
                "PRE_ISSUANCE_DATE",
                "ISSUANCE_DATE",
                "OWNERSHIP",
                "SECTION_GROUP_NAME",
                "REMARKS",
                "EARPHONES",
                "CHARGER",
                "OTHERS",
                "CONDITION_TYPE",
                "CANCELLATION_DATE",
                "CANCELLATION_REASON",
                "PURCHASING_RS_NO",
                "PURCHASING_RS_DATE",
                "EMPLOYEE_INFO",
                "MOBILE_INFO"
            ];

            const spinner = document.getElementById("spinner");

            async function renderTable({ data, table }) {
                const thead = table.querySelector("thead");
                const tbody = table.querySelector("tbody");

                spinner.classList.add("hidden");

                // Clear existing content
                thead.innerHTML = "";
                tbody.innerHTML = "";

                // Create Header
                const headerRow = document.createElement("tr");
                headers.forEach((header) => {
                    const th = document.createElement("th");
                    th.scope = "col";
                    th.classList.add("px-6", "py-3");
                    if (header === "EMPLOYEE_INFO") {
                        th.classList.add("hidden-column");
                    }
                    if (header === "MOBILE_INFO") {
                        th.classList.add("hidden-column");
                    }
                    th.textContent = header.replace(/[_\s]{1,}/g, " ");
                    headerRow.appendChild(th);
                });

                // Add Action Header
                const actionHeader = document.createElement("th");
                actionHeader.scope = "col";
                actionHeader.classList.add("px-6", "py-3");
                actionHeader.textContent = "Actions";
                headerRow.appendChild(actionHeader);
                thead.appendChild(headerRow);

                // Create Body
                data.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    tr.classList.add("border-b");
                    if (tr.index === undefined || tr.index === null) {
                        tr.index = index;
                        tr.dataset.index = index;
                    }

                    const rowData = headers.reduce((acc, header) => {
                        const td = document.createElement("td");
                        td.classList.add("px-6", "py-4");

                        const hiddenHeaders = [
                            "EMPLOYEE_INFO",
                            "MOBILE_INFO",
                        ];

                        if (hiddenHeaders.includes(header)) {
                            td.classList.add("hidden-column");
                        }

                        const indexOfHeader = headers.indexOf(header);
                        const textContent = indexOfHeader >= 0 ? row[indexOfHeader] : "";

                        let textValue;
                        function formatDate(dateString) {
                            const dateValue = new Date(dateString);
                            return isNaN(dateValue.getTime())
                                ? ""
                                : DateTime(dateValue, { format: "MM-DD-YYYY" });
                        }

                        switch (header) {
                            case "RECEIVED_AND_APPROVED_DATE":
                                textValue = formatDate(textContent);
                                break;
                            case "PRE_ISSUANCE_DATE":
                                textValue = formatDate(textContent);
                                break;
                            case "ISSUANCE_DATE":
                                textValue = formatDate(textContent);
                                break;
                            case "CANCELLATION_DATE":
                                textValue = formatDate(textContent);
                                break;
                            case "PURCHASING_RS_DATE":
                                textValue = formatDate(textContent);
                                break;
                            default:
                                textValue = textContent;
                                break;
                        }
                        td.textContent = textValue;
                        tr.appendChild(td);
                        acc[header] = textValue;
                        return acc;
                    }, {});

                    const purchasingRsNoId = rowData["PURCHASING_RS_NO"];
                    const hasPurchasingRsNo = !!purchasingRsNoId;

                    // Add Action Buttons
                    const actionTd = document.createElement("td");
                    actionTd.classList.add("px-6", "py-4");
                    const actionDiv = document.createElement("div");
                    actionDiv.classList.add("action-buttons", "flex", "space-x-2");


                    const viewButton = generateActionButton(vectors.view, {
                        class: 'px-2 py-2 bg-green-500 text-white rounded',
                    }, row);

                    viewButton.addEventListener('click', function (e) {

                        const indextOfRequestNo = headers.indexOf("REQUEST_NO");
                        const requestNo = row[indextOfRequestNo];

                        const mobileId = rowData["MOBILE_ID"];
                        const hasMobileId = !!mobileId;
                        const cancellationReasonId = rowData["CANCELLATION_REASON"];
                        const hasCancellationReason = !!cancellationReasonId;
                        const ownershipValue = rowData["OWNERSHIP"];
                        const employeeInfoString = rowData["EMPLOYEE_INFO"];
                        const hasEmployeeInfo = !!employeeInfoString;
                        const employeeInfo = hasEmployeeInfo
                            ? JSON.parse(employeeInfoString)
                            : ``;

                        const mobileInfoString = rowData["MOBILE_INFO"];
                        const hasMobileInfo = !!mobileInfoString;
                        const mobileInfo = hasMobileInfo ? JSON.parse(mobileInfoString) : ``;

                        if (indextOfRequestNo >= 0) {

                            Swal.fire({
                                html: `
                <form id="viewMobileRequestDetailsId" class="p-4 md:p-5">
                  <div>
                    <h3 class="font-bold text-left">View Mobile Request Details</h1>
                    <hr class="h-px mt-2 mb-4 bg-gray-200 border-0 ">
                  <div>
                  <div class="grid gap-4 mb-4 grid-cols-4">
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        REQUEST NO
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.REQUEST_NO ? `${rowData.REQUEST_NO}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        RECEIVED DATE
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.RECEIVED_AND_APPROVED_DATE ? `${rowData.RECEIVED_AND_APPROVED_DATE}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        PRE-ISSUANCE DATE 
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.PRE_ISSUANCE_DATE ? `${rowData.PRE_ISSUANCE_DATE}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        ISSUANCE NO
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.ISSUANCE_NO ? `${rowData.ISSUANCE_NO}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        ISSUANCE DATE 
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.ISSUANCE_DATE ? `${rowData.ISSUANCE_DATE}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        REQUEST TYPE
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.REQUEST_TYPE ? `${rowData.REQUEST_TYPE}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        OWNERSHIP
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.OWNERSHIP ? `${rowData.OWNERSHIP}` : ` `}
                    </div>
                     ${ownershipValue === "Group" ? `
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        SECTION GROUP NAME
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.SECTION_GROUP_NAME ? `${rowData.SECTION_GROUP_NAME}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        REMARKS
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.REMARKS ? `${rowData.REMARKS}` : ` `}
                    </div>
                    `: ``}
                    ${hasPurchasingRsNo ? `
                    <div class="col-span-4">
                      <div class="inline-flex items-center justify-center w-full">
                          <hr class="w-full h-px bg-gray-300 border-0">
                          <span class="absolute px-3 font-medium text-xs text-gray-500 -translate-x-1/2 bg-white left-1/2">Purchase Details</span>
                      </div>
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        PURCHASING RS NO 
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.PURCHASING_RS_NO ? `${rowData.PURCHASING_RS_NO}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        PURCHASING RS DATE 
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.PURCHASING_RS_DATE ? `${rowData.PURCHASING_RS_DATE}` : ` `}
                    </div>
                    `: ``}
                    <div class="col-span-4">
                      <div class="inline-flex items-center justify-center w-full">
                          <hr class="w-full h-px bg-gray-300 border-0">
                          <span class="absolute px-3 font-medium text-xs text-gray-500 -translate-x-1/2 bg-white left-1/2">Employee Details</span>
                      </div>
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        GROUP ID
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.GROUP_ID ? `${rowData.GROUP_ID}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        EMPLOYEE NAME
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!employeeInfo.FULL_NAME ? `${employeeInfo.FULL_NAME}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        POSITION
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!employeeInfo.POSITION ? `${employeeInfo.POSITION}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        DEPARTMENT
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!employeeInfo.DEPARTMENT ? `${employeeInfo.DEPARTMENT}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        SECTION
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!employeeInfo.SECTION ? `${employeeInfo.SECTION}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        COMPANY NAME
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!employeeInfo.COMPANY_NAME ? `${employeeInfo.COMPANY_NAME}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        BRANCH 
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!employeeInfo.BRANCH ? `${employeeInfo.BRANCH}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        SITE 
                    </div>
                    <div class="col-span-3 text-left text-sm text-neutral-700 w-full">
                        ${!!employeeInfo.SITE ? `${employeeInfo.SITE}` : ` `}
                    </div>
                     ${hasMobileId ? `       
                    <div class="col-span-4">
                      <div class="inline-flex items-center justify-center w-full">
                          <hr class="w-full h-px bg-gray-300 border-0">
                          <span class="absolute px-3 font-medium text-xs text-gray-500 -translate-x-1/2 bg-white left-1/2">Sim Details</span>
                      </div>
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        MOBILE ID 
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.MOBILE_ID ? `${rowData.MOBILE_ID}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        IMEI 
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!mobileInfo.IMEI ? `${mobileInfo.IMEI}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        BRAND
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!mobileInfo.BRAND ? `${mobileInfo.BRAND}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        MODEL 
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!mobileInfo.MODEL ? `${mobileInfo.MODEL}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        COLOR
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!mobileInfo.COLOR ? `${mobileInfo.COLOR}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        EARPHONES
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.EARPHONES ? `${rowData.EARPHONES}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        CHARGER
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.CHARGER ? `${rowData.CHARGER}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        OTHERS
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.OTHERS ? `${rowData.OTHERS}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        CONDITION TYPE
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.CONDITION_TYPE ? `${rowData.CONDITION_TYPE}` : ` `}
                    </div>
                    ` : ``}
                     ${hasCancellationReason ? `
                    <div class="col-span-4">
                      <div class="inline-flex items-center justify-center w-full">
                          <hr class="w-full h-px bg-gray-300 border-0">
                          <span class="absolute px-3 font-medium text-xs text-gray-500 -translate-x-1/2 bg-white left-1/2">Cancellation Details</span>
                      </div>
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        CANCELLATION REASON
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.CANCELLATION_REASON ? `${rowData.CANCELLATION_REASON}` : ` `}
                    </div>
                    <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                        CANCELLATION DATE
                    </div>
                    <div class="col-span-1 text-left text-sm text-neutral-700 w-full">
                        ${!!rowData.CANCELLATION_DATE ? `${rowData.CANCELLATION_DATE}` : ` `}
                    </div>
                    ` : ``}
                  </div>
                  <div class="flex justify-end pt-2">
                    <button type="button" id="closeButtonId"
                        class="text-white inline-flex items-center bg-neutral-700 hover:bg-neutral-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                        Close
                    </button>
                  </div>
                </form>
                `,
                                showConfirmButton: false,
                                customClass: 'swal-wide',
                                showCloseButton: true,
                                allowOutsideClick: false,
                                didOpen: () => {

                                    const viewMobileRequestDetailsId = document.getElementById('viewMobileRequestDetailsId');

                                    const namedQuery = viewMobileRequestDetailsId.querySelectorAll(':is(input)[name]');
                                    const namedElements = Array.from(namedQuery);

                                    headers.forEach(header => {
                                        const targetElement = namedElements.find(element => element.name === header);

                                        if (targetElement) {
                                            targetElement.value = rowData[header];
                                        }
                                    });

                                    const closeButtonId = document.getElementById('closeButtonId');

                                    closeButtonId.addEventListener(
                                        "click",
                                        function (event) {
                                            event.preventDefault();
                                            Swal.close();
                                        }
                                    );

                                },
                            });


                        }
                    });
                    const editButton = generateActionButton(vectors.edit, {
                        class: 'px-2 py-2 bg-blue-500 text-white rounded',
                    }, row);

                    const status = rowData.REQUEST_STATUS;
                    const isRS = status === "Received RS" || status === "Pre-Issued" || status === "Received PR";
                    if (!isRS) {
                        editButton.disabled = true;
                        editButton.classList.add("opacity-50", "cursor-not-allowed");
                    }

                    editButton.addEventListener("click", function (e) {
                        const indexOfRequestNo = headers.indexOf("REQUEST_NO");
                        const requestNo = row[indexOfRequestNo];

                        if (indexOfRequestNo >= 0) {
                            const mobileId = rowData["MOBILE_ID"];
                            const hasMobileId = !!mobileId;
                            const ownershipValue = rowData["OWNERSHIP"];
                            const preIssuanceDate = rowData["PRE_ISSUANCE_DATE"];
                            const hasPreIssuanceDate = !!preIssuanceDate;
                            Swal.fire({
                                html: `
                      <form id="editSimRequestFormId" class="p-4 md:p-5">
                          <div>
                            <h3 class="font-bold text-left">Edit Mobile Request Details</h1>
                            <hr class="h-px mt-2 mb-4 bg-gray-200 border-0 ">
                          <div>
                          <div class="grid gap-4 mb-4 grid-cols-4">
                            <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              RECEIVED DATE
                            </div>
                            <div class="col-span-1 text-left">
                              <input disabled readonly type="text" id="receivedAndApproveDateId" name="RECEIVED_AND_APPROVED_DATE" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                            </div>
                            <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              REQUEST TYPE
                            </div>
                            <div class="col-span-1 text-left">
                              <input disabled readonly type="text" id="requestTypeId" name="REQUEST_TYPE" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                            </div>
                            <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              OWNERSHIP
                            </div>
                            <div class="col-span-1 text-left">
                              <input disabled readonly type="text" id="ownershipId" name="OWNERSHIP" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                            </div>
                            ${ownershipValue === "Group"
                                        ? `
                                <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                                  SECTION GROUP NAME
                                </div>
                                <div class="col-span-3 text-left">
                                  <input disabled readonly type="text" id="sectionGroupNameId" name="SECTION_GROUP_NAME" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                                </div>
                                <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                                  REMARKS
                                </div>
                                <div class="col-span-3 text-left">
                                  <input disabled readonly type="text" id="remarksId" name="REMARKS" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                                </div>
                              `
                                        : `
                              `
                                    }
                            <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                              GROUP ID
                            </div>
                            <div class="col-span-1 text-left">
                              <input disabled readonly type="text" id="groupId" name="GROUP_ID" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                            </div>
                            ${hasMobileId
                                        ? `
                              <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                                Mobile ID
                              </div>
                              <div class="col-span-1 text-left">
                                <input disabled readonly type="text" id="mobileId" name="MOBILE_ID" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                              </div>
                              `
                                        : `
                              `
                                    }
                            ${hasPurchasingRsNo
                                        ? `
                              <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                                Purchasing RS No.
                              </div>
                              <div class="col-span-1 text-left">
                                <input disabled readonly type="text" id="mobileId" name="PURCHASING_RS_NO" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                              </div>
                              <div class="col-span-1 text-left font-semibold text-sm text-neutral-700 w-full flex space-x-2 justify-between items-center">
                                Purchasing RS Date
                              </div>
                              <div class="col-span-1 text-left">
                                <input disabled readonly type="text" id="mobileId" name="PURCHASING_RS_DATE" placeholder=" " class="border-0 text-sm text-neutral-700 w-full" />
                              </div>
                              `
                                        : `
                              `
                                    }
                            <div class="col-span-4 ">
                              <div class="inline-flex items-center justify-center w-full">
                                  <hr class="w-full h-px bg-gray-300 border-0">
                              </div>
                            </div>
                            ${hasMobileId && hasPreIssuanceDate
                                        ? `
                                <div class="col-span-4">
                                  <div class="inline-flex items-center justify-center w-full">
                                    <p class="text-left text-sm font-medium text-gray-600 font-semibold">INSTRUCTION: <span class="font-normal">Please kindly choose an action by clicking</span> Cancel Request <span class="font-normal">to cancel sim request, or</span> Issue Request <span class="font-normal">to issue sim request. </span><span class="font-normal italic">Note: Select Mobile Device button is disabled.</span></p>
                                  </div>
                                </div>
                                <div class="col-span-4 pb-2">
                                  <div class="grid grid-cols-3 w-full">
                                    <button type="button" id="cancelRequestBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
                                      Cancel Request
                                    </button>
                                    <button disabled type="button" id="selectMobileIdBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-neutral-200 border-t border-b border-gray-300">
                                      Select Mobile Device
                                    </button>
                                    <button type="button" id="issueRequestBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
                                      Issue Request
                                    </button>
                                  </div>
                                </div>
                              `
                                        : ``
                                    }
                            ${!hasMobileId
                                        ? `
                                <div class="col-span-4">
                                  <div class="inline-flex items-center justify-center w-full">
                                    <p class="text-left text-sm font-medium text-gray-600 font-semibold">INSTRUCTION: <span class="font-normal">Please kindly choose an action by clicking</span> Cancel Request <span class="font-normal">to cancel sim request, or </span>Select Mobile Device <span class="font-normal">to select a Mobile Device.</span><span class="font-normal italic"> Note: Issue Request button is disabled.</span></p>
                                  </div>
                                </div>
                                <div class="col-span-4">
                                  <div class="grid grid-cols-3 w-full">
                                    <button type="button" id="cancelRequestBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
                                      Cancel Request
                                    </button>
                                    <button type="button" id="selectMobileIdBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-white border-t border-b border-gray-300 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
                                      Select Mobile Device
                                    </button>
                                    <button disabled type="button" id="issueRequestBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-neutral-200 border border-gray-300 rounded-e-lg">
                                      Issue Request
                                    </button>
                                  </div>
                                </div>
                              `
                                        : ``
                                    }
                            ${hasMobileId && !hasPreIssuanceDate
                                        ? `
                                <div class="col-span-4">
                                  <div class="inline-flex items-center justify-center w-full">
                                    <p class="text-left text-sm font-medium text-gray-600 font-semibold">INSTRUCTION: <span class="font-normal">Please kindly choose an action by clicking</span> Cancel Request <span class="font-normal">to cancel sim request.</span><span class="font-normal italic"> Note: Select Mobile Device button and Issue Request button are disabled.</span></p>
                                  </div>
                                </div>
                                <div class="col-span-4">
                                  <div class="grid grid-cols-3 w-full">
                                    <button type="button" id="cancelRequestBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
                                      Cancel Request
                                    </button>
                                    <button disabled type="button" id="selectMobileIdBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-neutral-200 border-t border-b border-gray-300">
                                      Select Mobile Device
                                    </button>
                                    <button disabled type="button" id="issueRequestBtn" class="px-4 py-2 text-sm font-semibold text-gray-900 bg-neutral-200 border border-gray-300 rounded-e-lg">
                                      Issue Request
                                    </button>
                                  </div>
                                </div>
                              `
                                        : ``
                                    }
                              <div class="col-span-2 is-Cancel hidden">
                                <label class="flex space-x-2" for="cancellationDateId">
                                  <div class="text-sm font-semibold">Cancellation Date</div>
                                  <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                                </label>
                                <input type="date" id="cancellationDateId" name="CANCELLATION_DATE" placeholder="Cancellation Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                              </div>
                              <div class="col-span-2 is-Cancel hidden">
                                <label class="flex space-x-2" for="cancellationReasonId">
                                  <div class="text-sm font-semibold">Reason</div>
                                  <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                                </label>
                                <input type="text" id="cancellationReasonId" name="CANCELLATION_REASON" placeholder="Cancellation Reason" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                              </div>
                              ${!hasPurchasingRsNo ? `
                                <div class="hidden col-span-2 is-Mobile">
                                  <label class="flex space-x-2" for="purchasingRsNoId">
                                  <div class="text-sm font-semibold">Purchasing RS No</div>
                                  <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                  </label>
                                  <input  type="text" id="purchasingRsNoId" name="PURCHASING_RS_NO" placeholder="Purchasing RS No" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                                </div>
                                <div class="hidden col-span-2 is-Mobile">
                                    <label class="flex space-x-2" for="purchasingRsDateId">
                                    <div class="text-sm font-semibold">Purchasing RS Date</div>
                                    <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                    </label>
                                    <input  type="date" id="purchasingRsDateId" name="PURCHASING_RS_DATE" placeholder="Purchasing RS Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                                </div>
                              `: `
                              <div class="col-span-1 is-Mobile hidden">
                                  <label class="flex space-x-2" for="mobileDeviceId">
                                    <div class="text-sm font-semibold">Mobile Device ID</div>
                                    <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                                  </label>
                                  <input required list="mobileDeviceIds" id="mobileDeviceId" name="MOBILE_ID" autocomplete="off" placeholder="Mobile Device ID" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"/>
                                  <datalist id="mobileDeviceIds">
                                  </datalist>
                              </div>
                              <div class="col-span-1 is-Mobile hidden">
                                <label class="flex space-x-2" for="colorId">
                                  <div class="text-sm font-semibold">Color</div>
                                  <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                </label>
                                <input type="text" id="colorId" name="COLOR" placeholder="Color" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                              </div>
                              <div class="col-span-2 is-Mobile hidden">
                                <label class="flex space-x-2" for="brandNameId">
                                  <div class="text-sm font-semibold">Brand Name</div>
                                  <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                </label>
                                <input type="text" id="brandNameId" name="BRAND" placeholder="Brand Name" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                              </div>
                              <div class="col-span-2 is-Mobile hidden">
                                <label class="flex space-x-2" for="modelNameId">
                                  <div class="text-sm font-semibold">Model Name</div>
                                  <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                </label>
                                <input type="text" id="modelNameId" name="MODEL" placeholder="Model Name" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                              </div>
                              <div class="col-span-1 is-Mobile hidden">
                                <label class="flex space-x-2" for="ramRomId">
                                  <div class="text-sm font-semibold">RAM-ROM</div>
                                  <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                </label>
                                <input type="text" id="ramRomId" name="RAM_ROM" placeholder="XXGB-XXGB" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                              </div>
                              <div class="col-span-1 is-Mobile hidden">
                                <label class="flex space-x-2" for="cameraId">
                                  <div class="text-sm font-semibold">Camera</div>
                                  <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                </label>
                                <input type="text" id="cameraId" name="CAMERA" placeholder="XXMP-XXMP" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                              </div>
                              <div class="col-span-1 hidden">
                                <label class="flex space-x-2" for="imeiId">
                                  <div class="text-sm font-semibold">IMEI</div>
                                  <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                </label>
                                <input type="text" id="imeiId" name="IMEI" placeholder="" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                              </div>
                              <div class="col-span-1 is-Mobile hidden">
                                  <label class="flex space-x-2" for="earphonesId">
                                    <div class="text-sm font-semibold">Earphones</div>
                                    <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                  </label>
                                  <div class="text-left p-1 is-Mobile hidden">
                                    <input type="hidden" name="EARPHONES" value="Not Included">
                                    <input id="earphonesId" name="EARPHONES" type="checkbox" value="Included" class="items-center w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="earphonesId" class="pt-8 ms-2 text-sm">Item Included</label>
                                  </div>
                              </div>
                              <div class="col-span-1 is-Mobile hidden">
                                <label class="flex space-x-2" for="chargerId">
                                  <div class="text-sm font-semibold">Charger</div>
                                  <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                </label>
                                <div class="text-left p-1 is-Mobile hidden">
                                  <input type="hidden" name="CHARGER" value="Not Included">
                                  <input id="chargerId" name="CHARGER" type="checkbox" value="Included" class="items-center w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                  <label for="chargerId" class="pt-8 ms-2 text-sm">Item Included</label>
                                </div>
                              </div>
                              <div class="col-span-1 is-Mobile hidden">
                                <label class="flex space-x-2" for="otherId">
                                  <div class="text-sm font-semibold">Others</div>
                                  <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                </label>
                                <input type="text" id="otherId" name="OTHERS" placeholder="Other Accessories" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"/>
                              </div>
                              <div class="col-span-1 is-Mobile hidden">
                                <label class="flex space-x-2" for="conditionId">
                                  <div class="text-sm font-semibold">Condition Type</div>
                                  <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                                </label>
                                <select id="conditionId" name="CONDITION_TYPE" required
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                                    <option selected value="">Select Ownership</option>
                                    <option value="Brand New">Brand New</option>
                                    <option value="Second Hand">Second hand</option>
                                </select>
                              </div>
                              <div class="col-span-1 hidden">
                                <label class="flex space-x-2" for="rfpGroupNameId">
                                  <span class="text-sm font-semibold">Rfp Group Name</span>
                                  <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                  <span class="text-red-400"> </span>
                                </label>
                                <input type="text" id="rfpGroupNameId" name="RFP_GROUP_NAME" placeholder="Rfp Group" class="cursor-default bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                              </div>
                              `}
                              
                              <div class="col-span-2 is-Issue hidden">
                                <label class="flex space-x-2" for="issuanceDateId">
                                  <div class="text-sm font-semibold">Issuance Date</div>
                                  <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                                </label>
                                <input type="date" id="issuanceDateId" name="ISSUANCE_DATE" placeholder="Issuance Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                              </div>
                             
                          </div>
                          <div class="flex justify-end pt-2">
                            <button id="submitButtonId" type="submit"
                                class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                                Submit
                            </button>
                          </div>
                        </form>
                      `,
                                showConfirmButton: false,
                                customClass: "swal-wide",
                                showCloseButton: true,
                                allowOutsideClick: false,
                                didOpen: async () => {
                                    const editSimRequestFormId = document.getElementById("editSimRequestFormId");
                                    const cancelRequestBtn = document.getElementById("cancelRequestBtn");
                                    const selectMobileIdBtn = document.getElementById("selectMobileIdBtn");
                                    const issueRequestBtn = document.getElementById("issueRequestBtn");
                                    const cancelElements = document.querySelectorAll('.is-Cancel');
                                    const mobileElements = document.querySelectorAll('.is-Mobile');
                                    const issueElements = document.querySelectorAll('.is-Issue');

                                    cancelRequestBtn.addEventListener('click', function () {
                                        cancelElements.forEach(element => {
                                            element.classList.toggle('hidden');

                                            const input = element.querySelector('input');
                                            if (!element.classList.contains('hidden')) {
                                                input.setAttribute('required', 'required');
                                            } else {
                                                input.removeAttribute('required');
                                            }
                                        });
                                        mobileElements.forEach(element => {
                                            element.classList.add('hidden');
                                            const input = element.querySelector('input');
                                            if (input) {
                                                input.removeAttribute('required');
                                                input.value = '';
                                            }
                                        });
                                        issueElements.forEach(element => {
                                            element.classList.add('hidden');
                                            const input = element.querySelector('input');
                                            if (input) {
                                                input.removeAttribute('required'); // Remove required attribute if it exists
                                                input.value = ''; // Reset the value of the input
                                            }
                                        });
                                    });

                                    // Track fields that originally had the "required" attribute
                                    mobileElements.forEach(element => {
                                        const input = element.querySelector('input');
                                        if (input && input.hasAttribute('required')) {
                                            input.dataset.originalRequired = 'true'; // Mark as originally required
                                        }
                                    });

                                    selectMobileIdBtn.addEventListener('click', function () {
                                        mobileElements.forEach(element => {
                                            element.classList.toggle('hidden');

                                            const input = element.querySelector('input');
                                            if (input) {
                                                if (!element.classList.contains('hidden')) {
                                                    // Add required only if it was originally required
                                                    if (input.dataset.originalRequired === 'true') {
                                                        input.setAttribute('required', 'required');
                                                    }
                                                } else {
                                                    input.removeAttribute('required');
                                                }
                                            }
                                        });

                                        cancelElements.forEach(element => {
                                            element.classList.add('hidden');
                                            const input = element.querySelector('input');
                                            if (input) {
                                                input.removeAttribute('required');
                                                input.value = '';
                                            }
                                        });

                                        issueElements.forEach(element => {
                                            element.classList.add('hidden');
                                            const input = element.querySelector('input');
                                            if (input) {
                                                input.removeAttribute('required');
                                                input.value = '';
                                            }
                                        });
                                    });


                                    issueRequestBtn.addEventListener('click', function () {
                                        issueElements.forEach(element => {
                                            element.classList.toggle('hidden');

                                            const input = element.querySelector('input');
                                            if (!element.classList.contains('hidden')) {
                                                input.setAttribute('required', 'required');
                                            } else {
                                                input.removeAttribute('required');
                                            }
                                        });
                                        mobileElements.forEach(element => {
                                            element.classList.add('hidden');
                                            const input = element.querySelector('input');
                                            if (input) {
                                                input.removeAttribute('required');
                                                input.value = '';
                                            }
                                        });
                                        cancelElements.forEach(element => {
                                            element.classList.add('hidden');
                                            const input = element.querySelector('input');
                                            if (input) {
                                                input.removeAttribute('required');
                                                input.value = '';
                                            }
                                        });
                                    });

                                    const namedQuery = editSimRequestFormId.querySelectorAll(":is(input, select)[name]");
                                    const namedElements = Array.from(namedQuery);

                                    headers.forEach((header) => {
                                        const targetElement = namedElements.find(
                                            (element) => element.name === header
                                        );

                                        if (targetElement) {
                                            targetElement.value = rowData[header];
                                        }
                                    });

                                    if (rowData.PURCHASING_RS_NO && !rowData.MOBILE_ID) {
                                        const mobileHeaders = [
                                            "MOBILE_ID",
                                            "STATUS",
                                            "RR_NO",
                                            "RR_DATE",
                                            "DATE_CONFIGURED_BY_IT",
                                            "IMEI",
                                            "BRAND",
                                            "MODEL",
                                            "COLOR",
                                            "RAM_ROM",
                                            "CAMERA",
                                        ]

                                        const sheetValues = await Promise.all([$.getConsolidatedMobileInventory(mobileHeaders)]);

                                        const mobileDeviceIdElement = document.querySelector('input[name="MOBILE_ID"]');
                                        const mobileList = document.getElementById(mobileDeviceIdElement.getAttribute("list"));
                                        const imeiElement = document.querySelector('input[name="IMEI"]');
                                        const colorElement = document.querySelector('input[name="COLOR"]');
                                        const brandElement = document.querySelector('input[name="BRAND"]');
                                        const modelElement = document.querySelector('input[name="MODEL"]');
                                        const ramRomElement = document.querySelector('input[name="RAM_ROM"]');
                                        const cameraElement = document.querySelector('input[name="CAMERA"]');

                                        const [mobileDetails] = sheetValues.map((json) => JSON.parse(json));

                                        const mobileDetailsArray = mobileDetails.map((mobileDetails) => Object.values(mobileDetails));

                                        const mappedMobileDetails = {};
                                        const mobileDeviceIdFragment = new DocumentFragment();

                                        function appendOptionIfNotExist(fragment, value) {
                                            if (!fragment.querySelector(`option[value="${value}"]`)) {
                                                const option = document.createElement("option");
                                                option.value = value;
                                                option.textContent = value;
                                                fragment.appendChild(option);
                                            }
                                        }

                                        mobileDetailsArray.forEach((row) => {
                                            const data = row.reduce((acc, cell, cellIndex) => {
                                                const header = mobileHeaders[cellIndex];
                                                acc[header] = cell;
                                                return acc;
                                            }, {});

                                            const {
                                                MOBILE_ID,
                                                STATUS,
                                                RR_NO,
                                                RR_DATE,
                                                DATE_CONFIGURED_BY_IT,
                                                IMEI,
                                                BRAND,
                                                MODEL,
                                                COLOR,
                                                RAM_ROM,
                                                CAMERA,
                                            } = data;

                                            mappedMobileDetails[MOBILE_ID] = {
                                                imei: IMEI,
                                                color: COLOR,
                                                brand: BRAND,
                                                model: MODEL,
                                                ramRom: RAM_ROM,
                                                camera: CAMERA,
                                            };

                                            appendOptionIfNotExist(mobileDeviceIdFragment, MOBILE_ID);

                                        });

                                        mobileList.appendChild(mobileDeviceIdFragment);

                                        mobileDeviceIdElement.addEventListener("change", function () {
                                            const mobileDeviceId = this.value;
                                            const details = mappedMobileDetails[mobileDeviceId] || {};

                                            imeiElement.value = details.imei || "";
                                            colorElement.value = details.color || "";
                                            brandElement.value = details.brand || "";
                                            modelElement.value = details.model || "";
                                            ramRomElement.value =
                                                details.ramRom || "";
                                            cameraElement.value =
                                                details.camera || "";
                                        });
                                    } else {
                                        console.log("Purchasing No has no value, no need to load the data.");
                                    }
                                    let isSubmitted = false;
                                    editSimRequestFormId.addEventListener("submit", async function (event) {
                                        event.preventDefault();

                                        const submitButtonId = document.getElementById("submitButtonId");

                                        submitButtonId.innerHTML = 'Submitting <span class="AnimatedEllipsis"></span>';

                                        submitButtonId.disabled = true;
                                        submitButtonId.classList.add('cursor-not-allowed', 'opacity-50');

                                        const swalCloseButton = Swal.getCloseButton();
                                        if (swalCloseButton) {
                                            swalCloseButton.disabled = true;
                                        }

                                        if (isSubmitted) {
                                            return;
                                        }


                                        isSubmitted = true;
                                        try {
                                            const formData = new FormData(this);
                                            const formObject = Object.fromEntries(formData);
                                            const mobileId = rowData.MOBILE_ID;
                                            const existingmobileInfo = rowData.MOBILE_INFO;
                                            const issuanceNo = rowData.ISSUANCE_NO;
                                            const charger = rowData.CHARGER;
                                            const earphones = rowData.EARPHONES;
                                            const others = rowData.OTHERS;

                                            if (mobileId) {
                                                formObject.MOBILE_ID = mobileId;
                                            }
                                            if (issuanceNo) {
                                                formObject.ISSUANCE_NO = issuanceNo;
                                            }
                                            if (charger) {
                                                formObject.CHARGER = charger;
                                            }
                                            if (earphones) {
                                                formObject.EARPHONES = earphones;
                                            }
                                            if (others) {
                                                formObject.OTHERS = others;
                                            }
                                            if (!!existingmobileInfo) {
                                                formObject.MOBILE_INFO = existingmobileInfo;
                                            }

                                            if (!mobileId) {
                                                const mobileInfo = {
                                                    IMEI: formObject.IMEI,
                                                    BRAND: formObject.BRAND,
                                                    MODEL: formObject.MODEL,
                                                    COLOR: formObject.COLOR,
                                                }
                                                formObject.MOBILE_INFO = JSON.stringify(mobileInfo);
                                            }
                                            const query = { REQUEST_NO: requestNo };
                                            const isEdited = await $.editDataToMobileRequest(query, formObject);

                                            if (isEdited) {
                                                await initializeTable();
                                                Swal.close();
                                                toast.success({
                                                    title: "Record Update Success",
                                                    description: "The record has been updated succesfully",
                                                    timeout: 4000,
                                                    closeButton: false,
                                                })

                                            } else {
                                                toast.error({
                                                    title: "Record Update Failed",
                                                    description: "Failed to update the record. Please try again.",
                                                    timeout: 4000,
                                                    closeButton: false,
                                                })
                                            }
                                        } catch (error) {
                                            console.error(error);
                                        }
                                        finally {
                                            isSubmitted = false; // Reset the submission lock
                                        }
                                    }
                                    );
                                },
                            });
                        }
                    });

                    const printButton = generateActionButton(vectors.print, {
                        class: 'px-2 py-2 bg-neutral-500 text-white rounded',
                    }, row);

                    const issuanceNo = rowData["ISSUANCE_NO"];
                    const hasIssuanceNo = !!issuanceNo;
                    const preIssuanceDate = rowData["PRE_ISSUANCE_DATE"];
                    const hasPreIssuanceDate = !!preIssuanceDate;

                    if (!isRS || !hasIssuanceNo || hasPreIssuanceDate) {
                        printButton.disabled = true;
                        printButton.classList.add("opacity-50", "cursor-not-allowed");

                    }

                    printButton.addEventListener("click", function (e) {
                        const indexOfRequestNo = headers.indexOf("REQUEST_NO");
                        const requestNo = row[indexOfRequestNo];

                        const employeeInfoString = rowData["EMPLOYEE_INFO"];
                        const hasEmployeeInfo = !!employeeInfoString;
                        const employeeInfo = hasEmployeeInfo
                            ? JSON.parse(employeeInfoString)
                            : ``;
                        const mobileInfoString = rowData["MOBILE_INFO"];
                        const hasMobileInfo = !!mobileInfoString;
                        const mobileInfo = hasMobileInfo
                            ? JSON.parse(mobileInfoString)
                            : ``;

                        if (indexOfRequestNo >= 0) {
                            const dateValue = new Date();
                            const textValue = DateTime(dateValue, {
                                format: "MM-DD-YYYY",
                            });
                            Swal.fire({
                                html: `
                      <div id="generateIssuanceTemplateId" class="p-2 mb-2 relative">
                        <div>
                          <h3 class="font-bold text-left">Mobile Issuance Template</h1>
                          <div class="text-left text-sm text-gray-500 font-medium">Kindly adjust the print settings to: default settings and paper size A4.</div>
                          <hr class="h-px mt-2 mb-4 bg-gray-200 border-0 ">
                        <div>
                        <div id="issuanceContainerId" class="relative">
                          <table id="printTable" class="w-full table-fixed bg-white border border-black border-separate border-spacing-0 noPrint">
                            <tbody>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white border-b-black border-r-black">CONTROL NO.</td>
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">HR-003-015-000</td>
                                <td colspan="1" rowspan="3" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white border-l-black"></td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="3" rowspan="3" class="text-left px-2 py-1 font-bold text-2xl w-30 border border-white">MOBILE DEVICE ISSUANCE FORM</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white border-r-black border-b-black">DATE CREATED</td>
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">7/27/2022</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td>  
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white border-r-black">DATE OF LAST UPDATE</td>
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white">7/28/2022</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="8" class=" bg-[#93c47d] bg-opacity-70 text-left px-2 py-1 font-bold text-xs border border-[#93c47d] border-t-black border-b-black">EMPLOYEE DETAILS</td>
                              </tr>
                              <tr>
                                <td colspan="8" class="p-1 border border-white"></td>
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Group ID</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black items-center justify-center">${rowData?.GROUP_ID ?? ` `}</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white">Issuance No.</td> 
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xl w-30 border border-black">${rowData?.ISSUANCE_NO ?? ` `}</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Name</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${employeeInfo?.FULL_NAME ?? ` `}</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white">Issuance Date</td> 
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${textValue ?? ` `}</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Position</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${employeeInfo?.POSITION ?? ` `}</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white">Issuance Type</td> 
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${rowData?.OWNERSHIP ?? ` `}</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Department-Section</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">
                                ${employeeInfo.DEPARTMENT
                                        ? employeeInfo.SECTION
                                            ? `${employeeInfo.DEPARTMENT} - ${employeeInfo.SECTION}`
                                            : employeeInfo.DEPARTMENT
                                        : employeeInfo.SECTION
                                            ? employeeInfo.SECTION
                                            : " "
                                    }
                                </td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white"></td> 
                                <td colspan="2" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white"></td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Branch/Site</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">
                                ${employeeInfo.BRANCH
                                        ? employeeInfo.SITE
                                            ? `${employeeInfo.BRANCH} / ${employeeInfo.SITE}`
                                            : employeeInfo.BRANCH
                                        : employeeInfo.SITE
                                            ? employeeInfo.SITE
                                            : " "
                                    }
                                </td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white"></td> 
                                <td colspan="2" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white"></td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="p-1 w-10 border border-white"></td>
                                <td colspan="2" class="p-1 w-10 border border-white "></td>
                                <td colspan="1" class="p-1 w-10 border border-white"></td> 
                                <td colspan="1" class="p-1 w-10 border border-white"></td> 
                                <td colspan="2" class="p-1 w-10 border border-white"></td> 
                                <td colspan="1" class="p-1 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="8" class=" bg-[#93c47d] bg-opacity-70 text-left px-2 py-1 font-bold text-xs border border-[#93c47d] border-t-black border-b-black">DEVICE INFORMATION</td>
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Mobile Device No.</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${rowData?.MOBILE_ID ?? ` `}</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white"></td> 
                                <td colspan="2" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white"></td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">IMEI</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${mobileInfo?.IMEI ?? ` `}</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white ">Charger</td> 
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${rowData?.CHARGER ?? ` `}</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Description</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">
                                ${!!mobileInfo.BRAND
                                        ? `${mobileInfo.BRAND}-${mobileInfo.MODEL}-${mobileInfo.COLOR}`
                                        : ` `
                                    }
                               </td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white">Earphones</td> 
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${rowData?.EARPHONES ?? ` `}</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-1 font-bold text-xs w-30 border border-white">Condition</td>
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${rowData?.CONDITION_TYPE ?? ` `}</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="text-left px-4 py-1 font-bold text-xs w-30 border border-white">Others</td> 
                                <td colspan="2" class="text-center px-4 py-1 font-bold text-xs w-30 border border-white border-b-black">${rowData?.OTHERS ?? ` `}</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="1" class="p-1 w-10 border border-white"></td>
                                <td colspan="2" class="p-1 w-10 border border-white "></td>
                                <td colspan="1" class="p-1 w-10 border border-white"></td> 
                                <td colspan="1" class="p-1 w-10 border border-white"></td> 
                                <td colspan="2" class="p-1 w-10 border border-white"></td> 
                                <td colspan="1" class="p-1 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="8" class=" bg-[#93c47d] bg-opacity-70 text-left px-2 py-1 font-bold text-xs border border-[#93c47d] border-t-black border-b-black">HUMAN RESOURCE DEPARTMENT</td>
                              </tr>
                              <tr>
                                <td colspan="2" class="text-center pt-2 pb-5 py-.5 font-bold text-xs w-30 border border-white">Issued By:</td>
                                <td colspan="1" class="pt-2 pb-5 border border-white"></td>
                                <td colspan="1" class="pt-2 pb-5 w-10 border border-white"></td> 
                                <td colspan="2" class="text-center pt-2 pb-5 py-.5 font-bold text-xs w-30 border border-white">Approved By:</td> 
                                <td colspan="1" class="pt-2 pb-5 w-10 border border-white"></td> 
                                <td colspan="1" class="pt-2 pb-5 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="2" class="text-center px-2 py-.5 font-bold text-xs w-30 border border-white underline">DANIELLA S.D. SERRANO</td>
                                <td colspan="1" class="p-0 border border-white"></td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="2" class="text-center px-4 py-.5 font-bold text-xs w-30 border border-white underline">RIENALYN E. VILLANUEVA</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="2" class="text-center px-2 py-.5 font-bold text-xs w-30 border border-white ">Signature over Printed Name</td>
                                <td colspan="1" class="text-left px-2 py-.5 font-bold text-xs w-30 border border-white">Date</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                                <td colspan="2" class="text-center px-4 py-.5 font-bold text-xs w-30 border border-white ">Signature over Printed Name</td> 
                                <td colspan="1" class="text-left px-2 py-.5 font-bold text-xs w-30 border border-white">Date</td> 
                                <td colspan="1" class="p-0 w-10 border border-white"></td> 
                              </tr>
                              <tr>
                                <td colspan="8" class=" bg-[#93c47d] bg-opacity-70 text-left px-2 py-1 font-bold text-xs border border-[#93c47d] border-t-black border-b-black">TERMS & CONDITIONS</td>
                              </tr>
                              <tr>
                                <td colspan="8" class="text-left px-2 py-.5 font-bold text-[10px] w-30 border border-white">1. I will only use the mobile device for work-related activities and in compliance with the restricted personal use that has been allowed. </td>
                              </tr>
                              <tr>
                                <td colspan="8" class="text-left px-2 py-.5 font-bold text-[10px] w-30 border border-white">2. I won't change, "jailbreak," or otherwise modify the device to go around the operating system security measures put in place by the manufacturer.</td>
                              </tr>
                              <tr>
                                <td colspan="8" class="text-left px-2 py-.5 font-bold text-[11px] w-30 border border-white">3. I will immediately report the damage, loss, or theft of the device to the Human Resources Department.</td>
                              </tr>
                              <tr>
                                <td colspan="8" class="text-left px-2 py-.5 font-bold text-[10px] w-30 border border-white">4. I am responsible for returning the device when it is no longer required to carry out my work assignments, transferred or terminated in the company.</td>
                              </tr>
                              <tr>
                                <td colspan="8" class="text-left px-2 py-.5 font-bold text-[10px] w-30 border border-white whitespace-pre-line">5. I understand that violating these terms and conditions could result in loss of privileges; I may be held financially liable for any cost associated with improper use, and/or may result to disciplinary action.</td>
                              </tr>
                              <tr>
                                <td colspan="8" class=" bg-[#93c47d] bg-opacity-70 text-left px-2 py-1 font-bold text-xs border border-[#93c47d] border-t-black border-b-black">EMPLOYEE CERTIFICATION</td>
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-.5 font-bold text-xs w-30 border border-white"></td>
                                <td colspan="5" class="text-center pt-7 font-bold text-xs w-30 border border-white underline">${employeeInfo?.FULL_NAME ?? ` `}</td>
                                <td colspan="1" class="text-left px-4 py-.5 font-bold text-xs w-30 border border-white"></td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td>
                              </tr>
                              <tr>
                                <td colspan="1" class="text-left px-2 py-.5 font-bold text-xs w-30 border border-white"></td>
                                <td colspan="5" class="text-center px-2 py-.5 font-bold text-xs w-30 border border-white">Signature over Printed Name</td>
                                <td colspan="1" class="text-left px-2 py-.5 font-bold text-xs w-30 border border-white">Date</td>
                                <td colspan="1" class="p-0 w-10 border border-white"></td>
                              </tr>
                            </tbody>
                          </table>
                         <div id="print-button-wrapper" class="hidden absolute inset-0 flex justify-center items-center">
                            <button type="button" id="print-button-id" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                                Print Template
                            </button>
                        </div>

                        </div>
                      </div>
                      `,
                                showConfirmButton: false,
                                customClass: "swal-template",
                                showCloseButton: true,
                                allowOutsideClick: false,
                                didOpen: async () => {

                                    const generateIssuanceTemplateId = document.getElementById(
                                        "generateIssuanceTemplateId"
                                    );
                                    const printTable = document.getElementById(
                                        "printTable"
                                    );

                                    const btn = document.getElementById("print-button-id");
                                    btn.addEventListener("click", async function (event) {
                                        try {
                                            event.preventDefault();

                                            btn.innerHTML = 'Printing <span class="AnimatedEllipsis"></span>';

                                            btn.disabled = true;
                                            btn.classList.add('cursor-not-allowed');

                                            const swalCloseButton = Swal.getCloseButton();
                                            if (swalCloseButton) {
                                                swalCloseButton.disabled = true;
                                            }
                                            const preIssuanceDate = {
                                                PRE_ISSUANCE_DATE: textValue
                                            };

                                            const query = { REQUEST_NO: requestNo };
                                            const isEdited = await $.editDataToMobileRequest(
                                                query,
                                                preIssuanceDate
                                            );

                                            if (isEdited) {
                                                initializeTable();
                                                Swal.close();
                                                toast.success({
                                                    title: "Template Print Success",
                                                    description: "The template has been printed succesfully",
                                                    timeout: 7000,

                                                })
                                                const printContents = printTable.outerHTML;
                                                const printWindow = window.open("", "_blank");
                                                const currentHead = document.head.innerHTML;
                                                printWindow.document.write(
                                                    `<html>
                                  <head>
                                      <title>Preview of Sim Issuance Template</title>
                                      ${currentHead}
                                      <style>
                                          body {
                                              display: flex;
                                              flex-direction: column;
                                              justify-content: flex-start;
                                              align-items: left;
                                              box-sizing: border-box;
                                              padding: 5px;                                         
                                          }
                                          .print-section {
                                              width: 1050px !important;
                                          }
                                          hr.dashed-line {
                                            border-top: 2px dashed #686D76; 
                                            width: 100%;
                                            margin: 20px 0;
                                          }
                                          @media print {
                                            .print-section {
                                                  margin: 0 auto;
                                                  padding: 0; 
                                              }
                                            table {
                                                width: 99% !important; 
                                                border-collapse: collapse;
                                                border-spacing: 0;
                                            }
                                            td, th {
                                                padding: 0px; 
                                                margin: 0; 
                                            }
                                            .table-wrapper {
                                                width: 1050px;
                                                margin: 0 auto; 
                                                padding: 0;
                                            }
                                          }
                                      </style>
                                  </head>
                                  <body>
                                      <div class="print-section">${printContents}</div>
                                      <hr class="dashed-line">
                                      <div class="print-section">${printContents}</div>
                                  </body>
                              </html>`
                                                );
                                                printWindow.document.close();
                                                printWindow.document.close();
                                                printWindow.onload = async function () {
                                                    printWindow.print();
                                                };
                                                printWindow.onafterprint = function () {
                                                    btn.disabled = false;
                                                };
                                            } else {
                                                toast.error({
                                                    title: "Template Print Failed",
                                                    description: "The template could not be printed. Please try again.",
                                                    timeout: 7000,

                                                })
                                            }

                                        } catch (error) {
                                            console.error(error);
                                        }
                                    });
                                },
                            });
                        }
                    });

                    actionDiv.appendChild(viewButton);
                    actionDiv.appendChild(editButton);
                    actionDiv.appendChild(printButton);
                    actionTd.appendChild(actionDiv);
                    tr.appendChild(actionTd);

                    tbody.appendChild(tr);
                });
            }

            const table = document.getElementById("tablejs");
            const instance = new TableJS(table, {
                dataset: {
                    init: false,
                    collection: Array.from({ length: 1 }, () =>
                        headers.reduce((acc, item) => ({ ...acc, [item]: "No data " }))
                    ),
                    rendering: renderTable,
                },
                colvis: {
                    element: "div#table-colvis",
                    exclude: [".checkbox-column", ".actions-column"],
                    hide: [],
                },
                exportAs: [
                    {
                        as: "csv",
                        element: "button#export-csv",
                        filename: "SPPM",
                        exclude: [".checkbox-column", ".actions-column"],
                    },
                ],
                paginate: [
                    {
                        to: "api",
                        as: "limit",
                        element: "select#pagination-limit",
                        output: output.pagination,
                    },
                    {
                        to: "api",
                        as: "next",
                        element: "button#pagination-next",
                        output: output.pagination,
                    },
                    {
                        to: "api",
                        as: "previous",
                        element: "button#pagination-previous",
                        output: output.pagination,
                    },
                    {
                        to: "local",
                        as: "search",
                        element: "input#pagination-search",
                        exclude: [".checkbox-column", ".actions-column"],
                        output: output.pagination,
                    },
                ],
            });

            async function initializeTable() {
                try {
                    const dataset = await $.selectColumnsFromSheet(
                        "PHONE_REQUEST_AND_ISSUANCE",
                        headers
                    );
                    console.warn({ dataset });
                    const parsed = JSON.parse(dataset);
                    const array = Array.from(parsed);
                    instance.setDataset(array).render();
                } catch (error) {
                    console.error(error);
                }
            }

            document
                .getElementById("add-modal-toggle")
                .addEventListener("click", function () {
                    Swal.fire({
                        html: `
                  <form id="addMobileRequestFormId" class="p-4 md:p-5">
                    <div>
                      <h3 class="font-bold text-left">Add Mobile Request Details</h1>
                      <hr class="h-px mt-2 mb-4 bg-gray-200 border-0 ">
                    <div>
                    <div class="grid gap-4 mb-4 grid-cols-4">
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="requestTypeId">
                          <div class="text-sm font-semibold ">Request Type</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <select id="requestTypeId" name="REQUEST_TYPE" required
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <option selected value="">Select Request Type</option>
                            <option value="New">New</option>
                            <option value="Replacement">Replacement</option>
                            <option value="Upgrade">Upgrade</option>
                            <option value="Temporary">Temporary</option>
                        </select>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="receivedAndApproveDateId">
                          <div class="text-sm font-semibold">Received Date</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required type="date" id="receivedAndApproveDateId" name="RECEIVED_AND_APPROVED_DATE" placeholder="Received and Approved Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="ownershipId">
                          <div class="text-sm font-semibold">Ownership</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <select id="ownershipId" name="OWNERSHIP" required
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <option selected value="">Select Ownership</option>
                            <option value="Individual">Individual</option>
                            <option value="Group">Group</option>
                        </select>
                      </div>
                      <div class="col-span-2 hidden is-group">
                        <label class="flex space-x-2" for="sectionGroupNameId">
                          <div class="text-sm font-semibold">Section Group Name</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input type="text" id="sectionGroupNameId" name="SECTION_GROUP_NAME" placeholder="Section Group Name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" disabled/>
                      </div>
                      <div class="col-span-2 hidden is-group">
                        <label class="flex space-x-2" for="remarksId">
                          <div class="text-sm font-semibold">Remarks</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input disabled type="text" id="remarksId" name="REMARKS" placeholder="Remarks" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="groupId">
                          <div class="text-sm font-semibold">Group Id</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required list="groupIds" id="groupId" name="GROUP_ID" autocomplete="off"
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                        <datalist id="groupIds">
                        </datalist>
                      </div>
                      <div class="col-span-1">
                        <label class="flex space-x-2" for="employeeNoId">
                          <div class="text-sm font-semibold">Employee NO</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required list="employeeNoIds" id="employeeNoId" name="EMPLOYEE_NO" autocomplete="off"
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                        <datalist id="employeeNoIds">
                        </datalist>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="employeeNameId">
                          <div class="text-sm font-semibold">Employee Name</div>
                          <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                        </label>
                        <input required list="employeeNameIds" id="employeeNameId" name="FULL_NAME" autocomplete="off"
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                        <datalist id="employeeNameIds">
                        </datalist>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="companyNameId">
                          <span class="text-sm font-semibold">Company</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="companyNameId" name="COMPANY_NAME" placeholder="Company (Employee)" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="positionId">
                          <span class="text-sm font-semibold">Position</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="positionId" name="POSITION" placeholder="Position" class=" cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="departmentId">
                          <span class="text-sm font-semibold">Department</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="departmentId" name="DEPARTMENT" placeholder="Department" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-2">
                        <label class="flex space-x-2" for="sectionId">
                          <span class="text-sm font-semibold">Section</span>
                          <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                          <span class="text-red-400"> </span>
                        </label>
                        <input type="text" id="sectionId" name="SECTION" placeholder="Section" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-1 hidden">
                        <input type="text" id="branchId" name="BRANCH" placeholder="Branch" class="cursor-default bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-1 hidden">
                        <input type="text" id="siteId" name="SITE" placeholder="Site" class="cursor-default bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-1 hidden">
                        <input type="text" id="accountingCodeId" name="ACCOUNTING_CODE" placeholder="Site" class="cursor-default bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-1 hidden">
                        <input type="text" id="employmentTypeId" name="EMPLOYMENT_TYPE" placeholder="Employment Type" class="cursor-default bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300 dark:focus:ring-white dark:focus:border-gray-300" readonly/>
                      </div>
                      <div class="col-span-4  border-b" id="simDetailsCollapse"> 
                        <button class="accordion-button flex items-center justify-between w-full py-2 text-left text-sm font-semibold" type="button" id="toggleItem1">
                            Employee Issued Sim Details
                            <svg class="w-4 h-4 ml-2 transition-transform transform" id="icon1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="collapseOne" class="accordion-content hidden">
                            <div class="accordion-body p-4">
                                <table id="simTable" class="min-w-full table-auto border text-sm text-neutral-700">
                                  <thead id="tableSimHeader">
                                  </thead>
                                  <tbody id="tableSimBody">
                                  </tbody>
                                </table>
                            </div>
                        </div>
                      </div>
                      <div class="col-span-4" id="mobileDetailsCollapse"> 
                        <div class="flex items-center justify-between w-full pb-2 text-left text-sm font-semibold">
                            Select Mobile Phone Source 
                        </div>
                        <div class="text-left p-1 grid gap-4 mb-0 grid-cols-2">
                          <div class="flex items-center ps-4 border border-gray-200 rounded-lg dark:border-gray-700">
                              <input id="stockedRadio" type="radio" value="Stocked" name="bordered-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500">
                              <label for="bordered-radio-1" class="w-full py-4 ms-2 text-sm font-medium text-gray-900">Mobile Inventory (Stocked)</label>
                          </div>
                          <div class="flex items-center ps-4 border border-gray-200 rounded-lg dark:border-gray-700">
                              <input id="newRequestRadio" type="radio" value="New Request" name="bordered-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500">
                              <label for="bordered-radio-2" class="w-full py-4 ms-2 text-sm font-medium text-gray-900">IT Department (New Request)</label>
                          </div>
                        </div>
                        <div id="collapseTwo is-stocked hidden">
                            <div class="accordion-body p-2 grid gap-4 mb-2 grid-cols-4 is-stocked hidden">
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="mobileDeviceId">
                                    <div class="text-sm font-semibold">Mobile Device ID</div>
                                    <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                                  </label>
                                  <input list="mobileDeviceIds" id="mobileDeviceId" name="MOBILE_ID" placeholder="Mobile Device ID" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"/>
                                  <datalist id="mobileDeviceIds">
                                  </datalist>
                                </div>
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="colorId">
                                    <div class="text-sm font-semibold">Color</div>
                                    <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                  </label>
                                  <input type="text" id="colorId" name="COLOR" placeholder="Color" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                                </div>
                                <div class="col-span-2 is-stocked hidden">
                                  <label class="flex space-x-2" for="brandNameId">
                                    <div class="text-sm font-semibold">Brand Name</div>
                                    <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                  </label>
                                  <input type="text" id="brandNameId" name="BRAND" placeholder="Brand Name" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                                </div>
                                <div class="col-span-2 is-stocked hidden">
                                  <label class="flex space-x-2" for="modelNameId">
                                    <div class="text-sm font-semibold">Model Name</div>
                                    <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                  </label>
                                  <input type="text" id="modelNameId" name="MODEL" placeholder="Model Name" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                                </div>
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="ramRomId">
                                    <div class="text-sm font-semibold">RAM-ROM</div>
                                    <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                  </label>
                                  <input type="text" id="ramRomId" name="RAM_ROM" placeholder="XXGB-XXGB" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                                </div>
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="cameraId">
                                    <div class="text-sm font-semibold">Camera</div>
                                    <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                  </label>
                                  <input type="text" id="cameraId" name="CAMERA" placeholder="XXMP-XXMP" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                                </div>
                                <div class="col-span-1 hidden">
                                  <label class="flex space-x-2" for="imeiId">
                                    <div class="text-sm font-semibold">IMEI</div>
                                    <span class="bg-blue-100 text-blue-800 text-[9px] rounded-full mb-3 py-1 px-2">Automatic</span>
                                  </label>
                                  <input type="text" id="imeiId" name="IMEI" placeholder="" class="cursor-default bg-neutral-200 border border-gray-300 text-gray-900 text-sm rounded-lg  block w-full p-2.5 focus:ring-white focus:border-gray-300" readonly/>
                                </div>
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="earphonesId">
                                    <div class="text-sm font-semibold">Earphones</div>
                                    <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                  </label>
                                  <div class="text-left p-1 is-stocked hidden">
                                    <input type="hidden" name="EARPHONES" value="Not Included">
                                    <input id="earphonesId" name="EARPHONES" type="checkbox" value="Included" class="items-center w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="earphonesId" class="pt-8 ms-2 text-sm">Item Included</label>
                                  </div>
                                </div>
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="chargerId">
                                    <div class="text-sm font-semibold">Charger</div>
                                    <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                  </label>
                                  <div class="text-left p-1 is-stocked hidden">
                                    <input type="hidden" name="CHARGER" value="Not Included">
                                    <input id="chargerId" name="CHARGER" type="checkbox" value="Included" class="items-center w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="chargerId" class="pt-8 ms-2 text-sm">Item Included</label>
                                  </div>
                                </div>
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="otherId">
                                    <div class="text-sm font-semibold">Others</div>
                                    <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                  </label>
                                  <input type="text" id="otherId" name="OTHERS" placeholder="Other Accessories" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"/>
                                </div>
                                <div class="col-span-1 is-stocked hidden">
                                  <label class="flex space-x-2" for="conditionId">
                                    <div class="text-sm font-semibold">Condition Type</div>
                                    <span class="bg-red-100 text-red-800 text-[9px] rounded-full mb-3 py-1 px-2">Required</span>
                                  </label>
                                  <select id="conditionId" name="CONDITION_TYPE" required
                                      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                                      <option selected value="">Select Ownership</option>
                                      <option value="Brand New">Brand New</option>
                                      <option value="Second Hand">Second hand</option>
                                  </select>
                                </div>
                            </div>
                        </div>
                        <div id="collapseTwo is-new hidden">
                          <div class="accordion-body p-2 grid gap-4 mb-2 grid-cols-4 is-new hidden">
                              <div class="hidden col-span-2 is-new">
                                  <label class="flex space-x-2" for="purchasingRsNoId">
                                  <div class="text-sm font-semibold">Purchasing RS No</div>
                                  <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                  </label>
                                  <input  type="text" id="purchasingRsNoId" name="PURCHASING_RS_NO" placeholder="Purchasing RS No" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                              </div>
                              <div class="hidden col-span-2 is-new">
                                  <label class="flex space-x-2" for="purchasingRsDateId">
                                  <div class="text-sm font-semibold">Purchasing RS Date</div>
                                  <span class="bg-gray-200 text-gray-800 text-[9px] rounded-full mb-3 py-1 px-2">Optional</span>
                                  </label>
                                  <input  type="date" id="purchasingRsDateId" name="PURCHASING_RS_DATE" placeholder="Purchasing RS Date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
                              </div>
                          </div>
                        </div>
                      </div>
                      <input type="hidden" name="REQUEST_STATUS">
                    </div>
                    <div class="flex justify-end pt-2">
                      <button id="submitButtonId" type="submit"
                          class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                          Submit
                      </button>
                    </div>
                    
                  </form>
                `,
                        showConfirmButton: false,
                        customClass: "swal-wide",
                        showCloseButton: true,
                        allowOutsideClick: false,
                        didOpen: async () => {

                            const addMobileRequestFormId = document.getElementById('addMobileRequestFormId');

                            document.getElementById('toggleItem1').addEventListener('click', function () {
                                const content = document.getElementById('collapseOne');
                                const arrow = document.getElementById('icon1');

                                content.classList.toggle('hidden');

                                if (content.classList.contains('hidden')) {
                                    arrow.classList.remove('rotate-180');
                                } else {
                                    arrow.classList.add('rotate-180');
                                }
                            });

                            const stockedRadio = document.getElementById('stockedRadio');
                            const newRequestRadio = document.getElementById('newRequestRadio');
                            const isStocked = document.querySelectorAll('.is-stocked');
                            const isNew = document.querySelectorAll('.is-new');

                            stockedRadio.addEventListener('click', function () {
                                isStocked.forEach(element => {
                                    element.classList.toggle('hidden');
                                });

                                isNew.forEach(element => {
                                    element.classList.add('hidden');

                                    const elements = element.querySelectorAll('input, select');

                                    elements.forEach(el => {

                                        if (el.type === 'checkbox') {
                                            // Uncheck the checkbox
                                            el.checked = false;
                                        } else {
                                            el.value = ''; // Clear value for other inputs and selects
                                        }
                                    });
                                });
                            });

                            newRequestRadio.addEventListener('click', function () {

                                isNew.forEach(element => {
                                    element.classList.toggle('hidden');
                                });

                                isStocked.forEach(element => {
                                    element.classList.add('hidden');

                                    const elements = element.querySelectorAll('input, select');

                                    elements.forEach(el => {
                                        el.removeAttribute('required');

                                        if (el.type === 'checkbox') {
                                            // Uncheck the checkbox
                                            el.checked = false;
                                        } else {
                                            el.value = ''; // Clear value for other inputs and selects
                                        }
                                    });
                                });
                            });

                            new FieldManager("ownershipId", [
                                {
                                    elements: document.querySelectorAll(".is-group"),
                                    condition: (value) => value === "GROUP",
                                },
                            ]);

                            const employeeHeaders = [
                                "GROUP_ID",
                                "EMPLOYEE_NO",
                                "FULL_NAME",
                                "DATE_HIRED",
                                "EMPLOYEE_INFO",
                                "SIM_CARD_ID",
                                "MOBILE_NO",
                            ];

                            const mobileHeaders = [
                                "MOBILE_ID",
                                "STATUS",
                                "RR_NO",
                                "RR_DATE",
                                "DATE_CONFIGURED_BY_IT",
                                "IMEI",
                                "BRAND",
                                "MODEL",
                                "COLOR",
                                "RAM_ROM",
                                "CAMERA",

                            ]

                            const sheetValues = await Promise.all([
                                $.getConsolidatedEmployeewithSim(employeeHeaders),
                                $.getConsolidatedMobileInventory(mobileHeaders),
                            ]);


                            const groupIdElement = document.querySelector('input[name="GROUP_ID"]');
                            const groupIdDatalist = document.getElementById(groupIdElement.getAttribute("list"));
                            const employeeNoElement = document.querySelector('input[name="EMPLOYEE_NO"]');
                            const employeeNoDatalist = document.getElementById(employeeNoElement.getAttribute("list"));
                            const fullNameElement = document.querySelector('input[name="FULL_NAME"]');
                            const fullNameDatalist = document.getElementById(fullNameElement.getAttribute("list"));
                            const companyNameElement = document.querySelector('input[name="COMPANY_NAME"]');
                            const departmentElement = document.querySelector('input[name="DEPARTMENT"]');
                            const sectionElement = document.querySelector('input[name="SECTION"]');
                            const positionElement = document.querySelector('input[name="POSITION"]');
                            const branchElement = document.querySelector('input[name="BRANCH"]');
                            const siteElement = document.querySelector('input[name="SITE"]');
                            const accountingCodeElement = document.querySelector('input[name="ACCOUNTING_CODE"]');
                            const employmentTypeElement = document.querySelector('input[name="EMPLOYMENT_TYPE"]');

                            const mobileDeviceIdElement = document.querySelector('input[name="MOBILE_ID"]');
                            const mobileList = document.getElementById(mobileDeviceIdElement.getAttribute("list"));
                            const imeiElement = document.querySelector('input[name="IMEI"]');
                            const colorElement = document.querySelector('input[name="COLOR"]');
                            const brandElement = document.querySelector('input[name="BRAND"]');
                            const modelElement = document.querySelector('input[name="MODEL"]');
                            const ramRomElement = document.querySelector('input[name="RAM_ROM"]');
                            const cameraElement = document.querySelector('input[name="CAMERA"]');

                            const [employeeDetails, mobileDetails] =
                                sheetValues.map((json) => JSON.parse(json));

                            const employeeDetailsArray = employeeDetails.map((employeeDetails) => Object.values(employeeDetails));
                            const mobileDetailsArray = mobileDetails.map((mobileDetails) => Object.values(mobileDetails));

                            console.log(mobileDetails)
                            const mappedEmployeeDetails = {};
                            const mappedMobileDetails = {};

                            const groupIdFragment = new DocumentFragment();
                            const employeeNoFragment = new DocumentFragment();
                            const fullNameFragment = new DocumentFragment();

                            const mobileDeviceIdFragment = new DocumentFragment();

                            function appendOptionIfNotExist(fragment, value) {
                                if (!fragment.querySelector(`option[value="${value}"]`)) {
                                    const option = document.createElement("option");
                                    option.value = value;
                                    option.textContent = value;
                                    fragment.appendChild(option);
                                }
                            }

                            employeeDetailsArray.forEach((row) => {
                                const data = row.reduce((acc, cell, cellIndex) => {
                                    const header = employeeHeaders[cellIndex];
                                    acc[header] = cell;
                                    return acc;
                                }, {});

                                const { GROUP_ID, EMPLOYEE_NO, FULL_NAME, EMPLOYEE_INFO, SIM_CARD_ID, MOBILE_NO } = data;

                                const employeeInfoParsed = typeof EMPLOYEE_INFO === 'string' ? JSON.parse(EMPLOYEE_INFO) : EMPLOYEE_INFO || {};

                                const { COMPANY_NAME, DEPARTMENT, SECTION, POSITION, BRANCH, SITE, ACCOUNTING_CODE, EMPLOYMENT_TYPE } = employeeInfoParsed;

                                if (!mappedEmployeeDetails.groups) {
                                    mappedEmployeeDetails.groups = {};
                                }

                                if (!mappedEmployeeDetails.groups[GROUP_ID]) {
                                    mappedEmployeeDetails.groups[GROUP_ID] = {
                                        employeeNo: EMPLOYEE_NO,
                                        fullName: FULL_NAME,
                                        companyName: COMPANY_NAME,
                                        department: DEPARTMENT,
                                        section: SECTION,
                                        position: POSITION,
                                        branch: BRANCH,
                                        site: SITE,
                                        employmentType: EMPLOYMENT_TYPE,
                                        accountingCode: ACCOUNTING_CODE,
                                        sims: []
                                    };
                                }

                                if (SIM_CARD_ID && MOBILE_NO) {
                                    mappedEmployeeDetails.groups[GROUP_ID].sims.push({ [SIM_CARD_ID]: MOBILE_NO });
                                }

                                appendOptionIfNotExist(groupIdFragment, GROUP_ID);

                                if (!mappedEmployeeDetails.employee) {
                                    mappedEmployeeDetails.employee = {};
                                }

                                if (!mappedEmployeeDetails.employee[EMPLOYEE_NO]) {
                                    mappedEmployeeDetails.employee[EMPLOYEE_NO] = {
                                        groupId: GROUP_ID,
                                        fullName: FULL_NAME,
                                        companyName: COMPANY_NAME,
                                        department: DEPARTMENT,
                                        section: SECTION,
                                        position: POSITION,
                                        branch: BRANCH,
                                        site: SITE,
                                        employmentType: EMPLOYMENT_TYPE,
                                        accountingCode: ACCOUNTING_CODE,
                                        sims: []
                                    };
                                }

                                if (SIM_CARD_ID && MOBILE_NO) {
                                    mappedEmployeeDetails.employee[EMPLOYEE_NO].sims.push({ [SIM_CARD_ID]: MOBILE_NO });
                                }

                                appendOptionIfNotExist(employeeNoFragment, EMPLOYEE_NO);

                                if (!mappedEmployeeDetails.fullname) {
                                    mappedEmployeeDetails.fullname = {};
                                }

                                if (!mappedEmployeeDetails.fullname[FULL_NAME]) {
                                    mappedEmployeeDetails.fullname[FULL_NAME] = {
                                        groupId: GROUP_ID,
                                        employeeNo: EMPLOYEE_NO,
                                        companyName: COMPANY_NAME,
                                        department: DEPARTMENT,
                                        section: SECTION,
                                        position: POSITION,
                                        branch: BRANCH,
                                        site: SITE,
                                        employmentType: EMPLOYMENT_TYPE,
                                        accountingCode: ACCOUNTING_CODE,
                                        sims: []
                                    };
                                }
                                if (SIM_CARD_ID && MOBILE_NO) {
                                    mappedEmployeeDetails.fullname[FULL_NAME].sims.push({ [SIM_CARD_ID]: MOBILE_NO });
                                }
                                appendOptionIfNotExist(fullNameFragment, FULL_NAME);
                            });

                            groupIdDatalist.appendChild(groupIdFragment);
                            employeeNoDatalist.appendChild(employeeNoFragment);
                            fullNameDatalist.appendChild(fullNameFragment);

                            mobileDetailsArray.forEach((row) => {
                                const data = row.reduce((acc, cell, cellIndex) => {
                                    const header = mobileHeaders[cellIndex];
                                    acc[header] = cell;
                                    return acc;
                                }, {});

                                const {
                                    MOBILE_ID,
                                    STATUS,
                                    RR_NO,
                                    RR_DATE,
                                    DATE_CONFIGURED_BY_IT,
                                    IMEI,
                                    BRAND,
                                    MODEL,
                                    COLOR,
                                    RAM_ROM,
                                    CAMERA,
                                } = data;

                                mappedMobileDetails[MOBILE_ID] = {
                                    imei: IMEI,
                                    color: COLOR,
                                    brand: BRAND,
                                    model: MODEL,
                                    ramRom: RAM_ROM,
                                    camera: CAMERA,
                                };

                                appendOptionIfNotExist(mobileDeviceIdFragment, MOBILE_ID);

                            });

                            mobileList.appendChild(mobileDeviceIdFragment);

                            groupIdElement.addEventListener("change", function () {
                                const groupId = this.value;

                                const details = mappedEmployeeDetails.groups[groupId] || {};

                                fullNameElement.value = details.fullName || "";
                                employeeNoElement.value = details.employeeNo || "";
                                companyNameElement.value = details.companyName || "";
                                departmentElement.value = details.department || "";
                                sectionElement.value = details.section || "";
                                positionElement.value = details.position || "";
                                branchElement.value = details.branch || "";
                                siteElement.value = details.site || "";
                                employmentTypeElement.value = details.employmentType || "";
                                accountingCodeElement.value = details.accountingCode || "";
                                const simsList = details.sims || "";

                                const tableSimBody = document.getElementById('tableSimBody');
                                tableSimBody.innerHTML = '';

                                const tableSimHeader = document.getElementById('tableSimHeader');
                                tableSimHeader.innerHTML = '';

                                const headerRow = document.createElement('tr');
                                const firstHeaderCell = document.createElement('td');

                                firstHeaderCell.textContent = 'SIM CARD ID';
                                firstHeaderCell.classList.add('border', 'font-bold');
                                headerRow.appendChild(firstHeaderCell);

                                const secondHeaderCell = document.createElement('td');

                                secondHeaderCell.textContent = 'MOBILE NO';
                                secondHeaderCell.classList.add('border', 'font-bold');
                                headerRow.appendChild(secondHeaderCell);

                                tableSimHeader.appendChild(headerRow);

                                if (simsList.length > 0) {
                                    simsList.forEach(simEntry => {
                                        const simRow = document.createElement('tr');
                                        const [simCardId, mobileNo] = Object.entries(simEntry)[0];

                                        const simIdCell = document.createElement('td');
                                        simIdCell.textContent = simCardId;
                                        simIdCell.classList.add('border');
                                        simRow.appendChild(simIdCell);

                                        const mobileNoCell = document.createElement('td');
                                        mobileNoCell.textContent = mobileNo;
                                        mobileNoCell.classList.add('border');
                                        simRow.appendChild(mobileNoCell);

                                        tableSimBody.appendChild(simRow);
                                    });
                                } else {
                                    tableSimBody.innerHTML = '<tr><td colspan="2">No Issued Sim Details Available</td></tr>';
                                }

                            });

                            employeeNoElement.addEventListener("change", function () {
                                const employeeNo = this.value;

                                const details = mappedEmployeeDetails.employee[employeeNo] || {};

                                groupIdElement.value = details.groupId || "";
                                fullNameElement.value = details.fullName || "";
                                companyNameElement.value = details.companyName || "";
                                departmentElement.value = details.department || "";
                                sectionElement.value = details.section || "";
                                positionElement.value = details.position || "";
                                branchElement.value = details.branch || "";
                                siteElement.value = details.site || "";
                                employmentTypeElement.value = details.employmentType || "";
                                accountingCodeElement.value = details.accountingCode || "";

                                const simsList = details.sims || "";

                                const tableSimBody = document.getElementById('tableSimBody');
                                tableSimBody.innerHTML = '';

                                const tableSimHeader = document.getElementById('tableSimHeader');
                                tableSimHeader.innerHTML = '';

                                const headerRow = document.createElement('tr');
                                const firstHeaderCell = document.createElement('td');

                                firstHeaderCell.textContent = 'SIM CARD ID';
                                firstHeaderCell.classList.add('border', 'font-bold');
                                headerRow.appendChild(firstHeaderCell);

                                const secondHeaderCell = document.createElement('td');

                                secondHeaderCell.textContent = 'MOBILE NO';
                                secondHeaderCell.classList.add('border', 'font-bold');
                                headerRow.appendChild(secondHeaderCell);

                                tableSimHeader.appendChild(headerRow);

                                if (simsList.length > 0) {
                                    simsList.forEach(simEntry => {
                                        const simRow = document.createElement('tr');
                                        const [simCardId, mobileNo] = Object.entries(simEntry)[0];

                                        const simIdCell = document.createElement('td');
                                        simIdCell.textContent = simCardId;
                                        simIdCell.classList.add('border');
                                        simRow.appendChild(simIdCell);

                                        const mobileNoCell = document.createElement('td');
                                        mobileNoCell.textContent = mobileNo;
                                        mobileNoCell.classList.add('border');
                                        simRow.appendChild(mobileNoCell);

                                        tableSimBody.appendChild(simRow);
                                    });
                                } else {
                                    tableSimBody.innerHTML = '<tr><td colspan="2">No Issued Sim Details Available</td></tr>';
                                }
                            });

                            fullNameElement.addEventListener("change", function () {
                                const fullName = this.value;

                                const details = mappedEmployeeDetails.fullname[fullName] || {};

                                groupIdElement.value = details.groupId || "";
                                employeeNoElement.value = details.employeeNo || "";
                                companyNameElement.value = details.companyName || "";
                                departmentElement.value = details.department || "";
                                sectionElement.value = details.section || "";
                                positionElement.value = details.position || "";
                                branchElement.value = details.branch || "";
                                siteElement.value = details.site || "";
                                employmentTypeElement.value = details.employmentType || "";
                                accountingCodeElement.value = details.accountingCode || "";

                                const simsList = details.sims || "";

                                const tableSimBody = document.getElementById('tableSimBody');
                                tableSimBody.innerHTML = '';

                                const tableSimHeader = document.getElementById('tableSimHeader');
                                tableSimHeader.innerHTML = '';

                                const headerRow = document.createElement('tr');
                                const firstHeaderCell = document.createElement('td');

                                firstHeaderCell.textContent = 'SIM CARD ID';
                                firstHeaderCell.classList.add('border', 'font-bold');
                                headerRow.appendChild(firstHeaderCell);

                                const secondHeaderCell = document.createElement('td');

                                secondHeaderCell.textContent = 'MOBILE NO';
                                secondHeaderCell.classList.add('border', 'font-bold');
                                headerRow.appendChild(secondHeaderCell);

                                tableSimHeader.appendChild(headerRow);

                                if (simsList.length > 0) {
                                    simsList.forEach(simEntry => {
                                        const simRow = document.createElement('tr');
                                        const [simCardId, mobileNo] = Object.entries(simEntry)[0];

                                        const simIdCell = document.createElement('td');
                                        simIdCell.textContent = simCardId;
                                        simIdCell.classList.add('border');
                                        simRow.appendChild(simIdCell);

                                        const mobileNoCell = document.createElement('td');
                                        mobileNoCell.textContent = mobileNo;
                                        mobileNoCell.classList.add('border');
                                        simRow.appendChild(mobileNoCell);

                                        tableSimBody.appendChild(simRow);
                                    });
                                } else {
                                    tableSimBody.innerHTML = '<tr><td colspan="2">No Issued Sim Details Available</td></tr>';
                                }
                            });

                            mobileDeviceIdElement.addEventListener("change", function () {
                                const mobileDeviceId = this.value;
                                const details = mappedMobileDetails[mobileDeviceId] || {};

                                imeiElement.value = details.imei || "";
                                colorElement.value = details.color || "";
                                brandElement.value = details.brand || "";
                                modelElement.value = details.model || "";
                                ramRomElement.value =
                                    details.ramRom || "";
                                cameraElement.value =
                                    details.camera || "";
                            });

                            let isSubmitted = false;
                            addMobileRequestFormId.addEventListener(
                                "submit",
                                async function (event) {
                                    event.preventDefault();

                                    const submitButtonId = document.getElementById("submitButtonId");

                                    submitButtonId.innerHTML = 'Submitting <span class="AnimatedEllipsis"></span>';

                                    submitButtonId.disabled = true;
                                    submitButtonId.classList.add('cursor-not-allowed', 'opacity-50');

                                    const swalCloseButton = Swal.getCloseButton();
                                    if (swalCloseButton) {
                                        swalCloseButton.disabled = true;
                                    }



                                    if (isSubmitted) {
                                        return;
                                    }

                                    isSubmitted = true;
                                    try {
                                        const formData = new FormData(this);
                                        const formObject = Object.fromEntries(formData);

                                        const employeeInfo = {
                                            EMPLOYEE_NO: formObject.EMPLOYEE_NO,
                                            FULL_NAME: formObject.FULL_NAME,
                                            COMPANY_NAME: formObject.COMPANY_NAME,
                                            DEPARTMENT: formObject.DEPARTMENT,
                                            SECTION: formObject.SECTION,
                                            POSITION: formObject.POSITION,
                                            BRANCH: formObject.BRANCH,
                                            SITE: formObject.SITE,
                                            EMPLOYMENT_TYPE: formObject.EMPLOYMENT_TYPE,
                                            ACCOUNTING_CODE: formObject.ACCOUNTING_CODE,
                                        };

                                        formObject.EMPLOYEE_INFO = JSON.stringify(employeeInfo);

                                        const mobileInfo = {
                                            IMEI: formObject.IMEI,
                                            BRAND: formObject.BRAND,
                                            MODEL: formObject.MODEL,
                                            COLOR: formObject.COLOR,
                                        };

                                        formObject.MOBILE_INFO = JSON.stringify(mobileInfo);

                                        formObject.REQUEST_STATUS = formObject.PURCHASING_RS_NO ? "Received PR" : "Received RS";


                                        const isInserted = await $.insertDataToMobileRequest(
                                            formObject
                                        );

                                        if (isInserted) {
                                            await initializeTable();
                                            Swal.close();
                                            toast.success({
                                                title: "Record Insertion Success",
                                                description: "The record has been inserted succesfully",
                                                timeout: 4000,
                                                closeButton: false,
                                            })
                                        } else {
                                            toast.error({
                                                title: "Record Insertion Failed",
                                                description: "The record could not be inserted. Please try again.",
                                                timeout: 4000,
                                                closeButton: false,
                                            })
                                        }
                                    } catch (error) {
                                        console.error(error);
                                    } finally {
                                        isSubmitted = false; // Reset the submission lock
                                    }
                                }
                            );
                        },
                    });
                });
            initializeTable();
        });

        function clsx(classes) {
            return classes.split("");
        }


        // SAVE STATE
    </script>
</body>

</html>