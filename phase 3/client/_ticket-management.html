<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <link href="https://rawcdn.githack.com/shinxzxzxz/TableJS/c8218ba13b4d74c34af06f9f25d5063b6a99956f/tablejs.css"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer type="module"
        src="https://rawcdn.githack.com/shinxzxzxz/TableJS/55597d91c8f5165cdfaaf90798bc2e0e886a42e8/tablejs.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            darkMode: ['[data-mode="dark"]']
        }
    </script>
    <?!= include("CSS"); ?>
</head>

<body>
    <nav class="fixed top-0 z-[39] w-full bg-white border-b border-gray-200">
        <div class="px-3 py-3 lg:px-5 lg:pl-3 h-14">
            <div class="flex items-center justify-between">
                <div class="flex items-center justify-start rtl:justify-end">
                    <button data-drawer-target="logo-sidebar" data-drawer-toggle="logo-sidebar"
                        aria-controls="logo-sidebar" type="button"
                        class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200">
                        <span class="sr-only">Open sidebar</span>
                        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z">
                            </path>
                        </svg>
                    </button>
                    <!-- <a href="https://flowbite.com" class="flex ms-5 md:me-24"> -->
                    <span class="pl-6 self-center text-xl font-semibold sm:text-2xl whitespace-nowrap">
                        SPPM
                    </span>
                    <!-- </a> -->
                </div>
            </div>
        </div>
    </nav>

    <!-- sidebar -->
    {{SIDEBAR}}

    <!-- Add Form Modal -->
    <div id="add-modal" tabindex="-1" aria-hidden="true" data-modal-backdrop="static"
        class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-4xl max-h-full">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow">
                <!-- Modal header -->
                <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t">
                    <h3 class="text-lg font-semibold text-gray-900">
                        Add Ticket
                    </h3>
                    <button type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
                        data-modal-hide="add-modal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <form id="addModalForm" class="form-to-submit" data-action="addTicketRecord" data-modal-id="add-modal">
                    <div class="p-4 md:p-5 max-h-[70vh] overflow-y-auto">
                        <div class="mb-4 grid grid-cols-2 gap-4">
                            <!-- Left side -->
                            <div class="col-span-2 grid grid-cols-2 gap-4">
                                <!-- Date Received -->
                                <div class="col-span-1">
                                    <label for="dateReceivedId" class="mb-2 block text-sm font-medium text-gray-900">
                                        Date
                                        Received </label>
                                    <div class="relative">
                                        <div
                                            class="pointer-events-none absolute inset-y-0 start-0 flex items-center ps-3">
                                            <svg class="h-4 w-4 text-gray-500" aria-hidden="true"
                                                xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                                viewBox="0 0 20 20">
                                                <path
                                                    d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
                                            </svg>
                                        </div>
                                        <input datepicker datepicker-buttons datepicker-autohide
                                            datepicker-format="mm/dd/yyyy" datepicker-autoselect-today type="text"
                                            name="dateReceived" autocomplete="off" id="dateReceivedId"
                                            class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 ps-10 text-sm text-gray-900 focus:border-gray-700 focus:ring-gray-700"
                                            placeholder="Select date" required />
                                    </div>
                                </div>
                                <!-- Device Type -->
                                <div class="col-span-1">
                                    <label for="deviceTypeId"
                                        class="mb-2 block text-sm font-medium text-gray-900">Device
                                        Type</label>
                                    <select id="deviceTypeId" name="deviceType" required
                                        class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-gray-700 focus:ring-gray-700">
                                        <option value="" disabled selected>Select Device Type</option>
                                        <option value="SIM">SIM</option>
                                        <option value="PHONE">Phone</option>
                                        <!-- <option value="3">3 (BDC - Globe)</option> -->
                                    </select>
                                </div>
                                <!-- Search By -->
                                <div class="col-span-2">
                                    <label for="searchById" class="mb-2 block text-sm font-medium text-gray-900">
                                        Search By
                                    </label>
                                    <select id="searchById" name="searchBy"
                                        class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-gray-700 focus:ring-gray-700"
                                        required>
                                        <option value="" disabled selected>Select</option>
                                    </select>
                                </div>

                                <!-- List of employee name -->
                                <div class="hidden col-span-2">
                                    <label for="employeeName"
                                        class="mb-2 block text-sm font-medium text-gray-900">Employee Name</label>
                                    <input type="text" id="employeeName"
                                        class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-gray-700 focus:ring-gray-700"
                                        placeholder="Search..." autocomplete="off" />
                                    <div id="employeeDropdownList"
                                        class="absolute z-10 mt-1 w-[815px] text-sm bg-white border border-gray-300 rounded-lg shadow-lg max-h-40 overflow-y-auto hidden">
                                    </div>
                                    <div id="errorMessage" class="error" style="display: none;">Please select a valid
                                        option from the list.</div>
                                </div>

                                <!-- Device Identifier -->
                                <div class="col-span-2">
                                    <label for="deviceIdentifier"
                                        class="mb-2 block text-sm font-medium text-gray-900">Device Identifier </label>
                                    <input type="text" id="deviceIdentifier"
                                        class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-gray-700 focus:ring-gray-700"
                                        placeholder="Search..." autocomplete="off" required />
                                    <div id="dropdownList"
                                        class="absolute z-10 mt-1 w-[815px] text-sm bg-white border border-gray-300 rounded-lg shadow-lg max-h-40 overflow-y-auto hidden">
                                    </div>
                                    <div id="errorMessage" class="error" style="display: none;">Please select a valid
                                        option
                                        from the list.</div>
                                </div>
                            </div>

                            <!-- Right -->
                            <div class="col-span-2">
                                <label for="deviceInfoList" class="mb-2 block text-sm font-medium text-gray-900">Device
                                    Information</label>
                                <div id="deviceInfo"
                                    class="col-span-1 p-4 bg-neutral-100 h-[190px] overflow-y-auto rounded-lg">
                                    <div id="deviceInfoList" class="grid grid-cols-6 gap-y-1.5 text-sm">
                                    </div>

                                </div>
                            </div>
                            <!-- <div id="deviceInfo" class="col-span-1 p-4 bg-neutral-100 h-[240px] overflow-y-auto rounded-lg">
                              <div id="deviceInfoList" class="grid grid-cols-12 gap-y-1.5">
                                  <h1>Device Information</h1> -->
                            <!-- <div
                                      class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                                      Current User
                                  </div>
                                  <div id="viewBillId" class="col-span-2 text-left text-sm text-neutral-700">Jacob
                                      Manansala
                                  </div>
                                  <div
                                      class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                                      Current User
                                  </div>
                                  <div id="viewBillId" class="col-span-2 text-left text-sm text-neutral-700">Jacob
                                      Manansala
                                  </div>
                                  <div
                                      class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                                      Current User
                                  </div>
                                  <div id="viewBillId" class="col-span-2 text-left text-sm text-neutral-700">Jacob
                                      Manansala
                                  </div> -->
                            <!-- </div>

                          </div> -->

                            <!-- Ticket Description -->
                            <div class="col-span-2">
                                <label for="ticketDescriptionId" class="mb-2 block text-sm font-medium text-gray-900">
                                    Ticket Description </label>
                                <textarea rows="1" name="ticketDescriptionId" id="ticketDescription" required
                                    class="focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 min-h-[45px] resize-y"
                                    placeholder="Write the description..."></textarea>
                            </div>
                            <!-- Priority -->
                            <div class="col-span-2">
                                <label for="priorityId"
                                    class="mb-2 block text-sm font-medium text-gray-900">Priority</label>
                                <select id="priorityId" name="priority" required
                                    class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-gray-700 focus:ring-gray-700">
                                    <option value="" disabled selected>Select</option>
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                            <!-- Assigned Person In-charge -->
                            <div class="col-span-2">
                                <label for="assignedPicId" class="mb-2 block text-sm font-medium text-gray-900">
                                    Assigned
                                    Person In-charge </label>
                                <input type="text" name="assignedPic" id="assignedPicId" required
                                    class="focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900"
                                    placeholder="Assigned Person In-charge" />
                            </div>
                            <!-- Plan of action -->
                            <div class="col-span-2">
                                <label for="planOfActionId" class="mb-2 block text-sm font-medium text-gray-900"> Plan
                                    of
                                    Action </label>
                                <textarea rows="1" name="planOfAction" id="planOfActionId" required
                                    class="focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 min-h-[45px]"
                                    placeholder="Write the plan of action..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="sticky flex justify-end p-4">
                        <button type="submit"
                            class="to-disable inline-flex items-center rounded-lg bg-gray-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-300">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Form Modal -->
    <div id="edit-modal" tabindex="-1" aria-hidden="true" data-modal-backdrop="static"
        class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-4xl max-h-full">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow">
                <!-- Modal header -->
                <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t">
                    <h3 class="text-lg font-semibold text-gray-900">
                        Edit Ticket Information
                    </h3>
                    <button type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
                        data-modal-toggle="edit-modal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <form id="editModalForm" class="form-to-submit" data-action="editTicketRecord"
                    data-modal-id="edit-modal">
                    <div class="p-4 md:p-5 overflow-y-auto max-h-[70vh]">
                        <!-- SIM Plan Information -->
                        <h3 class="text-md font-semibold text-gray-700">Ticket Details</h3>
                        <!-- Readonly fields -->
                        <div class="mb-4 grid grid-cols-6 gap-x-1 gap-y-1.5 ps-4">
                            <div class="col-span-1 flex items-center">
                                <label for="" class="block w-full text-left text-sm font-medium text-gray-900">Ticket
                                    ID</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editTicketId" id="editTicketId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>
                            <div class="col-span-1 flex items-center">
                                <label for="" class="block w-full text-left text-sm font-medium text-gray-900">Ticket
                                    No</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editTicketNo" id="editTicketNoId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>

                            <div class="col-span-1 flex items-center">
                                <label for="" class="block w-full text-left text-sm font-medium text-gray-900">Date
                                    Received</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editDateReceived" id="editDateReceivedId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>
                            <div class="col-span-1 flex items-center">
                                <label for="" class="block w-full text-left text-sm font-medium text-gray-900">Date
                                    Created</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editCreatedAt" id="editCreatedAtId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>

                            <div class="col-span-1 flex items-center">
                                <label for=""
                                    class="block w-full text-left text-sm font-medium text-gray-900">Priority</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editPriority" id="editPriorityId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>

                            <div class="col-span-1 flex items-center">
                                <label for="" class="block w-full text-left text-sm font-medium text-gray-900">Assigned
                                    To</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editAssignedPic" id="editAssignedPicId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>

                            <div class="col-span-1 flex items-center">
                                <label for=""
                                    class="block w-full text-left text-sm font-medium text-gray-900">Description</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editTicketDescription" id="editTicketDescriptionId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>

                            <div class="col-span-1 flex items-center">
                                <label for="" class="block w-full text-left text-sm font-medium text-gray-900">Plan of
                                    Action</label>
                            </div>
                            <div class="col-span-5 flex items-center">
                                <input type="text" name="editPlanOfAction" id="editPlanOfActionId"
                                    class="pointer-events-none w-full border-none bg-transparent p-0 text-left text-sm text-gray-900"
                                    placeholder="" required="" readonly tabindex="-1" />
                            </div>

                        </div>

                        <div class="mb-4 grid grid-cols-2 gap-4">
                            <!-- Right -->
                            <div class="col-span-2">
                                <label for="editDeviceInfoList" class="block text-md font-semibold text-gray-700">Device
                                    Information</label>
                                <div id="editDeviceInfo"
                                    class="col-span-1 p-4 ps-4 bg-neutral-100 h-[190px] overflow-y-auto rounded-lg">
                                    <div id="editDeviceInfoList" class="grid grid-cols-6 gap-x-3 gap-y-1.5 text-sm">
                                    </div>

                                </div>
                            </div>

                            <!-- Date Resolved -->
                            <div class="col-span-2">
                                <label for="dateResolvedId" class="mb-2 block text-sm font-medium text-gray-900">Date
                                    Resolved</label>
                                <div class="relative">
                                    <div class="pointer-events-none absolute inset-y-0 start-0 flex items-center ps-3">
                                        <svg class="h-4 w-4 text-gray-500" aria-hidden="true"
                                            xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                            <path
                                                d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
                                        </svg>
                                    </div>
                                    <input datepicker datepicker-buttons datepicker-autohide
                                        datepicker-format="mm/dd/yyyy" datepicker-autoselect-today type="text"
                                        name="dateResolved" autocomplete="off" id="dateResolvedId"
                                        class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 ps-10 text-sm text-gray-900 focus:border-gray-700 focus:ring-gray-700"
                                        placeholder="Select date" required />
                                </div>
                            </div>

                            <!-- Resolution Details -->
                            <div class="col-span-2">
                                <label for="resolutionDetailsId"
                                    class="mb-2 block text-sm font-medium text-gray-900">Resolution Details<span
                                        class="pl-1 text-red-500">*</span></label>
                                <textarea rows="1" name="resolutionDetails" id="resolutionDetailsId"
                                    class="focus:ring-gray-700 focus:border-gray-700 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 min-h-[45px]"
                                    required placeholder="Write the resolution details..."></textarea>
                            </div>
                        </div>
                    </div>
                    <!-- Submit Button -->
                    <div class="sticky flex justify-end p-4">
                        <button type="submit"
                            class="to-disable text-white inline-flex items-center bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Modal -->
    <div id="view-modal" tabindex="-1" aria-hidden="true" data-modal-backdrop="static"
        class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-4xl max-h-full ">
            <!-- Modal content -->
            <div class="relative bg-white rounded-lg shadow max-h-[100vh]">
                <!-- Modal header -->
                <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t">
                    <h3 class="text-lg font-semibold text-gray-900">
                        View Billing Information
                    </h3>
                    <button type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
                        data-modal-hide="view-modal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <div id="viewModal" class="p-4 md:p-5 overflow-y-auto max-h-[80vh]">
                    <div class="grid gap-y-1.5 grid-cols-3">
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            BILL ID
                        </div>
                        <div id="viewBillId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            ISSUANCE NO
                        </div>
                        <div id="viewIssuanceNoId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            EMPLOYEE GROUP ID
                        </div>
                        <div id="viewEmpGroupId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            EMPLOYEE NAME
                        </div>
                        <div id="viewEmployeeNameId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            RFP GROUP NAME
                        </div>
                        <div id="viewRfpGroupNameId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            SIM CARD ID
                        </div>
                        <div id="viewSimCardId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            MOBILE NO
                        </div>
                        <div id="viewMobileNoId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            ACCOUNT NO
                        </div>
                        <div id="viewAccountNoId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            RFP NO
                        </div>
                        <div id="viewRfpNoId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            BILL PERIOD
                        </div>
                        <div id="viewBillPeriodFromToId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <!-- <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            BILL PERIOD TO
                        </div>
                        <div id="viewBillPeriodToId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div> -->
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            MONTHLY RECURRING FEE
                        </div>
                        <div id="viewMrfId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            PREVIOUS BILL AMOUNT
                        </div>
                        <div id="viewPreviousBillAmountId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            PREVIOUS BILL PAYMENT
                        </div>
                        <div id="viewPreviousBillPaymentId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            EXCESS CHARGES
                        </div>
                        <div id="viewExcessChargesId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            OTHER CHARGES
                        </div>
                        <div id="viewOtherChargesId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            ADJ AMOUNT
                        </div>
                        <div id="viewAdjAmountId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            RFP AMOUNT
                        </div>
                        <div id="viewRfpAmountId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            AMOUNT DUE
                        </div>
                        <div id="viewAmountDueId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                        <div class="col-span-1 text-left font-semibold text-sm mb-1 flex space-x-2 justify-between">
                            CURRENT CHARGE AMOUNT
                        </div>
                        <div id="viewCurrentChargeAmountId" class="col-span-2 text-left text-sm text-neutral-700">
                        </div>
                    </div>
                    <div class="flex justify-end pt-2">
                        <button type="button" data-modal-hide="view-modal"
                            class="text-white inline-flex items-center bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" tabindex="-1"
        class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-md max-h-full">
            <div class="relative bg-white rounded-lg shadow">
                <button type="button"
                    class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
                    data-modal-hide="delete-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
                <div class="p-4 md:p-5 text-center">
                    <svg class="mx-auto mb-4 text-gray-400 w-12 h-12" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                    <h3 class="mb-5 text-lg font-normal text-gray-500">Are you sure you
                        want to delete this record?</h3>
                    <button type="button" id="deleteConfirmButtonId"
                        class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center">
                        Yes, I'm sure
                    </button>
                    <button data-modal-hide="delete-modal" type="button" id="cancel-delete"
                        class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100">
                        No, cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div id="toast-container" class="fixed z-50 bottom-5 left-5 space-y-4"></div>

    <div class="mt-14 sm:ml-64 hidden">

        <!-- <input type="text" id="pagination-search" /> -->
        <!-- <select name="" id="pagination-limit"></select> -->
        <!-- <button id="pagination-next">Next</button> -->
        <!-- <button id="pagination-previous">Previous</button> -->
        <!-- <button id="export-csv" class="hidden">Export CSV</button> -->
        <!-- <div id="table-colvis"></div> -->

    </div>

    <div class="fixed top-14 right-0 w-vw-64 h-vh-14">
        <!-- Table Header Controller -->
        <div class="w-full h-14 flex justify-between items-center border-b border-neutral-200">
            <div class="flex space-x-2">
                <!-- search -->
                <label for="searchInput" class="sr-only">Search</label>
                <div class="relative w-full">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg aria-hidden="true" class="w-5 h-5 text-gray-500" viewbox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="pagination-search"
                        class="block w-full p-2 pl-10 text-sm text-gray-900 border border-gray-300 rounded bg-gray-50 focus:ring-black focus:border-black"
                        placeholder="Search" required="">
                </div>
                <!-- colvis -->
                <div class="relative w-40">
                    <button data-dropdown-toggle="table-colvis"
                        class="relative block w-40 p-1.5 border bg-neutral-50 border-neutral-300 text-neutral-900 sm:text-sm rounded focus:ring-neutral-600 focus:border-neutral-600">
                        <div
                            class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none text-neutral-500">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                            </svg>
                        </div>
                        Columns
                    </button>
                    <div data-popover id="table-colvis"
                        class="text-left z-50 hidden bg-white divide-y divide-neutral-100 rounded-lg shadow w-44 max-h-vh-36 overflow-x-auto">
                        <ul class="py-2 text-sm text-neutral-700"></ul>
                    </div>
                </div>
            </div>
            <div>
                <!-- add button -->
                <!-- Add Form Modal toggle -->
                <div
                    class="flex flex-col items-stretch justify-end flex-shrink-0 w-full space-y-2 md:w-auto md:flex-row md:space-y-0 md:items-center md:space-x-3">
                    <button data-modal-target="add-modal" data-modal-toggle="add-modal" type="button"
                        id="add-modal-toggle"
                        class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-blue-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 disable-on-load">
                        <!-- <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewbox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                        </svg> -->
                        Add Ticket
                    </button>
                    <button type="button" id="export-csv"
                        class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 disable-on-load">
                        Export CSV
                    </button>
                    <div class="flex items-center w-full space-x-3 md:w-auto">
                    </div>
                </div>
            </div>
        </div>
        <!-- Main Content -->
        <div class="h-vh-40 overflow-y-auto overflow-x-auto">
            <!-- Spinner -->
            <div class="flex items-center justify-center h-vh-40" id="spinner">
                <div role="status" class="flex items-center space-x-2">
                    <svg aria-hidden="true" class="w-8 h-8 mr-2 text-gray-200 animate-spin fill-gray-600"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="none">
                        <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path
                            d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z" />
                    </svg>
                    <!-- <span class="sr-only">Loading...</span> -->
                </div>
            </div>
            <!-- Table Container -->
            <div id="tableContainer" class="table-container hidden">
                <table id="tablejs" class="w-full text-sm text-left rtl:text-right text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">
                                TICKET NO
                            </th>
                            <th scope="col" class="px-6 py-3">
                                STATUS
                            </th>
                            <th scope="col" class="px-6 py-3">
                                DATE RECEIVED
                            </th>
                            <th scope="col" class="px-6 py-3">
                                GROUP ID
                            </th>
                            <th scope="col" class="px-6 py-3">
                                ISSUED TO
                            </th>
                            <th scope="col" class="px-6 py-3">
                                CATEGORY
                            </th>
                            <th scope="col" class="px-6 py-3">
                                TICKET DESCRIPTION
                            </th>
                            <th scope="col" class="px-6 py-3">
                                SIM CARD ID
                            </th>
                            <th scope="col" class="px-6 py-3">
                                MOBILE NO
                            </th>
                            <th scope="col" class="px-6 py-3">
                                ASSIGNED PIC
                            </th>
                            <th scope="col" class="px-6 py-3">
                                DATE RESOLVED
                            </th>
                            <th scope="col" class="px-6 py-3">
                                RESOLUTION DETAILS
                            </th>
                            <th scope="col" class="px-6 py-3">
                                ACTIONS
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">No data</td>
                            <td scope="col" class="px-6 py-3">Actions</td>
                        </tr>

                    </tbody>
                </table>
            </div>
        </div>

        <!-- Table Footer -->
        <div class="flex items-center justify-between border-t border-neutral-200 px-4 h-12">
            <!-- <div class="info flex items-center space-x-2">
                <div class="font-bold text-xl me-8 w-24">
                    TOTAL
                </div>
                <div class="font-medium text-xl me-2" id="reports-total">
                    0.00
                </div>
            </div> -->
            <div class="text-sm">
                <span class="text-sm" id="pagination-records">Shows 1 of 1 of 1 entries</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="text-sm">
                    Rows per page
                </div>
                <div class="text-sm">
                    <select id="pagination-limit"
                        class="block w-full items-center justify-center px-2 h-8 text-xs font-medium text-neutral-500 bg-white border rounded-lg hover:bg-neutral-100 hover:text-neutral-700  border-neutral-300 focus-within:ring-0 focus:ring-neutral-500 focus:outline-none focus:border-neutral-500">
                        <option value="*" selected>All</option>
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                    </select>
                </div>
                <span class="text-sm" id="pagination-label">Page 1 of 10</span>
                <button id="pagination-previous"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-sm font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700"
                    name="previous">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                    </svg>
                </button>
                <button id="pagination-next"
                    class="aspect-square flex items-center justify-center px-2 h-8 text-sm font-medium text-neutral-500 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-100 hover:text-neutral-700 "
                    name="next">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <?!= include('JavaScript'); ?>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {

            const ids = generateIds(document.querySelectorAll('[id]'));

            const spinner = document.getElementById('spinner');
            const tableContainer = document.getElementById('tableContainer');

            const onClickEvents = {
                viewData: function (data) {
                    console.warn(data);
                    console.warn(Object.keys(data));
                    loadViewFields(data);
                    showModal('view');
                },
                editData: function (data) {
                    loadEditFields(data);
                    // calculateCurrentChargeAmount();
                    showModal('edit');
                },
                deleteData: function (data) {
                    Swal.fire({
                        title: "Are you sure you want to delete this record?",
                        showCancelButton: true,
                        icon: 'info',
                        confirmButtonText: `Yes, delete Ticket ID ${data.TICKET_ID}`,
                        cancelButtonText: "No, cancel",
                        customClass: {
                            title: 'mb-5 text-lg font-normal text-gray-500',
                            cancelButton: 'cursor-pointer text-white bg-gray-600 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center',
                            confirmButton: 'cursor-pointer text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center',

                        }
                    }).then((result) => {
                        /* Read more about isConfirmed, isDenied below */
                        if (result.isConfirmed) {
                            // Swal.fire("Deleted!", "", "success");
                            handleDelete(data.TICKET_ID);
                        } else if (result.isDenied) {
                            // Swal.fire("Changes are not saved", "", "info");
                        }
                    });
                }
            }

            // Disables all buttons while the table content is loading
            // document.querySelectorAll('button').forEach(button => {
            //     button.classList.add('cursor-not-allowed');
            //     button.disabled = true;
            // });

            // Targeting a specific class instead of all the buttons
            document.querySelectorAll('.disable-on-load').forEach(button => {
                button.classList.add('cursor-not-allowed');
                button.disabled = true;
            });

            // const totalElement = document.querySelector('div#reports-total');
            const recordElement = document.querySelector('span#pagination-records');
            const pagingElement = document.querySelector('span#pagination-label');

            const output = {
                pagination: ({
                    current_page,
                    total_page,
                    start_item,
                    end_item,
                    total_rows,
                }) => {
                    if (recordElement)
                        recordElement.innerHTML = `Shows ${start_item} to ${end_item} of ${total_rows} entries`;
                    if (pagingElement)
                        pagingElement.innerHTML = `Page ${current_page} of ${total_page}`;
                },
            };

            // Table Headers
            const headers = [
                'TICKET_NO',
                'STATUS',
                'DATE_RECEIVED',
                'ASSIGNED_PIC',
                'DEVICE_TYPE',
                'GROUP_ID',
                'SIM_CARD_ID',
                'MOBILE_ID',
                'DESCRIPTION',
                'PLAN_OF_ACTION',
                'DATE_RESOLVED',
                'RESOLUTION_DETAILS',
            ];


            // Render Table function
            async function renderTable({ data, table }) {

                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');

                // Clear existing content
                thead.innerHTML = '';
                tbody.innerHTML = '';

                // Create Header
                const headerRow = document.createElement('tr');
                headers.forEach((header) => {
                    const th = document.createElement('th');
                    th.scope = 'col';
                    th.classList.add('px-6', 'py-3');
                    th.textContent = header.replace(/[_\s]{1,}/g, ' ');
                    headerRow.appendChild(th);
                });
                // Add Action Header
                const actionHeader = document.createElement('th');
                actionHeader.scope = 'col';
                actionHeader.classList.add('px-6', 'py-3', 'actions-column');
                actionHeader.textContent = 'Actions';
                headerRow.appendChild(actionHeader);
                thead.appendChild(headerRow);

                // Create Body
                data.forEach((row, index) => {

                    if (row.EMPLOYEE_INFO) {
                        const employeeInfoString = row.EMPLOYEE_INFO;
                        const hasEmployeeInfo = !!employeeInfoString;
                        const employeeInfo = hasEmployeeInfo ? JSON.parse(employeeInfoString) : '';

                        row.EMPLOYEE_NAME = employeeInfo.FULL_NAME;
                        row.GROUP_ID = employeeInfo.GROUP_ID;
                        row.EMPLOYEE_NO = employeeInfo.EMPLOYEE_NO;
                    }

                    if (row.SIM_INFO) {
                        const simInfoString = row.SIM_INFO;
                        const hasSimInfo = !!simInfoString;
                        const simInfo = hasSimInfo ? JSON.parse(simInfoString) : '';

                        row.MOBILE_NO = simInfo.MOBILE_NO;
                        row.ACCOUNT_NO = simInfo.ACCOUNT_NO;
                        row.NETWORK_PROVIDER = simInfo.NETWORK_PROVIDER;
                        row.PLAN_DETAILS = simInfo.PLAN_DETAILS;
                        // Must be added on SIM_INFO
                        row.RFP_GROUP_NAME = simInfo.RFP_GROUP_NAME;
                        row.CATEGORY = simInfo.CATEGORY;
                    }

                    // console.log("employeeInfo", row.EMPLOYEE_NAME);
                    // console.log("simInfo", simInfo);

                    const tr = document.createElement('tr');
                    tr.classList.add('bg-white', 'border-b');
                    if (tr.index === undefined || tr.index === null) {
                        tr.index = index;
                        tr.dataset.index = index;
                    }

                    // Add Action Buttons
                    const actionTd = document.createElement('td');
                    actionTd.classList.add('px-6', 'py-3');
                    const actionDiv = document.createElement('div');
                    actionDiv.classList.add('action-buttons', 'flex', 'space-x-2');

                    if (Object.entries(row).every(([key, value]) => value === "")) {
                        const NoData = "No data";
                        headers.forEach((header) => {
                            const td = document.createElement('td');
                            td.classList.add('px-6', 'py-3');
                            td.textContent = NoData;
                            tr.appendChild(td);
                        });
                        actionTd.textContent = "Actions";
                    } else {
                        headers.forEach((header) => {
                            const td = document.createElement('td');

                            let value = row[header];

                            td.classList.add('px-6', 'py-3');
                            switch (header) {
                                case 'MONTHLY_RECURRING_FEE':
                                case 'EXCESS_CHARGES':
                                case 'OTHER_CHARGES':
                                case 'PREVIOUS_BILL_AMOUNT':
                                case 'PREVIOUS_BILL_PAYMENT':
                                case 'CURRENT_CHARGE_AMOUNT':
                                case 'ADJ_AMOUNT':
                                case 'AMOUNT_DUE':
                                case 'RFP_AMOUNT':
                                case 'WITHHOLDING_TAX':
                                case 'AMOUNT_AFTER_TAX':
                                case 'CHARGE_TO_BDC':
                                    td.textContent = formatNumber(value);
                                    td.classList.add('text-right');
                                    break;
                                case 'DATE_RECEIVED':
                                case 'DATE_RESOLVED':
                                    td.textContent = DateTime(value, { format: "MM/DD/YYYY" });
                                    break;
                                default:
                                    td.textContent = value;
                                    break;
                            }

                            tr.appendChild(td);

                        });

                        const viewButton = generateActionButton(vectors.view, {
                            class: 'px-2 py-2 bg-teal-500 text-white rounded',
                            onClick: () => {
                                const skips = ["BILL_PERIOD_FROM", "BILL_PERIOD_TO"];
                                const object = Object.fromEntries(
                                    Object.entries(row).filter(([k, v]) => !skips.includes(k))
                                );
                                onClickEvents.viewData({
                                    ...object,
                                    BILL_PERIOD_FROM_TO: `${DateTime(row.BILL_PERIOD_FROM, { format: "MM/DD/YYYY" })} - ${DateTime(row.BILL_PERIOD_TO, { format: "MM/DD/YYYY" })}`,
                                    ISSUANCE_NO: row.ISSUANCE_NO,
                                    GROUP_ID: row.GROUP_ID,
                                    EMPLOYEE_NO: row.EMPLOYEE_NO,
                                    EMPLOYEE_NAME: row.EMPLOYEE_NAME,
                                })
                            }
                        }, row);
                        const editButton = generateActionButton(vectors.edit, {
                            class: 'px-2 py-2 bg-blue-500 text-white rounded',
                            onClick: () => onClickEvents.editData({
                                ...row,
                            })
                        }, row);
                        const deleteButton = generateActionButton(vectors.delete, {
                            class: 'px-2 py-2 bg-red-500 text-white rounded',
                            onClick: () => onClickEvents.deleteData({
                                ...row,
                                billId: row.BILL_ID,
                            })
                        }, row);
                        // actionDiv.appendChild(viewButton);
                        actionDiv.appendChild(editButton);
                        actionDiv.appendChild(deleteButton);
                        actionTd.appendChild(actionDiv);
                    }

                    tr.appendChild(actionTd);
                    tbody.appendChild(tr);
                });
            }

            console.log(TableJS);
            const table = ids.tablejs;
            const instance = new TableJS(table, {
                dataset: {
                    init: false,
                    collection: [],
                    rendering: renderTable
                },
                colvis: {
                    element: 'div#table-colvis',
                    exclude: ['.checkbox-column', '.actions-column'],
                    hide: [5, 6, 7],
                },
                exportAs: [
                    {
                        as: 'csv',
                        element: 'button#export-csv',
                        filename: 'ticket_report',
                        exclude: ['.checkbox-column', '.actions-column'],
                    },
                ],
                paginate: [
                    {
                        to: 'api',
                        as: 'limit',
                        element: 'select#pagination-limit',
                        output: output.pagination,
                    },
                    {
                        to: 'api',
                        as: 'next',
                        element: 'button#pagination-next',
                        output: output.pagination,
                    },
                    {
                        to: 'api',
                        as: 'previous',
                        element: 'button#pagination-previous',
                        output: output.pagination,
                    },
                    {
                        to: 'local',
                        as: 'search',
                        element: 'input#pagination-search',
                        exclude: ['.checkbox-column', '.actions-column'],
                        output: output.pagination,
                    },
                ],
            });

            async function refreshTable() {
                try {
                    const dataset = await $.getTicketManagementData();
                    // const dataset = await $.sampleQuery();
                    console.warn({
                        dataset
                    });
                    console.warn(dataset.length)
                    const parsed = JSON.parse(dataset);
                    const array = Array.from(parsed);
                    console.warn({
                        array
                    });
                    console.warn(array.length)
                    instance.setDataset(array).render();

                    // Hiding the spinner / loading animation
                    // console.warn("spinner", spinner)
                    spinner.classList.add('hidden');
                    // console.warn("tableContainer", tableContainer)
                    tableContainer.classList.remove('hidden');

                    // Remove the disable attribute from the buttons when the  
                    document.querySelectorAll('.disable-on-load').forEach(button => {
                        button.disabled = false;
                        button.classList.remove('cursor-not-allowed');
                    });
                } catch (error) {
                    console.error(error);
                    // showNoDataMessage();
                }
            }

            function showNoDataMessage() {
                console.log("Displaying 'No records found' message.");

                const tbody = document.querySelector('tbody'); // Ensure you have the correct selector
                if (!tbody) {
                    console.error("Tbody element not found.");
                    return;
                }

                // Clear existing rows
                tbody.innerHTML = '';

                // Add "No records found" row
                const noDataRow = document.createElement('tr');
                const noDataTd = document.createElement('td');
                noDataTd.colSpan = headers.length + 1; // Adjust colspan for headers + actions column
                noDataTd.classList.add('px-6', 'py-3', 'text-center');
                noDataTd.textContent = 'No records found';
                noDataRow.appendChild(noDataTd);
                tbody.appendChild(noDataRow);

                // Hide spinner and table container
                // spinner.classList.add('hidden');
                // tableContainer.classList.remove('hidden');

                // Remove the disable attribute from the buttons when the  
                // document.querySelectorAll('.disable-on-load').forEach(button => {
                //     button.disabled = false;
                //     button.classList.remove('cursor-not-allowed');
                // });
            }

            // Function to load data into edit fields
            function loadEditFields(item) {
                console.warn("Editing record: ", item);
                ids.editTicketId.value = item.TICKET_ID;
                ids.editTicketNoId.value = item.TICKET_NO;
                ids.editDateReceivedId.value = DateTime(item.DATE_RECEIVED, { format: "MM/DD/YYYY" });
                ids.editCreatedAtId.value = DateTime(item.CREATED_AT, { format: "MM/DD/YYYY" });
                ids.editTicketDescriptionId.value = item.DESCRIPTION;
                ids.editPriorityId.value = item.PRIORITY;
                ids.editAssignedPicId.value = item.ASSIGNED_PIC;
                ids.editPlanOfActionId.value = item.PLAN_OF_ACTION;
                ids.dateResolvedId.value = DateTime(item.DATE_RESOLVED, { format: "MM/DD/YYYY" });
                ids.resolutionDetailsId.value = item.RESOLUTION_DETAILS;
                console.warn("DATASET: ", dataset);

                const matchingRecord = matchDeviceRecord(item, dataset);

                console.log(matchingRecord);

                displayDeviceInfo(matchingRecord, item.DEVICE_TYPE, ids.editDeviceInfoList);
                // add the device type here
            }

            function matchDeviceRecord(editModalData, dataset) {
                const { DEVICE_TYPE, SIM_CARD_ID, MOBILE_ID } = editModalData;

                if (DEVICE_TYPE === "SIM") {
                    // Match SIM_CARD_ID in the SIM dataset
                    const matchingSim = dataset.SIM.find(sim => sim.SIM_CARD_ID === SIM_CARD_ID);
                    return matchingSim || null; // Return matching SIM record or null if not found
                } else if (DEVICE_TYPE === "PHONE") {
                    // Match MOBILE_ID in the Phone dataset (if provided)
                    const matchingPhone = dataset.PHONE.find(phone => phone.MOBILE_ID === MOBILE_ID);
                    return matchingPhone || null; // Return matching Phone record or null if not found
                }

                return null; // Return null if no matching device type
            }


            function loadViewFields(data = {}) {

                const matching = [
                    { element: ids.viewBillId, data: 'BILL_ID', type: 'string' },
                    { element: ids.viewIssuanceNoId, data: 'ISSUANCE_NO', type: 'string' },
                    { element: ids.viewSimCardId, data: 'SIM_CARD_ID', type: 'string' },
                    { element: ids.viewEmpGroupId, data: 'GROUP_ID', type: 'string' },
                    { element: ids.viewEmployeeNameId, data: 'EMPLOYEE_NAME', type: 'string' },
                    { element: ids.viewRfpGroupNameId, data: 'RFP_GROUP_NAME', type: 'string' },
                    { element: ids.viewMobileNoId, data: 'MOBILE_NO', type: 'string' },
                    { element: ids.viewAccountNoId, data: 'ACCOUNT_NO', type: 'string' },
                    { element: ids.viewRfpNoId, data: 'RFP_NO', type: 'string' },
                    { element: ids.viewMrfId, data: 'MONTHLY_RECURRING_FEE', type: 'number' },
                    { element: ids.viewBillPeriodFromToId, data: 'BILL_PERIOD_FROM_TO', type: 'string' },
                    // { element: ids.viewBillPeriodToId, data: 'BILL_PERIOD_TO', type: 'date' },
                    { element: ids.viewPreviousBillAmountId, data: 'PREVIOUS_BILL_AMOUNT', type: 'number' },
                    { element: ids.viewPreviousBillPaymentId, data: 'PREVIOUS_BILL_PAYMENT', type: 'number' },
                    { element: ids.viewExcessChargesId, data: 'EXCESS_CHARGES', type: 'number' },
                    { element: ids.viewOtherChargesId, data: 'OTHER_CHARGES', type: 'number' },
                    { element: ids.viewRfpAmountId, data: 'RFP_AMOUNT', type: 'number' },
                    { element: ids.viewAdjAmountId, data: 'ADJ_AMOUNT', type: 'number' },
                    { element: ids.viewAmountDueId, data: 'AMOUNT_DUE', type: 'number' },
                    { element: ids.viewCurrentChargeAmountId, data: 'CURRENT_CHARGE_AMOUNT', type: 'number' },
                ];

                matching.forEach(({ element, data: keyValue, type, default: defaultValue }) => {
                    const value = data[keyValue] !== '' ? data[keyValue] : defaultValue;
                    if (type === 'number') {
                        element.textContent = formatNumber(value);
                    } else {
                        element.textContent = value;
                    }
                });

            }

            async function getFormConfig(action) {
                switch (action) {
                    case 'addTicketRecord':
                        return {
                            submitCallback: async formData => {
                                dropdownList.innerHTML = "";
                                employeeNameContainer.classList.add('hidden');
                                // formData.rfpNo = formData.rfpNo.toUpperCase();
                                // console.log("FormData RFP No:", formData.rfpNo);

                                formData.group_id = selectedDeviceDetails.GROUP_ID || "N/A";
                                formData.sim_card_id = selectedDeviceDetails.SIM_CARD_ID || "N/A";
                                formData.mobile_id = selectedDeviceDetails.MOBILE_DEVICE_ID || "N/A";

                                console.warn(formData);

                                // isRfpNoValid(formData.rfpNo);

                                // // If RFP No is invalid, show error and exit
                                // if (!isRfpNumValid) {
                                //     // toast.error({
                                //     //     title: "The RFP No is Invalid",
                                //     //     description: "Please enter a valid RFP No",
                                //     //     timeout: 4000,
                                //     //     closeButton: false,
                                //     // });
                                //     return Promise.reject("The RFP No is Invalid");
                                // }

                                // const simCardIds = updateTotalSelectedItems();

                                // if (simCardIds.length > 0) {
                                //     const billingSheetData = await generateBillingSheet(simCardIds);

                                return new Promise((resolve, reject) => {
                                    google.script.run
                                        .withSuccessHandler(async () => {
                                            // Perform additional operations after successful submission
                                            // console.log("Performing additional operations for addForm");

                                            // ids.simCardsId.innerHTML = '';
                                            // ids.simCardInitialStateId.classList.remove('hidden');
                                            // ids.simCardInitialStateId.classList.add('flex');
                                            // existingRfpNos.set(formData.rfpNo, formData.rfpNo);

                                            // ids.selectedItems.textContent = 'Total Selected Items (0)';
                                            ids.deviceInfoList.innerHTML = '';

                                            resolve();
                                        })
                                        .withFailureHandler(reject)
                                        .addTicketRecord(formData);
                                });
                                // } else {
                                //     toast.error({
                                //         title: "No Items Selected",
                                //         description: "Please select an items to proceed",
                                //         timeout: 4000,
                                //         closeButton: false,
                                //     });

                                //     return Promise.reject("No Items Selected");

                                // }

                            },
                            additionalOperations: null // No additional operations before submission
                        };
                    case 'editTicketRecord':
                        return {
                            submitCallback: formData => new Promise((resolve, reject) => {
                                google.script.run
                                    .withSuccessHandler(resolve)
                                    .withFailureHandler(reject)
                                    .editTicketRecord(formData); // Correct server-side function
                            }),
                            additionalOperations: async formData => {
                                // Additional operations specific to editTicketRecord
                                // formData.editWithholdingTax = (formData.editRfpAmount / 1.12 * 0.02).toFixed(2);
                                // formData.editAmountAfterTax = formData.editRfpAmount - formData.editWithholdingTax;
                                // formData.editWithSoa = ids.editWithSoaId.checked;
                                console.warn("FormData for editTicketRecord:", formData.editTicketId);
                                return Promise.resolve();
                            }
                        };
                    // Add more cases for other actions as needed
                    default:
                        throw new Error('Unknown action: ' + action);
                }
            }

            // Function to handle form submission
            async function handleFormSubmission(form, modalId) {
                form.addEventListener('submit', async function (event) {
                    event.preventDefault();
                    const formData = new FormData(form);
                    const dataObject = Object.fromEntries(formData.entries());
                    const buttons = form.querySelectorAll('button.to-disable');
                    toggleButtonState(buttons, true);

                    const action = form.dataset.action;
                    const { submitCallback, additionalOperations } = await getFormConfig(action);

                    try {
                        // Perform additional operations before submission
                        if (additionalOperations) {
                            await additionalOperations(dataObject);
                        }
                        // Submit form data after additional operations
                        await submitCallback(dataObject);
                        console.warn("CHECKKKKKK")
                        refreshTable();
                        // showToast("Record successfully processed", "success");
                        toast.success({
                            title: "Record successfully processed",
                            description: "Record successfully processed",
                            timeout: 4000,
                            closeButton: false,
                        })
                        clearForm(form);
                        // updateToggleButton();
                        if (modalId) toggleModal(modalId); // Use the dynamic modal ID if present
                    } catch (error) {
                        console.error("Error:", error);
                        // showToast("An error occurred. Please try again.", "error");
                        // toast.error({
                        //     title: "An error occurred. Please try again.",
                        //     description: "An error occurred. Please try again.",
                        //     timeout: 4000,
                        //     closeButton: false,
                        // })
                    } finally {
                        setTimeout(() => toggleButtonState(buttons, false), 2000);
                    }
                });
            }

            // Function to handle the deletion logic
            async function handleDelete(dataId, options = {}) {
                if (dataId != null) {

                    const result = await $.deleteTicketRecord(dataId);

                    if (result.status === 'Success') {
                        console.info(result);
                        await refreshTable();
                        // showToast("Item deleted successfully!", "success");
                        toast.success({
                            title: "Item deleted successfully",
                            description: "Item deleted successfully",
                            timeout: 4000,
                            closeButton: false,
                        })
                        return true;
                    } else {
                        console.error(result);
                        // showToast("Item deletion unsuccessfully!", "error");
                        toast.error({
                            title: "Item deletion unsuccessful",
                            description: "Item deletion unsuccessful",
                            timeout: 4000,
                            closeButton: false,
                        })
                        return false;
                    }
                }
            }

            function toggleModal(modalId) {
                const modalToggle = document.querySelector(`[data-modal-toggle="${modalId}"]`);
                if (modalToggle) {
                    modalToggle.click();
                } else {
                    console.error(`Modal with identifier "${modalId}" not found.`);
                }
            }

            // Function to disable and enable buttons
            function toggleButtonState(buttons, state) {
                buttons.forEach(function (button) {
                    button.disabled = state;
                    button.classList.toggle('cursor-not-allowed', state);
                });
            }


            // Helper function to convert field value to a number
            function getFieldValue(element) {
                return element && element.value ? parseFloat(element.value) : 0;
            }


            // Initialize all forms
            document.querySelectorAll('.form-to-submit').forEach(form => {
                // Get modal ID from data attribute if present
                const modalId = form.dataset.modalId;
                handleFormSubmission(form, modalId);
            });

            const datepickerInputs = document.querySelectorAll('input[datepicker]');

            datepickerInputs.forEach(function (inputField) {
                inputField.addEventListener('keydown', function (event) {
                    const allowedKeys = ['Backspace', 'ArrowLeft', 'ArrowRight', 'Tab', '/'];
                    if (!event.key.match(/[0-9/]/) && !allowedKeys.includes(event.key)) {
                        event.preventDefault();
                    }
                });
            });


            refreshTable();

            // asdf
            // const deviceTypeDropdown = document.getElementById("deviceTypeId");
            // const deviceIdentifier = document.getElementById("deviceIdentifier");
            // const dropdownList = document.getElementById("dropdownList");
            // const errorMessage = document.getElementById("errorMessage");
            // const form = document.getElementById("dropdownForm");
            // const deviceInfo = document.getElementById("deviceInfo");
            // const deviceInfoList = document.getElementById("deviceInfoList");
            // const searchByDropdown = document.getElementById("searchById");

            // asdf here

            const deviceTypeDropdown = document.getElementById("deviceTypeId");
            const deviceIdentifier = document.getElementById("deviceIdentifier");
            const dropdownList = document.getElementById("dropdownList");
            const deviceInfo = document.getElementById("deviceInfo");
            const deviceInfoList = document.getElementById("deviceInfoList");
            const searchByDropdown = document.getElementById("searchById");
            const employeeNameSelect = document.getElementById("employeeName");
            const employeeDropdownList = document.getElementById("employeeDropdownList");
            const employeeNameContainer = employeeNameSelect.parentElement;

            let selectedDeviceDetails = null;


            let dataset = { SIM: [], PHONE: [] }; // Default dataset structure

            // Wrap google.script.run in a Promise to make it compatible with async/await
            function fetchDatasets() {
                return new Promise((resolve, reject) => {
                    google.script.run
                        .withSuccessHandler((result) => resolve(result)) // Resolve with the fetched data
                        .withFailureHandler((error) => reject(error)) // Reject in case of an error
                        .getDevices(); // Calls the Apps Script function
                });
            }

            // Fetch datasets from the backend and initialize dropdowns
            async function initializeDatasets() {
                try {
                    dataset = await fetchDatasets(); // Await the dataset fetch
                    console.log("Dataset loaded:", dataset);
                } catch (error) {
                    console.error("Failed to fetch datasets:", error);
                }
            }

            deviceTypeDropdown.addEventListener("change", () => {
                const selectedDeviceType = deviceTypeDropdown.value;
                searchByDropdown.innerHTML =
                    '<option value="" disabled selected>Select</option>';

                if (selectedDeviceType) {
                    deviceIdentifier.value = ""; // Clear the input
                    clearDeviceInfo();
                    dropdownList.classList.add("hidden"); // Hide the dropdown initially

                    const options =
                        selectedDeviceType === "SIM"
                            ? ["Mobile No", "SIM Card ID", "Employee Name"]
                            : ["IMEI", "Mobile Device ID", "Employee Name"];

                    options.forEach((option) => {
                        const opt = document.createElement("option");
                        opt.value = option;
                        opt.textContent = option;
                        searchByDropdown.appendChild(opt);
                    });

                    // Reset fields
                    dropdownList.textContent = "";
                    deviceIdentifier.textContent = "";
                    employeeNameContainer.classList.add("hidden");
                }
            });

            searchByDropdown.addEventListener("change", () => {
                const deviceType = deviceTypeDropdown.value;
                const searchBy = searchByDropdown.value;
                deviceIdentifier.textContent = "";
                dropdownList.textContent = "";

                if (deviceType && searchBy) {
                    deviceIdentifier.value = ""; // Clear the input
                    clearDeviceInfo();

                    if (searchBy === "Employee Name") {
                        employeeNameContainer.classList.remove("hidden");
                        employeeNameSelect.innerHTML = "";
                        employeeNameSelect.setAttribute('required', '');
                        populateEmployeeNames(deviceType); // Populate employee names
                    } else {
                        employeeNameContainer.classList.add("hidden");
                        employeeNameSelect.removeAttribute('required');
                        populateDeviceIdentifier(deviceType, searchBy);
                    }
                }
            });

            // Populate Employee Names with Combobox Search (Show filtered list on focus)
            function populateEmployeeNames(type) {
                const employees = dataset[type]
                    .map((item) => item.EMPLOYEE_NAME)
                    .filter((name, index, self) => name && self.indexOf(name) === index) // Get unique employee names
                    .sort((a, b) => a.localeCompare(b)); // Sort names alphabetically

                const employeeInput = document.getElementById("employeeName");
                const employeeDropdownList = document.getElementById("employeeDropdownList");
                const deviceDropdownList = document.getElementById("dropdownList"); // Device identifier dropdown

                // Function to populate the dropdown with filtered employees
                function populateDropdown(query = "") {
                    const filteredEmployees = employees.filter((name) =>
                        name.toLowerCase().includes(query.toLowerCase())
                    );

                    employeeDropdownList.innerHTML = ""; // Clear previous results

                    if (filteredEmployees.length > 0) {
                        filteredEmployees.forEach((name) => {
                            const dropdownItem = document.createElement("div");
                            dropdownItem.textContent = name;
                            dropdownItem.className =
                                "dropdown-item px-4 py-2 cursor-pointer hover:bg-gray-100";
                            employeeDropdownList.appendChild(dropdownItem);

                            // Event: Handle selection
                            dropdownItem.addEventListener("mousedown", (e) => {
                                e.preventDefault();
                                employeeInput.value = name; // Set selected name in input
                                employeeDropdownList.classList.add("hidden"); // Hide dropdown
                                deviceIdentifier.value = ""; // Reset device identifier field
                                deviceDropdownList.innerHTML = ""; // Clear device dropdown
                                deviceInfoList.textContent = ""; // Clear device info list
                                populateDeviceIdentifierByEmployee(type, name);
                            });
                        });

                        employeeDropdownList.classList.remove("hidden"); // Show dropdown
                    } else {
                        // No matches: Clear related fields and hide dropdown
                        employeeDropdownList.classList.add("hidden");
                        deviceIdentifier.value = ""; // Reset device identifier field
                        deviceDropdownList.innerHTML = ""; // Clear device dropdown
                        deviceInfoList.textContent = ""; // Clear device info list
                    }
                }

                // Event: Update dropdown based on user input
                employeeInput.addEventListener("input", () => {
                    const query = employeeInput.value.trim();
                    populateDropdown(query);
                });

                // Event: Show filtered results on focus
                employeeInput.addEventListener("focus", () => {
                    const query = employeeInput.value.trim(); // Retain the user's query
                    populateDropdown(query); // Show filtered results
                });

                // Event: Hide dropdown when focus is lost
                employeeInput.addEventListener("blur", () => {
                    setTimeout(() => employeeDropdownList.classList.add("hidden"), 200);
                });
            }

            // Populate Device Identifier by Employee Name
            function populateDeviceIdentifierByEmployee(type, employeeName) {
                dropdownList.innerHTML = ""; // Clear the dropdown

                // Normalize and filter the dataset
                const items = dataset[type].filter(
                    (item) => item.EMPLOYEE_NAME?.trim().toLowerCase() === employeeName.trim().toLowerCase()
                );

                console.log("Filtered Items for Employee:", items);

                items.forEach((item) => {
                    const { MOBILE_NO, SIM_CARD_ID, IMEI, MOBILE_ID } = item;
                    const id = type === "SIM" ? (MOBILE_NO || SIM_CARD_ID) : (MOBILE_ID || IMEI);
                    if (id) {
                        const dropdownItem = document.createElement("div");
                        dropdownItem.textContent = id;
                        dropdownItem.className = "dropdown-item px-4 py-2 cursor-pointer hover:bg-gray-100";
                        dropdownList.appendChild(dropdownItem);

                        dropdownItem.addEventListener("mousedown", (e) => {
                            e.preventDefault();
                            deviceIdentifier.value = id;
                            dropdownList.classList.add("hidden");
                            selectedDeviceDetails = item;
                            displayDeviceInfo(item, type, deviceInfoList); // Pass the whole item
                        });
                    }
                });


                // Handle no matches
                if (items.length === 0) {
                    clearDeviceInfo();
                    console.warn("No devices found for the selected employee.");
                } else {
                    // dropdownList.classList.remove("hidden"); // Show dropdown if items exist
                }
            }


            // Populate dropdown based on 'Search By' selection
            function populateDeviceIdentifier(type, searchBy) {
                dropdownList.innerHTML = ""; // Clear the dropdown
                let items = [];

                if (type === "SIM") {
                    if (searchBy === "Mobile No") {
                        items = dataset.SIM.map((sim) => ({
                            id: sim.MOBILE_NO,
                            details: sim,
                        }));
                    } else if (searchBy === "SIM Card ID") {
                        items = dataset.SIM.map((sim) => ({
                            id: sim.SIM_CARD_ID,
                            details: sim,
                        }));
                    }
                } else if (type === "PHONE") {
                    if (searchBy === "Mobile Device ID") {
                        items = dataset.PHONE.map((phone) => ({
                            id: phone.MOBILE_ID,
                            details: phone,
                        }));
                    } else if (searchBy === "IMEI") {
                        items = dataset.PHONE.map((phone) => ({
                            id: phone.IMEI,
                            details: phone,
                        }));
                    }
                }

                items.forEach(({ id, details }) => {
                    if (id) {
                        const dropdownItem = document.createElement("div");
                        dropdownItem.textContent = id;
                        dropdownItem.className =
                            "dropdown-item px-4 py-2 cursor-pointer hover:bg-gray-100";
                        dropdownList.appendChild(dropdownItem);

                        dropdownItem.addEventListener("mousedown", (e) => {
                            e.preventDefault();
                            deviceIdentifier.value = id;
                            dropdownList.classList.add("hidden");
                            selectedDeviceDetails = details;
                            displayDeviceInfo(details, type, deviceInfoList);
                        });
                    }
                });

                if (items.length === 0) {
                    clearDeviceInfo();
                }
            }

            function displayDeviceInfo(deviceDetails, deviceType, deviceInfoList) {
                deviceInfoList.innerHTML = ""; // Clear previous info

                console.warn("Device Details:", deviceDetails);

                const selectedFields =
                    deviceType === "SIM"
                        ? {
                            "Device Type": deviceType,
                            "Mobile No": deviceDetails.MOBILE_NO,
                            "SIM Card ID": deviceDetails.SIM_CARD_ID,
                            "Account No": deviceDetails.ACCOUNT_NO,
                            Status: deviceDetails.STATUS,

                        }
                        : {
                            "Device Type": deviceType,
                            "Mobile Device ID": deviceDetails.MOBILE_ID,
                            Brand: deviceDetails.BRAND,
                            Model: deviceDetails.MODEL,
                            IMEI: deviceDetails.IMEI,
                            Status: deviceDetails.STATUS,
                        };

                if (deviceDetails.STATUS === "Issued") {
                    selectedFields["Employee Name"] = deviceDetails.EMPLOYEE_NAME || "N/A";
                    selectedFields["Group ID"] = deviceDetails.GROUP_ID || "N/A";
                }

                Object.entries(selectedFields).forEach(([key, value]) => {
                    const labelDiv = document.createElement("div");
                    labelDiv.classList.add("col-span-1", "font-medium", "text-gray-900");
                    labelDiv.textContent = key;

                    const valueDiv = document.createElement("div");
                    valueDiv.classList.add("col-span-2", "text-gray-700");
                    valueDiv.textContent = value || "N/A";

                    deviceInfoList.appendChild(labelDiv);
                    deviceInfoList.appendChild(valueDiv);
                });
            }

            function clearDeviceInfo() {
                deviceInfoList.innerHTML = "";
            }

            // Filter dropdown items as the user types
            deviceIdentifier.addEventListener("input", () => {

                if (deviceIdentifier.value.trim() === "") {
                    clearDeviceInfo(); // Clear device details if the input is empty
                }

                const filter = deviceIdentifier.value.toLowerCase();
                dropdownList.classList.remove("hidden");

                const dropdownItems = Array.from(dropdownList.querySelectorAll(".dropdown-item"));
                dropdownItems.forEach((item) => {
                    item.classList.toggle("hidden", !item.textContent.toLowerCase().includes(filter));
                });

                // Clear device info if no matching record
                const hasMatchingItems = dropdownItems.some(item => !item.classList.contains("hidden"));
                if (!hasMatchingItems) {
                    clearDeviceInfo();
                }
            });

            // Hide dropdown when the input loses focus
            deviceIdentifier.addEventListener("blur", () => {
                setTimeout(() => dropdownList.classList.add("hidden"), 150);
            });

            // Show dropdown when input gains focus or is clicked
            deviceIdentifier.addEventListener('focus', () => {
                dropdownList.classList.remove('hidden');
            });

            deviceIdentifier.addEventListener('click', () => {
                dropdownList.classList.remove('hidden');
            });

            // Fetch datasets and initialize the form
            await initializeDatasets(); // Ensure datasets are loaded before enabling dropdowns


        });

        // document.getElementById('billsAndPayment').classList.remove('hidden');

    </script>
</body>

</html>